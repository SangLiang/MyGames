(function(e,t,n){qc.Serializer.registerCustomDeserializer("qc.ParticleSystem",function(e,t,n){return new qc.ParticleSystem(e,t,n)});var r=qc.ParticleSystem=function(e,t,r){qc.Node.call(this,new Phaser.Group(e.phaser,null),t,r),this.name="Particle System",this.paused=!1,this.onVisibleChanged=new qc.Signal,this.emitter=null;var i=e.assets.find("__builtin_resource__");this.texture=i.getTexture("empty.png"),this.emissionSpace=qc.ParticleSystem.EmissionSpace.WORLD,this.rendererType=qc.ParticleSystem.Renderer.SPRITE,this.zoneType=qc.ParticleSystem.Zones.Zone.POINT,this.edgeEmission=!1,this.zoneLength=100,this.zoneRotation=0,this.zoneRadius=100,this.zoneWidth=100,this.zoneHeight=100,this.frequency=.1,this.quantity=1,this.repeat=-1,this.delay=0,this.lifespan=[5,5],this.angle=[-120,-60],this.blendMode=Phaser.blendModes.NORMAL,this.startColor=new qc.Color(16777215),this.startColorVariation=0,this.endColor=new qc.Color(16777215),this.endColorVariation=0,this.startAlpha=[1,1],this.startScale=[1,1],this.startRotation=[0,0],this.startVelocity=[100,100],this.angularVelocity=[0,0],this.gravity=new qc.Point(0,0),this.maxParticles=200,this.playOnAwake=!0,this.initialFrame=[0,0],this.frameRate=[1,1],this.enableColorCurve=!1,this.colorCurve=new qc.BezierCurve(new qc.Keyframe(0,0,1,1),new qc.Keyframe(1,1,1,1)),this.enableAlphaCurve=!1,this.alphaCurve=new qc.BezierCurve(new qc.Keyframe(0,1,0,0),new qc.Keyframe(1,1,0,0)),this.enableScaleCurve=!1,this.scaleCurve=new qc.BezierCurve(new qc.Keyframe(0,1,0,0),new qc.Keyframe(1,1,0,0)),this.enableVelocityCurve=!1,this.velocityCurve=new qc.BezierCurve(new qc.Keyframe(0,1,0,0),new qc.Keyframe(1,1,0,0)),this.enableAngularVelocityCurve=!1,this.angularVelocityCurve=new qc.BezierCurve(new qc.Keyframe(0,1,0,0),new qc.Keyframe(1,1,0,0));var s=r!==n;s||this.initEmitter()};r.prototype=t.create(qc.Node.prototype),r.prototype.constructor=r,qc.ParticleSystem.Transitions={},qc.ParticleSystem.Zones={},qc.ParticleSystem.Renderer={},qc.ParticleSystem.Renderer={SPRITE:1},qc.ParticleSystem.EmissionSpace={WORLD:0,LOCAL:1},t.defineProperties(r.prototype,{"class":{get:function(){return"qc.ParticleSystem"}}}),r.prototype.update=function(){if(this.paused)return;var e=this.game.time.deltaTime*.001;this.emitter.update(e)},r.prototype.initEmitter=function(){var e=new qc.ParticleSystem.Emitter(this);this.emitter=e,e.init(),!this.isWorldVisible()||!this.playOnAwake?this.pause():this.start()},r.prototype.start=function(){if(!this.isWorldVisible())return;this.paused=!1,this.emitter.start()},r.prototype.pause=function(){this.paused=!0,this.emitter.pause()},r.prototype.clear=function(){this.emitter.clear()},r.prototype.reset=function(){this.emitter.reset()},r.prototype.onDeserialized=function(){this.initEmitter()},r.prototype.onDestroy=function(){this.emitter.destroy(),this.emitter=null,qc.Node.prototype.onDestroy.call(this)},r.prototype.onVisibleChange=function(){if(this.emitter===null)return;this.onVisibleChanged.dispatch(),this.isWorldVisible()?this.start():(this.clear(),this.pause())},r.prototype.getMeta=function(){var e=this,t=qc.Serializer,n=qc.Node.prototype.getMeta.call(this);return n.rendererType=t.NUMBER,n.texture=t.TEXTURE,n.initialFrame=t.NUMBERS,n.frameRate=t.NUMBERS,n.zoneType=t.NUMBER,n.edgeEmission=t.BOOLEAN,n.zoneLength=t.NUMBER,n.zoneRotation=t.NUMBER,n.zoneRadius=t.NUMBER,n.zoneWidth=t.NUMBER,n.zoneHeight=t.NUMBER,n.emissionSpace=t.NUMBER,n.frequency=t.NUMBER,n.quantity=t.NUMBER,n.repeat=t.NUMBER,n.delay=t.NUMBER,n.lifespan=t.NUMBERS,n.angle=t.NUMBERS,n.blendMode=t.NUMBER,n.startColor=t.COLOR,n.endColor=t.COLOR,n.startAlpha=t.NUMBERS,n.startScale=t.NUMBERS,n.startRotation=t.NUMBERS,n.startVelocity=t.NUMBERS,n.angularVelocity=t.NUMBERS,n.gravity=t.POINT,n.maxParticles=t.NUMBER,n.playOnAwake=t.BOOLEAN,n.enableColorCurve=t.BOOLEAN,n.colorCurve=t.GEOM,n.enableAlphaCurve=t.BOOLEAN,n.alphaCurve=t.GEOM,n.enableScaleCurve=t.BOOLEAN,n.scaleCurve=t.GEOM,n.enableVelocityCurve=t.BOOLEAN,n.velocityCurve=t.GEOM,n.enableAngularVelocityCurve=t.BOOLEAN,n.angularVelocityCurve=t.GEOM,n};var i=qc.ParticleSystem.Transitions.Transform=function(e){this.particle=e,this.particleSystem=e.emitter.owner,this.time=e.emitter.game.time,this.gravity=new Phaser.Point,this.x=0,this.y=0,this.anchor={x:.5,y:.5},this.velocity={x:0,y:0},this.originVelocity={x:0,y:0},this.scale=this.originScale=1,this.rotation=0,this.originAngularVelocity=0};i.prototype.constructor=i,i.prototype.init=function(e,t){this.x=e,this.y=t,this.gravity=this.particleSystem.gravity;var n=qc.ParticleSystem.Util.getRandom(this.particleSystem.angle),r=qc.ParticleSystem.Util.getRandom(this.particleSystem.startVelocity),i=n*Math.PI/180;this.velocity.x=this.originVelocity.x=r*Math.cos(i),this.velocity.y=this.originVelocity.y=r*Math.sin(i),this.scale=this.originScale=qc.ParticleSystem.Util.getRandom(this.particleSystem.startScale),this.rotation=qc.ParticleSystem.Util.getRandom(this.particleSystem.startRotation)*Math.PI/180,this.originAngularVelocity=qc.ParticleSystem.Util.getRandom(this.particleSystem.angularVelocity)*Math.PI/180},i.prototype.update=function(e,t){var n=t;this.originVelocity.x+=this.gravity.x*e,this.originVelocity.y+=this.gravity.y*e;if(this.particleSystem.enableVelocityCurve){var r=this.particleSystem.velocityCurve.evaluate(n);this.velocity.x=this.originVelocity.x*r,this.velocity.y=this.originVelocity.y*r}else this.velocity.x=this.originVelocity.x,this.velocity.y=this.originVelocity.y;this.x+=this.velocity.x*e,this.y+=this.velocity.y*e;if(this.particleSystem.enableScaleCurve){var i=this.particleSystem.scaleCurve.evaluate(n);this.scale=this.originScale*i}if(this.originAngularVelocity!==0){var s=this.originAngularVelocity;this.particleSystem.enableAngularVelocityCurve&&(s*=this.particleSystem.angularVelocityCurve.evaluate(n)),this.rotation+=s*e}};var s=qc.ParticleSystem.Zones.Zone=function(e){this.geometry=null,this._random=new qc.Point,this.edgeEmission=e};s.prototype.constructor=s,s.POINT=1,s.LINE=2,s.RECTANGLE=3,s.CIRCLE=4,s.prototype.getRandom=function(){return this._random},s.prototype.emit=function(e,t){for(var n=0;n<t;n++)this.getRandom(),e.emitParticle(this._random.x,this._random.y,e)};var o=qc.ParticleSystem.Particle=function(e){this.emitter=e,this.particleSystem=e.owner,this.renderer=e.renderer,this.game=this.emitter.owner.game,this.manualDisplayChanged=this.game.phaser.renderType===Phaser.CANVAS&&this.game.dirtyRectangle.enable,this.alive=!0,this.life=0,this.sprite=null,this.transform=new qc.ParticleSystem.Transitions.Transform(this),this.color=new qc.ParticleSystem.Transitions.Color(this)};o.prototype.constructor=o,o.prototype.init=function(e,t){this.life=0,this.alive=!0,this.lifespan=qc.ParticleSystem.Util.getRandom(this.particleSystem.lifespan);var n=qc.ParticleSystem.Util.getRandom(this.particleSystem.frameRate);this.frameInterval=1/n,this.frameTime=0,this.create(e,t),this.particleSystem.emissionSpace===qc.ParticleSystem.EmissionSpace.WORLD&&(this.cacheParentWorldTransform(),this.sprite.updateTransform=o.updateTransform)},o.prototype.create=function(e,t){var n=this.particleSystem.texture;this.transform.init(e,t),this.color.init();if(this.alive){var r;n.atlas.meta.spriteSheet?(this.frameIndex=qc.ParticleSystem.Util.getRandom(this.particleSystem.initialFrame),this.frameIndex=Phaser.Math.clamp(Math.round(this.frameIndex),0,n.atlas.frameNames.length-1),r=n.atlas.frameNames[this.frameIndex]):n.frame===0?r=this.game.phaser.rnd.pick(n.atlas.frameNames):r=n.frame;var i=this.renderer.add(this,n,r);this.renderer.update(this)}this.transform.update(0,0),this.color.update(0,0),this.manualDisplayChanged&&this.sprite.displayChanged(qc.DisplayChangeStatus.SHOW)},o.prototype.update=function(e){this.life+=e,this.life<this.delay?this.sprite.visible=!1:this.sprite.visible=!0,this.renderer.update(this);var t=Phaser.Math.clamp(this.life/this.lifespan,0,1);this.transform.update(e,t),this.color.update(e,t);if(this.life>=this.lifespan){this.terminate();return}this.emitter.owner.texture.atlas.meta.spriteSheet&&(this.frameTime+=e,this.frameTime>=this.frameInterval&&(this.frameIndex++,this.frameIndex>=this.emitter.owner.texture.atlas.frameNames.length&&(this.frameIndex=0),this.sprite.frameName=this.particleSystem.texture.atlas.frameNames[this.frameIndex],this.manualDisplayChanged&&this.sprite.displayChanged(qc.DisplayChangeStatus.SHOW),this.frameTime-=this.frameInterval))},o.prototype.terminate=function(){this.alive=!1,this.sprite.kill(),this.manualDisplayChanged&&this.sprite.displayChanged(qc.DisplayChangeStatus.HIDE)},o.prototype.cacheParentWorldTransform=function(){if(!this.sprite)return;var e=this.emitter.owner.phaser.worldTransform,t=this.sprite._parentWorldTransform=new qc.Matrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty},o.updateTransform=function(){if(!this.parent||!this.visible)return;var e=this._parentWorldTransform;if(!e)return;var t=this.worldTransform,n,r,i,s,o,u;if(this.rotation%PIXI.PI_2){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),n=this._cr*this.scale.x,r=this._sr*this.scale.x,i=-this._sr*this.scale.y,s=this._cr*this.scale.y,o=this.position.x,u=this.position.y;if(this.pivot.x||this.pivot.y)o-=this.pivot.x*n+this.pivot.y*i,u-=this.pivot.x*r+this.pivot.y*s;t.a=n*e.a+r*e.c,t.b=n*e.b+r*e.d,t.c=i*e.a+s*e.c,t.d=i*e.b+s*e.d,t.tx=o*e.a+u*e.c+e.tx,t.ty=o*e.b+u*e.d+e.ty}else n=this.scale.x,s=this.scale.y,o=this.position.x-this.pivot.x*n,u=this.position.y-this.pivot.y*s,t.a=n*e.a,t.b=n*e.b,t.c=s*e.c,t.d=s*e.d,t.tx=o*e.a+u*e.c+e.tx,t.ty=o*e.b+u*e.d+e.ty;this.worldAlpha=this.alpha,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,t,e)};var u=qc.ParticleSystem.Renderer.Sprite=function(e){this.emitter=e,this.game=this.emitter.game,this.display=e.owner.phaser};u.prototype.constructor=u,u.prototype.add=function(e,t,n){var r=t.atlas.url,i=e.sprite;return i?(i.reset(e.transform.x,e.transform.y),i.key!==r?i.loadTexture(r,n):i.frameName=n):i=this.display.create(e.transform.x,e.transform.y,r,n),i.anchor.set(e.transform.anchor.x,e.transform.anchor.y),i.blendMode=e.color.blendMode,e.sprite=i,i},u.prototype.update=function(e){var t=0,n=e.sprite;if(n.x!==e.transform.x||n.y!==e.transform.y)t|=qc.DisplayChangeStatus.OFFSET,n.x=e.transform.x,n.y=e.transform.y;n.scale.x!==e.transform.scale&&(t|=qc.DisplayChangeStatus.SCALE,n.scale.x=e.transform.scale,n.scale.y=e.transform.scale),n.rotation!==e.transform.rotation&&(t|=qc.DisplayChangeStatus.ROTATION,n.rotation=e.transform.rotation),n.tint!==e.color.tint&&(t|=qc.DisplayChangeStatus.TINT,n.tint=e.color.tint),n.alpha!==e.color.alpha&&(t|=qc.DisplayChangeStatus.ALPHA,n.alpha=e.color.alpha),n._isNotNeedCalcTransform=!1,e.manualDisplayChanged&&n.displayChanged(t)};var a=qc.ParticleSystem.Transitions.Color=function(e){this.particle=e,this.particleSystem=e.emitter.owner,this.time=e.emitter.game.time,this.blendMode=Phaser.blendModes.NORMAL,this.tint=0,this.alpha=this.originAlpha=1};a.prototype.constructor=a,a.prototype.init=function(){var e=qc.ParticleSystem.Util.getRandom,t=qc.ParticleSystem.Util.getRandomByVariation;this.alpha=this.originAlpha=e(this.particleSystem.startAlpha),this.startColor=new qc.Color(16777215),this.startColor.r=t(this.particleSystem.startColor.r,this.particleSystem.startColorVariation),this.startColor.g=t(this.particleSystem.startColor.g,this.particleSystem.startColorVariation),this.startColor.b=t(this.particleSystem.startColor.b,this.particleSystem.startColorVariation),this.endColor=new qc.Color(16777215),this.endColor.r=t(this.particleSystem.endColor.r,this.particleSystem.endColorVariation),this.endColor.g=t(this.particleSystem.endColor.g,this.particleSystem.endColorVariation),this.endColor.b=t(this.particleSystem.endColor.b,this.particleSystem.endColorVariation),this.tint=this.startColor.toNumber(),this.blendMode=this.particleSystem.blendMode},a.prototype.update=function(e,t){var n=t,r=this.startColor.rgb,i=this.endColor.rgb;if(r[0]!==i[0]||r[1]!==i[1]||r[2]!==i[2]){var s;this.particleSystem.enableColorCurve?s=this.particleSystem.colorCurve.evaluate(n):s=n;var o=255,u=255,a=255;r[0]!==i[0]&&(o=Phaser.Math.clamp(Math.round(r[0]+s*(i[0]-r[0])),0,255)),r[1]!==i[1]&&(u=Phaser.Math.clamp(Math.round(r[1]+s*(i[1]-r[1])),0,255)),r[2]!==i[2]&&(a=Phaser.Math.clamp(Math.round(r[2]+s*(i[2]-r[2])),0,255)),this.tint=o<<16|u<<8|a}if(this.particleSystem.enableAlphaCurve){var f=this.particleSystem.alphaCurve.evaluate(n);this.alpha=this.originAlpha*f}};var f=qc.defineBehaviour("qc.EmitterViewer",qc.Behaviour,function(){var e=this;e.now=e.game.time.now,e.runInEditor=!0,e.debugOn=!0,e.duration=1},{debugOn:qc.Serializer.BOOLEAN,particleSystem:qc.Serializer.NODE});f.__menu="Debug/EmitterViewer",t.defineProperties(f.prototype,{debugOn:{get:function(){return this._debugOn},set:function(e){this._debugOn=e}},particleSystem:{get:function(){return this._particleSystem},set:function(e){this._particleSystem=e}}}),f.prototype.postUpdate=function(){if(!this.particleSystem)return;if(!this.debugOn)return;var e=this.game.time.now;if(e-this.now>=this.duration*1e3){var t=this.particleSystem.emitter;if(t===null)return;var n=qc.Util.formatString("\n\n({0})\nAlive:{1}\nDead:{2}\nTotal:{3}",this.particleSystem.name,t.list.length,t.pool.length,t.list.length+t.pool.length);this.gameObject instanceof qc.UIText?this.gameObject.text=n:this.gameObject instanceof qc.Dom&&(n=n.replace(/\n/g,"<br/>"),this.gameObject.innerHTML=n)}},qc.ParticleSystem.Util={getRandom:function(e){if(!Array.isArray(e)||e.length<2)return 0;var t=e[0]||0,n=e[1]||0,r=Math.random(),i=t+r*(n-t);return i},getRandomByVariation:function(e,t){return e=e||0,t=t||0,e+t*(1-2*Math.random())}};var l=qc.ParticleSystem.Zones.Circle=function(e,t){qc.ParticleSystem.Zones.Zone.call(this,t),this.geometry=new qc.Circle(0,0,e*2)};l.prototype=t.create(qc.ParticleSystem.Zones.Zone.prototype),l.prototype.constructor=l,l.prototype.getRandom=function(){var e=2*Math.PI*Math.random(),t=this.geometry.radius*(this.edgeEmission?1:Math.random());this._random.x=this.geometry.x+t*Math.cos(e),this._random.y=this.geometry.y+t*Math.sin(e)};var c=qc.ParticleSystem.Zones.Line=function(e,t){qc.ParticleSystem.Zones.Zone.call(this);var n=t*Math.PI/180,r=e/2*Math.cos(n),i=e/2*Math.sin(n),s=-r,o=-i;this.geometry=new qc.Line(r,i,s,o)};c.prototype=t.create(qc.ParticleSystem.Zones.Zone.prototype),c.prototype.constructor=c,c.prototype.getRandom=function(){var e=Math.random();this._random.x=this.geometry.start.x+e*(this.geometry.end.x-this.geometry.start.x),this._random.y=this.geometry.start.y+e*(this.geometry.end.y-this.geometry.start.y)};var h=qc.ParticleSystem.Zones.Point=function(){qc.ParticleSystem.Zones.Zone.call(this),this.geometry=new qc.Point};h.prototype=t.create(qc.ParticleSystem.Zones.Zone.prototype),h.prototype.constructor=h,h.prototype.getRandom=function(){this._random=this.geometry};var p=qc.ParticleSystem.Zones.Rectangle=function(e,t,n){qc.ParticleSystem.Zones.Zone.call(this,n);var r=-e/2,i=-t/2;this.geometry=new qc.Rectangle(r,i,e,t)};p.prototype=t.create(qc.ParticleSystem.Zones.Zone.prototype),p.prototype.constructor=p,p.prototype.getRandom=function(){if(!this.edgeEmission)this._random.x=this.geometry.x+Math.random()*this.geometry.width,this._random.y=this.geometry.y+Math.random()*this.geometry.height;else{var e,t,n=Math.random()*this.geometry.perimeter;n<=this.geometry.width?(e=n,t=0):n<=this.geometry.width+this.geometry.height?(e=this.geometry.width,t=n-this.geometry.width):n<=this.geometry.width*2+this.geometry.height?(e=this.geometry.width*2+this.geometry.height-n,t=this.geometry.height):(e=0,t=this.geometry.perimeter-n),this._random.x=this.geometry.x+e,this._random.y=this.geometry.y+t}};var d=qc.ParticleSystem.Emitter=function(e){this.game=e.game.phaser,this.owner=e,this.particleClass=qc.ParticleSystem.Particle,this.list=[],this.pool=[],this.paused=!1};d.prototype.constructor=d,d.prototype.init=function(){this.renderer=this.createRenderer(this.owner.rendererType),this.zone=this.createZone(),this.timer=this.game.time.create(!1)},d.prototype.start=function(){this.paused=!1;if(!this.timer.running){var e=this.owner.repeat,t=this.owner.frequency*1e3;e===-1?this.timer.loop(t,this.emitImp,this):e>0&&this.timer.repeat(t,e,this.emitImp,this),this.timer.start(this.owner.delay*1e3)}else this.timer.resume()},d.prototype.pause=function(){this.paused=!0,this.timer.pause()},d.prototype.update=function(e){for(var t=this.list.length-1;t>=0;t--){var n=this.list[t];n.update(e),n.alive||(this.pool.push(n),this.list.splice(t,1))}},d.prototype.clear=function(){for(var e=0;e<this.list.length;e++){var t=this.list[e];t.terminate()}this.list=[],this.pool=[]},d.prototype.reset=function(){this.clear(),this.renderer=null,this.zone=null,this.timer.destroy(),this.init()},d.prototype.destroy=function(){this.clear(),this.renderer=null,this.zone=null,this.timer.destroy(),this.timer=null},d.prototype.emitParticle=function(e,t,n){if(this.list.length>=this.owner.maxParticles)return;var r=this.pool.pop();r||(r=new this.particleClass(this)),r.init(e,t),r.alive?this.list.push(r):this.pool.push(r)},d.prototype.emitImp=function(){var e=this.owner.quantity;this.zone&&this.zone.emit(this,e)},d.prototype.createRenderer=function(e){e=e||qc.ParticleSystem.RENDER_TYPE_SPRITE;var t;switch(e){case qc.ParticleSystem.Renderer.SPRITE:t=new qc.ParticleSystem.Renderer.Sprite(this);break;default:console.error("Invalid renderer type "+e)}return t},d.prototype.createZone=function(){var e=this.owner.zoneType,t=this.owner.edgeEmission,n;switch(e){case qc.ParticleSystem.Zones.Zone.POINT:n=new qc.ParticleSystem.Zones.Point;break;case qc.ParticleSystem.Zones.Zone.LINE:var r=this.owner.zoneLength,i=this.owner.zoneRotation;n=new qc.ParticleSystem.Zones.Line(r,i);break;case qc.ParticleSystem.Zones.Zone.CIRCLE:var s=this.owner.zoneRadius;n=new qc.ParticleSystem.Zones.Circle(s,t);break;case qc.ParticleSystem.Zones.Zone.RECTANGLE:var o=this.owner.zoneWidth,u=this.owner.zoneHeight;n=new qc.ParticleSystem.Zones.Rectangle(o,u,t);break;default:console.error("Invalid zone type "+zoneType)}return n},document.body.addEventListener("touchmove",function(e){e.preventDefault()},!1),e.fs=qc.fs={GameManager:null,ConfigManager:null,LayerManager:null},qc.initGame=function(e){fs.Game=e};var v=qc.defineBehaviour("qc.engine.ConfigManager",qc.Behaviour,function(){var e=this;fs.ConfigManager=e,e.levelID=1,e.row=8,e.colunm=9,e.gridW=80,e.gridH=80,e.excelData={tiles:null,zone:null},e.UI=null,e.levelData=null,e.spriteData={},e.actorData=null,e.sceneBgData={},e.soundData=[],e.isReady={level:!1,sprite:!1,actor:!1,sceneBg:!1,sound:!1}},{uiAsset:qc.Serializer.TEXTURE,tilesConfig:qc.Serializer.TEXTASSET,zoneConfig:qc.Serializer.TEXTASSET,tileListConfig:qc.Serializer.TEXTASSET,fillidConfig:qc.Serializer.TEXTASSET,fillRuleConfig:qc.Serializer.TEXTASSET,purchaseConfig:qc.Serializer.TEXTASSET,audioConfig:qc.Serializer.TEXTASSET,skillConfig:qc.Serializer.TEXTASSET,skillAreaConfig:qc.Serializer.TEXTASSET});v.prototype.awake=function(){var e=this;e.UI=e.uiAsset,e.excelData={tiles:JSON.parse(e.tilesConfig.text),zone:JSON.parse(e.zoneConfig.text),tilesList:JSON.parse(e.tileListConfig.text),fillid:JSON.parse(e.fillidConfig.text),fillRule:JSON.parse(e.fillRuleConfig.text),purchase:JSON.parse(e.purchaseConfig.text),audio:JSON.parse(e.audioConfig.text),skill:JSON.parse(e.skillConfig.text),skillArea:JSON.parse(e.skillAreaConfig.text)},e.getLevelConfig(),e.spriteAssetsLoad(),e.soundAssetsLoad(),e.backGroundAssetsLoad(),e.actorAssetsLoad()},v.prototype.getLevelConfig=function(e){var t=this,n=t.excelData.zone[t.levelID].tmx,r="Assets/level/"+n+".bin";t.game.assets.load("levelConfig",r,function(e){t.levelData=JSON.parse(e.text),t.isReady.level=!0})},v.prototype.spriteAssetsLoad=function(){var e=this,t=[{key:"bee",url:"Assets/sprite/bee.bin"},{key:"cow",url:"Assets/sprite/cow.bin"},{key:"fengmi",url:"Assets/sprite/fengmi.bin"},{key:"jelly",url:"Assets/sprite/jelly.bin"},{key:"particle",url:"Assets/sprite/particle.bin"},{key:"port_down",url:"Assets/sprite/port_down.bin"},{key:"port_up",url:"Assets/sprite/port_up.bin"},{key:"skill",url:"Assets/sprite/skill.bin"},{key:"teng",url:"Assets/sprite/teng.bin"},{key:"tile_blue",url:"Assets/sprite/tile_blue.bin"},{key:"tile_cracker",url:"Assets/sprite/tile_cracker.bin"},{key:"tile_green",url:"Assets/sprite/tile_green.bin"},{key:"tile_ice",url:"Assets/sprite/tile_ice.bin"},{key:"tile_normal",url:"Assets/sprite/tile_normal.bin"},{key:"tile_orange",url:"Assets/sprite/tile_orange.bin"},{key:"tile_purple",url:"Assets/sprite/tile_purple.bin"},{key:"tile_red",url:"Assets/sprite/tile_red.bin"},{key:"tile_white",url:"Assets/sprite/tile_white.bin"},{key:"tile_yellow",url:"Assets/sprite/tile_yellow.bin"}];e.game.assets.loadBatch(t,function(){for(var n=0;n<t.length;n++){var r=t[n].key,i=t[n].asset;e.spriteData[r]=i}e.isReady.sprite=!0})},v.prototype.soundAssetsLoad=function(){var e=this,t=e.excelData.zone[e.levelID].type,r={47:"trouble",49:"dogfood",53:"juice",54:"popsicle"},i=[1,2,3,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,47,49,51,52,53,54,56,60,61,62,63,64,65,66,67,68,69,70,76,78,79,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,109,110,111,112,113,114,118,119,120],s=readyCount=i.length,o=function(){if(--readyCount<=0){for(var o=0;o<s;o++){var u=i[o],a=e.excelData.audio[u].name,f=e.excelData.audio[u].id;if(!a)continue;if(r[f]!=n&&r[f]!=t)continue;r[f]==t&&(u=0);var l=e.soundData[u]=e.game.add.sound(qc.N("audio")),c="audio_"+f,h=e.game.assets.find(c);l.name=""+f,l.destroyWhenStop=!1,l.audio=h}e.isReady.sound=!0}};for(var u=0;u<s;u++){var a=i[u],f=e.excelData.audio[a].name,l=e.excelData.audio[a].id;if(!f){o();continue}if(r[l]!=n&&r[l]!=t){o();continue}var c="Assets/audio/"+f+".bin",a="audio_"+l;e.game.assets.load(a,c,function(e){o()})}},v.prototype.actorAssetsLoad=function(){var e=this,t=e.excelData.zone[e.levelID].type,n=0;console.warn(t);var r=qc.N("actorNode"),i=function(){n==1&&(e.isReady.actor=!0)},s=function(i){t=="juice"?e.game.assets.load("Assets/sprite/zhangliang.bin",function(e){r.texture=e,r.resetNativeSize(),r.scaleX=1.5,r.scaleY=1.5,r.x=3.507,r.y=431.808,n++,r.alpha=0,i()}):t=="trouble"?e.game.assets.load("Assets/sprite/boss.bin",function(e){r.texture=e,r.resetNativeSize(),r.scaleX=2,r.scaleY=2,r.x=-17.1,r.y=484.2,r.alpha=0,n++,i()}):t=="popsicle"?e.game.assets.load("Assets/sprite/wangjiaer.bin",function(e){r.texture=e,r.resetNativeSize(),r.scaleX=2.4,r.scaleY=2.4,r.x=15.46,r.y=396.627,r.alpha=0,n++,i()}):t=="dogfood"&&e.game.assets.load("Assets/sprite/shenmengchen.bin",function(e){r.texture=e,r.resetNativeSize(),r.scaleX=1.9,r.scaleY=1.9,r.x=50,r.y=126.995,r.alpha=0,n++,i()})};s(i)},v.prototype.backGroundAssetsLoad=function(){var e=this,t=0,n=e.excelData.zone[e.levelID],r=function(r,i,s){i=="grid"?e.game.assets.load("Assets/texture/window-top/"+n.girdBackground.split(".")[0]+".bin",function(e){r.texture=e,t++,s()}):i=="top"&&e.game.assets.load("Assets/texture/window-top/"+n.background.split(".")[0]+".bin",function(e){r.texture=e,t++,s()})},i=function(){t==2&&(e.isReady.sceneBg=!0)};r(fs.ScenesUI.backGround.gridBg,"grid",i),r(fs.ScenesUI.backGround.topBg,"top",i)};var m=qc.defineBehaviour("qc.engine.GameManager",qc.Behaviour,function(){var e=this;fs.GameManager=e,e.FSM={},e.isMainLogicSwitch=!1,e.externalLogicSwitch=!0,e.gameSwitch=0,e.game.input.mouse.enable=!1,e.game.input.touch.enable=!1,e.isBoardReady=!1,e.isSceneUIReady=!1,e.isAudioReady=!1,e.eliminateNoticeList=[],e.eliminateNoticeSwitch=!0,e.noticeTime=function(){},e.isgoShuffle=0,e.gamePause=!1,e.comboCount=0},{});m.prototype.onEnable=function(){var e=this;e.initFSM()},m.prototype.initFSM=function(){var e=this;e.FSM.list=["initGame","gameStart","waitUser","waitMapAction","mapAction","waitTileAction","tileAction","waitActorAction","actorAction"],e.FSM.state="initGame",e.iTimer=e.game.timer.loop(100,e.initGame.bind(e))},m.prototype.noticeTimeBuilder=function(){var e=this;e.noticeTime=fs.Game.timer.loop(3500,fs.DisFactory.eliminateNotice.bind(e))},m.prototype.removeTimeBuilder=function(){var e=this;fs.Game.timer.remove(e.noticeTime)},m.prototype.initGame=function(){var e=this;fs.ConfigManager.isReady.level==1&&fs.ConfigManager.isReady.sprite==1&&fs.ConfigManager.isReady.actor==1&&fs.ConfigManager.isReady.sceneBg==1&&fs.ConfigManager.isReady.sound==1&&(e.game.timer.remove(e.iTimer),fs.LayerManager.init(),fs.ScenesUI.initLevelUI(),fs.ActorAnimation.initActorAnimation(),e.gameStart())},m.prototype.gameStart=function(){var e=this;fs.CacheAsBitmap.updateCache(),fs.ScenesUI.tipPanelControl(),e.FSM.switch=!0,qc.N("initial").visible=!1,fs.AudioManager.playSound(0,!0),fs.LayerManager.showBoard()},m.prototype.changeFSM=function(e){var t=this;if(!t.FSM.switch)return;if(e!=n)t.FSM.state=e;else if(t.FSM.state=="actorAction")t.FSM.state="waitUser";else{var r=t.FSM.list.indexOf(t.FSM.state)+1;t.FSM.state=t.FSM.list[r]}t.FSM.state=="gameStart"&&(t.isMainLogicSwitch=!0),t.FSM.state=="waitUser"&&(fs.TaskLogic.bossDownHP=fs.TaskLogic.bossHP,fs.TaskLogic.checkGameResult(),t.comboCount=0,t.eliminateNoticeSwitch=!0,t.game.input.mouse.enable=!0,t.game.input.touch.enable=!0,t.isMainLogicSwitch=!1,t.removeTimeBuilder(),t.eliminateNoticeList=fs.DisFactory.checkMapDie(),t.eliminateNoticeList===!0?(t.removeTimeBuilder(),fs.PopManager.playPopAnimation("nomatch")):t.eliminateNoticeList=fs.DisFactory.checkMapDie()),t.FSM.state=="waitMapAction"&&(t.isgoShuffle=0,t.eliminateNoticeSwitch=!1,fs.DisFactory.switchTime=!1,t.game.input.mouse.enable=!1,t.game.input.touch.enable=!1,t.isMainLogicSwitch=!0,fs.ScenesUI.stepLogic(),fs.BossSkill.skillStepCount+=1),t.FSM.state=="mapAction"&&(t.eliminateNoticeSwitch=!1,t.game.input.mouse.enable=!1,t.game.input.touch.enable=!1,t.isMainLogicSwitch=!1),t.FSM.state=="waitTileAction"&&(t.eliminateNoticeSwitch=!1,t.game.input.mouse.enable=!1,t.game.input.touch.enable=!1,t.isMainLogicSwitch=!0),t.FSM.state=="tileAction"&&(t.eliminateNoticeSwitch=!1,t.game.input.mouse.enable=!1,t.game.input.touch.enable=!1,t.isMainLogicSwitch=!1),t.FSM.state=="waitActorAction"&&(t.eliminateNoticeSwitch=!1,t.game.input.mouse.enable=!1,t.game.input.touch.enable=!1,t.isMainLogicSwitch=!0),t.FSM.state=="actorAction"&&(t.eliminateNoticeSwitch=!1,t.game.input.mouse.enable=!1,t.game.input.touch.enable=!1,t.isMainLogicSwitch=!1),t.game.log.trace("当前状态: {0}",t.FSM.state),console.dir(fs.LayerManager.tilesList)},m.prototype.start=function(){var e=this;--e.gameSwitch==0&&(e.externalLogicSwitch=!0)},m.prototype.stop=function(){var e=this;e.gameSwitch++,e.externalLogicSwitch=!1},m.prototype.update=function(){var e=this;if(e.isMainLogicSwitch&&e.externalLogicSwitch&&e.FSM.switch){fs.LayerManager.dropAll();if(!fs.LayerManager.checkDropComplete())return;if(!fs.LayerManager.checkNewTileComplete())return;e.FSM.state=="gameStart"&&(!fs.DisFactory.checkElement(!0)&&fs.LayerManager.checkDisComplete()?e.changeFSM():(e.FSM.switch=!1,console.warn("初始化棋盘存在可消除元素，已关闭状态机。"))),e.FSM.state=="waitUser",e.FSM.state=="waitMapAction"&&(!fs.DisFactory.checkElement(!0)&&fs.LayerManager.checkDisComplete()?fs.DisFactory.actionAutoDoSkill()||(fs.PopManager.playComboAnimation(e.comboCount),e.comboCount=0,e.changeFSM(),fs.ConveyorLayer.move()):fs.DisFactory.checkElement()),e.FSM.state=="mapAction",e.FSM.state=="waitTileAction"&&(!fs.DisFactory.checkElement(!0)&&fs.LayerManager.checkDisComplete()?(e.changeFSM(),fs.LayerManager.tileAction()):fs.DisFactory.checkElement()),e.FSM.state=="tileAction",e.FSM.state=="waitActorAction"&&(!fs.DisFactory.checkElement(!0)&&fs.LayerManager.checkDisComplete()?e.changeFSM():fs.DisFactory.checkElement()),e.FSM.state=="actorAction"&&(qc.N("tempScoreText").text=fs.ScenesUI.gameScore.toString(),fs.ScenesUI.scorePanelControl(),fs.ScenesUI.checkIsBoringDis(fs.ScenesUI.isTargetDis),fs.ScenesUI.boringLogic(),fs.BossSkill.bossSkillLogic())}};var g=qc.fs.CowTile={};g.doAction=function(e,t,n,r){var i=this;if(t=="action_round"||t=="action_skill"||t=="action_props")return i.sendTaskData(),i.moo(),i.setDelFlag(!1),!0},g.moo=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);e.explode.visible=!0,e.explode.playAnimation(e.playExplode),e.explode.onFinished.addOnce(function(){e.explode.visible=!1}),e.icon_ani.onFinished.addOnce(function(){}),e.icon_ani.playAnimation("animation2"),fs.AudioManager.playSound(64)};var y=qc.defineBehaviour("qc.engine.levelManger",qc.Behaviour,function(){var e=this;fs.levelManger=e,e.levelNumber=0},{levelNodes:qc.Serializer.NODES});y.prototype.awake=function(){var e=this;e.levelNodes.forEach(function(t){e.addListener(t.onClick,e.onItemClick,e)})},y.prototype.onItemClick=function(e){var t=this;t.levelNumber=parseInt(e.name),fs.Game.scene.load("fight",!0,function(){console.log("Start loading assets.")},function(){console.log("Loaded ok.")})};var b=qc.defineBehaviour("qc.engine.PageControl",qc.Behaviour,function(){var e=this;e.pageCount=1},{nextButton:qc.Serializer.NODE,preButton:qc.Serializer.NODE,page1:qc.Serializer.NODE,page2:qc.Serializer.NODE});b.prototype.awake=function(){var e=this;e.preButton.visible=!1,e.addListener(e.nextButton.onClick,e.nextButtonClick,e),e.addListener(e.preButton.onClick,e.preButtonClick,e)},b.prototype.nextButtonClick=function(){var e=this;e.page1.visible=!1,e.page2.visible=!0,e.pageCount=2,e.nextButton.visible=!1,e.preButton.visible=!0,console.log(e.pageCount)},b.prototype.preButtonClick=function(){var e=this;e.page1.visible=!0,e.page2.visible=!1,e.pageCount=1,e.preButton.visible=!1,e.nextButton.visible=!0,console.log(e.pageCount)};var w=qc.defineBehaviour("qc.engine.plus",qc.Behaviour,function(){},{});w.prototype.onClick=function(){var e=this;e.level=fs.ConfigManager.levelId,fs.ConfigManager.excelData.zone[e.level].step++};var E=qc.defineBehaviour("qc.engine.step",qc.Behaviour,function(){},{});E.prototype.onEnable=function(){var e=this;fs.ConfigManager.getLevelConfig(e.show)},E.prototype.show=function(e){console.dir(e)},E.prototype.getStep=function(){var e=this;e.level=fs.ConfigManager.levelId,e.step=fs.ConfigManager.excelData.zone[e.level].step,e.gameObject.text=""+e.step};var S=qc.defineBehaviour("qc.engine.target",qc.Behaviour,function(){},{});S.prototype.onEnable=function(){var e=this,t=fs.ConfigManager.levelId,n=fs.ConfigManager.excelData.zone[t].background;e.gameObject.text=""+n};var x=qc.fs.BaseLayer={};x.isCanSwap=function(e,t){var n;switch(t){case"up":n=e-fs.ConfigManager.colunm;break;case"down":n=e+fs.ConfigManager.colunm;break;case"left":n=e-1;break;case"right":n=e+1;break;default:}return e<9&&t=="up"?!1:e>62&&(t=="down"||t=="left_down"||t=="right_down")?!1:e%9!=0||t!="left"&&t!="left_down"?e%9!=8||t!="right"&&t!="right_down"?fs.ConfigManager.levelData.layers[0].data[e]==1||fs.ConfigManager.levelData.layers[0].data[n]==1?!1:fs.LayerManager.tilesList.aboveElement[e]!=null&&!fs.LayerManager.tilesList.aboveElement[e].isSwap||fs.LayerManager.tilesList.aboveElement[n]!=null&&!fs.LayerManager.tilesList.aboveElement[n].isSwap?!1:!0:!1:!1},x.hasCanRemoveGeneralTile=function(e){var t=fs.LayerManager.tilesList.element[e],n=fs.LayerManager.tilesList.aboveElement[e];return t==null?!1:n==null?!0:!1},x.isBinded=function(e){var t=fs.LayerManager.tilesList.aboveElement[e];return t!=null&&!t.isSwap?!0:!1},x.hasCross=function(e){var t=this;for(var r in fs.LayerManager.generator)if(e+fs.ConfigManager.colunm==r)return!1;var i=e;while(i>=0){var s=fs.LayerManager.tilesList.element[i];if(s!=null&&!s.isCross&&s.canSwapByDirection!=n){if(!s.canSwapByDirection("down")){var o=e,u=!1;while(o!=i){for(var r in fs.LayerManager.generator)if(o==r){u=!0;break}o-=fs.ConfigManager.colunm}if(u)return!1;var o=e;while(o!=i){var a=fs.LayerManager.tilesList.portal[o];if(a!=null&&a.id==2602)return t.hasSourcePortal(o,e);o-=fs.ConfigManager.colunm}return!0}return!1}i-=fs.ConfigManager.colunm}var f=e;while(f>=0){for(var r in fs.LayerManager.generator)if(f==r)return!1;f-=fs.ConfigManager.colunm}var f=e;while(f>=0){var a=fs.LayerManager.tilesList.portal[f];if(a!=null&&a.id==2602)return t.hasSourcePortal(f,e);f-=fs.ConfigManager.colunm}return!0},x.hasSourcePortal=function(e,t){var r=this,i=null,s=null;for(var o=0,u=fs.LayerManager.wormholeData.length;o<u;o++){var a=fs.LayerManager.wormholeData[o];a.hasOwnProperty("transferPosition")&&a.transferPosition==e&&(i=fs.LayerManager.tilesList.element[a.index],s=a.index)}if(i!=null){if(r.isBinded(s))return!0;if(i!=null&&i.isSwap){var f=t;while(f!=e){var l=fs.LayerManager.tilesList.element[f];if(l!=null&&l.canSwapByDirection!=n&&!l.canSwapByDirection("down"))return!0;f-=fs.ConfigManager.colunm}return!1}return!0}return!0},x.sortNumber=function(e,t){return e-t},x.getTileIDByColor=function(e){for(var t in fs.ConfigManager.excelData.tiles){var n=fs.ConfigManager.excelData.tiles[t];if(n.class1=="base"&&n.color==e)return n.id}},x.getDoubleSkillType=function(e,t){var n="";return e!="horizon"&&e!="vertical"||t!="horizon"&&t!="vertical"?(e=="horizon"||e=="vertical")&&t=="jelly"||(t=="horizon"||t=="vertical")&&e=="jelly"?n="SKILL_HV_JELLY":(e=="horizon"||e=="vertical")&&t=="rainbow"||(t=="horizon"||t=="vertical")&&e=="rainbow"?n="SKILL_HV_RAINBOW":(e=="horizon"||e=="vertical")&&t=="magnet"||(t=="horizon"||t=="vertical")&&e=="magnet"?n="SKILL_HV_MAGNET":(e=="horizon"||e=="vertical")&&t=="xx"||(t=="horizon"||t=="vertical")&&e=="xx"?n="SKILL_HV_XBOMB":e=="xx"&&t=="jelly"||t=="xx"&&e=="jelly"?n="SKILL_XBOMB_JELLY":e=="xx"&&t=="rainbow"||t=="xx"&&e=="rainbow"?n="SKILL_XBOMB_RAINBOW":e=="xx"&&t=="magnet"||t=="xx"&&e=="magnet"?n="SKILL_XBOMB_MAGNET":e=="xx"&&t=="xx"?n="SKILL_XBOMB_XBOMB":e=="jelly"&&t=="jelly"?n="SKILL_JELLY_JELLY":e=="jelly"&&t=="jelly"?n="SKILL_JELLY_JELLY":e=="jelly"&&t=="rainbow"||t=="jelly"&&e=="rainbow"?n="SKILL_JELLY_RAINBOW":e=="jelly"&&t=="magnet"||t=="jelly"&&e=="magnet"?n="SKILL_JELLY_MAGNET":e=="rainbow"&&t=="rainbow"?n="SKILL_RAINBOW_RAINBOW":e=="magnet"&&t=="rainbow"||t=="magnet"&&e=="rainbow"?n="SKILL_RAINBOW_MAGNET":e=="rainbow"&&t=="rainbow"?n="SKILL_RAINBOW_RAINBOW":e=="magnet"&&t=="magnet"&&(n="SKILL_MAGNET_MAGNET"):n="SKILL_HORIZON_VERTICAL",n},x.getRangeBorder=function(e){var t=fs.CommonLayer.getRowColunm(e);return[t[0],7-t[0],t[1],8-t[1]]},x.getRoundPosArray=function(e,t,n){var r=1,i=!0,s=[],o=fs.BaseLayer.getRangeBorder(e),u=function(e,t){var n=fs.BaseLayer.getRangeBorder(e);return t=="up"&&o[0]-n[0]==r?!0:t=="right"&&n[2]-o[2]==r?!0:t=="down"&&n[0]-o[0]==r?!0:t=="left"&&n[3]-o[3]==r?!0:!1},a=function(e,r){if(t==s.length)return;if(!u(e,r))return;n(e)&&s.push(e)};while(r<=8&&i){for(var f=0;f<r*2;f++){var l=e-10*r+f;a(l,"up")}for(var f=0;f<r*2;f++){var l=e-8*r+f*9;a(l,"right")}for(var f=0;f<r*2;f++){var l=e+10*r-f;a(l,"down")}for(var f=0;f<r*2;f++){var l=e+8*r-f*9;a(l,"left")}t==s.length&&(i=!1),r++}return s},x.getSkillTileID=function(e,t,n){var r=fs.ConfigManager.excelData.tiles;if(n){var i=["horizon","vertical"],s=fs.Game.math.random(0,i.length-1);t=i[s]}if(t=="rainbow")return 1031;if(t=="magnet")return 1032;for(var o in r)if(r[o].color==e&&r[o].class3==t)return r[o].id},x.getSkillPosition=function(e,t,n){var r=this,i,s=fs.ConfigManager.row*fs.ConfigManager.colunm,o=[];t=t.sort(fs.BaseLayer.sortNumber),i=t[0];if(n){for(var u=0;u<s;u++){var a=fs.LayerManager.tilesList.element[u];if(a!=null&&!a.delFlag&&a.color==e&&a.class1=="base"&&r.hasCanRemoveGeneralTile(u)){var f=!1;t.forEach(function(e){e==u&&(f=!0)}),f||o.push(u)}}if(o.length){var l=fs.Game.math.random(0,o.length-1);i=o[l]}else{var f=!0,c=!1;while(f){var l=fs.Game.math.random(0,s-1);t.forEach(function(e){e==l&&(c=!0)});if(!c){var a=fs.LayerManager.tilesList.element[l];a!=null&&!a.delFlag&&a.class1=="base"&&r.hasCanRemoveGeneralTile(l)&&(i=l,f=!1)}else c=!1}}}else t.forEach(function(e){if(e==fs.LayerManager.skillPos[0]||e==fs.LayerManager.skillPos[1])i=e});return[i]},x.makeSkill=function(e,t,n,r,i,s){var o=this,u={tileID:e},a=t[0];if(i){a=fs.BaseLayer.getSkillPosition(n,r,!0)[0];var f=fs.LayerManager.tilesList.element[a];f.setDelFlag(!0),o.rocketFlyAnimation(s,a,f,u,e)}else{e==1031?fs.AudioManager.playSound(17):e==1032?fs.AudioManager.playSound(20):e>=1025&&e<=1030||e==1035?fs.AudioManager.playSound(18):e>=1007&&e<=1012||e>=1013&&e<=1018?fs.AudioManager.playSound(19):(e>=1019&&e<=1024||e==1034)&&fs.AudioManager.playSound(22),t.forEach(function(e,t){var n=fs.TileFactory.buildTile(e,u,"element");fs.LayerManager.tilesList.element[e]=n});if(e!=1104){var l=fs.LayerManager.tilesList.element[a];l.playMakeSkill()}}},x.getRangePos=function(e){var t=this,n=[];return e.forEach(function(r){var i=fs.CommonLayer.getRowColunm(r);[r-9,r+9,r-1,r+1].forEach(function(s,o){var u=fs.LayerManager.tilesList.element[s];if(u==null||u.delFlag||!t.hasCanRemoveGeneralTile(s))return;if(e.indexOf(s)!=-1)return;o==0&&r>8&&n.push(s),o==1&&r<63&&n.push(s),o==2&&i[1]>0&&n.push(s),o==3&&i[1]<8&&n.push(s)})}),n},x.rocketFlyAnimation=function(e,t,n,r,i){var s=this;fs.GameManager.stop();var o=fs.Game.add.clone(fs.LayerManager.rocketPrefab,qc.N("element"));o.x=fs.CommonLayer.pivotX(e),o.y=fs.CommonLayer.pivotY(e),fs.AudioManager.playSound(21);var u=o.getScript("qc.TweenPosition");u.from=new qc.Point(o.x,o.y),u.to=new qc.Point(fs.CommonLayer.pivotX(t),fs.CommonLayer.pivotY(t)),u.duration=.5;var a=s.rocketRotate(e,t);o.rotation=a*Math.PI/180,u.onFinished.addOnce(function(){o.destroy(),fs.TilePool.recoverTile(n),fs.LayerManager.tilesList.element[t]=null;var e=fs.TileFactory.buildTile(t,r,"element");fs.LayerManager.tilesList.element[t]=e;if(i!=1104){var s=fs.LayerManager.tilesList.element[t];s.playMakeSkill()}fs.GameManager.start()}),u.resetToBeginning(),u.playForward(),fs.AudioManager.playSound(95)},x.rocketRotate=function(e,t){var n=fs.CommonLayer.pivotX(e),r=fs.CommonLayer.pivotY(e),i=fs.CommonLayer.pivotX(t),s=fs.CommonLayer.pivotY(t);if(r>s&&n==i)return o=270,o;if(r<s&&n==i)return o=90,o;var o=Math.atan(Math.abs(s-r)/(i-n))*180/Math.PI;return r==s&&n<i?o:i>n&&s>r?o:i>n&&s<r?-o:i<n&&s>r?o-180:180-o};var T=qc.fs.CommonLayer={};T.DropPoint=[1,2,3],T.getPopsicle=function(){var e=this,t=["popsicle","popsicle1","popsicle2"],n=fs.Game.math.random(0,t.length-1);return t[n]},T.getTmxPro=function(e){var t=null;return e<1001?fs.ConfigManager.levelData.tilesets.forEach(function(n,r){n.firstgid==e&&(t=n.tileproperties[0])}):fs.ConfigManager.levelData.tilesets.forEach(function(n,r){n.tileproperties[0].tileID==e&&(t=n.tileproperties[0])}),t},T.getUrlParam=function(t){var n=e.location.search.substring(1),r=n.split("&");for(var i=0,s=r.length;i<s;i++){var o=r[i];if(o.indexOf(t)!=-1){var u=o.split("=");return+u[1]}}return!1},T.pivotX=function(e){var t=e%fs.ConfigManager.colunm*fs.ConfigManager.gridW+40;return t},T.pivotY=function(e){var t=fs.Game.math.floorTo(e/fs.ConfigManager.colunm)*fs.ConfigManager.gridH+40;return t},T.colPivotX=function(e){var t=e*fs.ConfigManager.gridH+40;return t},T.rowPivotY=function(e){var t=e*fs.ConfigManager.gridW+40;return t},T.getIndexFromRowAndCol=function(e,t){var n=this,r=n.colPivotX(e),i=n.rowPivotY(t),s=n.getIndex(r,i);return s},T.getIndex=function(e,t){var n=this,r=fs.ConfigManager.colunm,i=fs.Game.math.floorTo(e/fs.ConfigManager.gridW),s=fs.Game.math.floorTo(t/fs.ConfigManager.gridH);return s*r+i},T.getRowColunm=function(e){var t=fs.Game.math.floorTo(e/9),n=fs.Game.math.floorTo(e%9);return[t,n]},T.getObjectLength=function(e){var t=0,n;for(n in e)e.hasOwnProperty(n)&&t++;return t},T.getRelation=function(e,t){var n=this,r=fs.ConfigManager.colunm,i=e%r,s=fs.Game.math.floorTo(e/r),o=t%r,u=fs.Game.math.floorTo(t/r);if(i+1===o&&s===u)return"left";if(i-1===o&&s===u)return"right";if(i===o&&s+1===u)return"top";if(i===o&&s-1===u)return"bottom"},T.getSwapData=function(e,t){var n=fs.LayerManager.tilesList.element.concat(),r=n[e];return n[e]=n[t],n[t]=r,n},T.removeDuplicateArray=function(e){var t=[];for(var n=0;n<e.length;n++)t.indexOf(e[n])==-1&&t.push(e[n]);return t},T.transformIDtoColor=function(e){if(e==null)return 0;var t=fs.ConfigManager.excelData.tiles[e].color;return t!=null&&t!=n?t:0},T.hasInBorder=function(e,t){var n=fs.CommonLayer.getRowColunm(t);if(e=="row"){if(n[0]==0||n[0]==7)return!0}else if(e=="col"){if(n[1]==0||n[1]==8)return!0}else if(e=="full")if(n[0]==0||n[0]==7||n[1]==0||n[1]==8)return!0;return!1};var N=fs.ConveyorLayer={};N.specialTransferPosition=[],N.transformPosition=[],N.transformAboveLayer=[],N.transformBelowLayer=[],N.move=function(){var e=this;e.getSpecialConveyorPosition(),e.transformElement=e.getElementConveyorPosition(),e.transformAboveLayer=e.getAboveLayerConveyorPosition(),e.transformBelowLayer=e.getBelowLayerConveyorPosition();if(e.transformElement.length==0){fs.GameManager.changeFSM();return}e.doTransPosition(e.transformElement,"element"),e.doTransPosition(e.transformAboveLayer,"aboveElement"),e.doTransPosition(e.transformBelowLayer,"belowElement"),e.conveyorTimer=fs.Game.timer.loop(100,fs.ConveyorLayer.hasMoveComplete.bind(e))},N.hasMoveComplete=function(){var e=this,t=!1;for(var n=0,r=e.transformElement.length;n<r;n++){var i=e.transformElement[n].element;if(i==null)continue;if(i.moveFlag){t=!0;break}}if(e.transformBelowLayer.length>0)for(var n=0,r=e.transformBelowLayer.length;n<r;n++){var i=e.transformBelowLayer[n].element;if(i==null)continue;if(i.moveFlag){t=!0;break}}t||(fs.Game.timer.remove(e.conveyorTimer),fs.GameManager.changeFSM())},N.getSpecialConveyorPosition=function(){var e=this,t={},r=fs.LayerManager.tilesList.terrain,i=[];for(var s=0;s<e.specialTransferPosition.length;s++){if(e.specialTransferPosition[s]!=n&&e.specialTransferPosition[s].transferPosition!=n)var o=e.specialTransferPosition[s].transferPosition.split(","),u=fs.CommonLayer.getIndexFromRowAndCol(parseInt(o[0])-1,parseInt(o[1])-1);else var u=null;var a={id:e.specialTransferPosition[s].tileID,specialIndex:u,index:e.specialTransferPosition[s].index};i.push(a)}e.transformPosition=i},N.getElementConveyorPosition=function(){var e=this,t=fs.LayerManager.tilesList.element,n=[];for(var r=0;r<t.length;r++)for(var i=0;i<N.transformPosition.length;i++)if(N.transformPosition[i]&&N.transformPosition[i].index==r){var s={};s.element=t[r],s.index=r,n.push(s)}return n},N.getAboveLayerConveyorPosition=function(){var e=this,t=fs.LayerManager.tilesList.aboveElement,n=[];for(var r=0;r<t.length;r++)for(var i=0;i<N.transformPosition.length;i++)if(N.transformPosition[i]&&N.transformPosition[i].index==r){var s={};s.element=t[r],s.index=r,n.push(s)}return n},N.getBelowLayerConveyorPosition=function(){var e=this,t=fs.LayerManager.tilesList.belowElement,n=[];for(var r=0;r<t.length;r++)for(var i=0;i<N.transformPosition.length;i++)if(N.transformPosition[i]&&N.transformPosition[i].index==r){var s={};s.element=t[r],s.index=r,n.push(s)}return n},N.doTransPosition=function(e,t){var n=this;for(var r=0;r<e.length;r++)n.getTransDirection(e[r].index,e[r],t)},N.getTransDirection=function(e,t,n){var r=this;for(var i=0;i<r.transformPosition.length;i++)r.transformPosition[i].index==e&&(r.transformPosition[i].id!="2104"&&r.transformPosition[i].id!="2102"&&r.transformPosition[i].id!="2111"||r.transformPosition[i].specialIndex!=null?(r.transformPosition[i].id=="2104"||r.transformPosition[i].id=="2102"||r.transformPosition[i].id=="2111")&&r.transformPosition[i].specialIndex!=null&&r.moveDirection("left",t,r.transformPosition[i].specialIndex,n):r.moveDirection("left",t,null,n),r.transformPosition[i].id!="2103"&&r.transformPosition[i].id!="2107"&&r.transformPosition[i].id!="2112"||r.transformPosition[i].specialIndex!=null?(r.transformPosition[i].id=="2103"||r.transformPosition[i].id=="2107"||r.transformPosition[i].id=="2112")&&r.transformPosition[i].specialIndex!=null&&r.moveDirection("right",t,r.transformPosition[i].specialIndex,n):r.moveDirection("right",t,null,n),r.transformPosition[i].id!="2106"&&r.transformPosition[i].id!="2109"&&r.transformPosition[i].id!="2110"||r.transformPosition[i].specialIndex!=null?(r.transformPosition[i].id=="2106"||r.transformPosition[i].id=="2109"||r.transformPosition[i].id=="2110")&&r.transformPosition[i].specialIndex!=null&&r.moveDirection("top",t,r.transformPosition[i].specialIndex,n):r.moveDirection("top",t,null,n),r.transformPosition[i].id!="2101"&&r.transformPosition[i].id!="2105"&&r.transformPosition[i].id!="2108"||r.transformPosition[i].specialIndex!=null?(r.transformPosition[i].id=="2101"||r.transformPosition[i].id=="2105"||r.transformPosition[i].id=="2108")&&r.transformPosition[i].specialIndex!=null&&r.moveDirection("bottom",t,r.transformPosition[i].specialIndex,n):r.moveDirection("bottom",t,null,n))},N.moveDirection=function(e,t,n,r){var i=this,s=fs.LayerManager.tilesList[r];if(e=="left")if(t.index!=null&&n==null){if(t.element==null){t.index-=1,s[t.index]=t.element;return}t.element.setMoveFlag(!0),t.index-=1;var o=t.element.gameObject.x,u=t.element.gameObject.y,a=t.element.gameObject.getScript("qc.TweenPosition");t.element.gameObject.x=fs.CommonLayer.pivotX(t.index),t.element.gameObject.y=fs.CommonLayer.pivotY(t.index),s[t.index]=t.element,a.from=new qc.Point(o,u),a.to=new qc.Point(t.element.gameObject.x,t.element.gameObject.y),a.duration=.1,a.resetToBeginning(),a.playForward(),a.onFinished.addOnce(function(){t.element.setMoveFlag(!1)})}else if(n!=null){if(t.element==null){t.index=n,s[t.index]=t.element;return}t.element.setMoveFlag(!0),t.index=n,t.element.gameObject.x=fs.CommonLayer.pivotX(t.index),t.element.gameObject.y=fs.CommonLayer.pivotY(t.index),s[t.index]=t.element,t.element.setMoveFlag(!1)}if(e=="right")if(t.index!=null&&n==null){if(t.element==null){t.index+=1,s[t.index]=t.element;return}t.element.setMoveFlag(!0),t.index+=1;var o=t.element.gameObject.x,u=t.element.gameObject.y,a=t.element.gameObject.getScript("qc.TweenPosition");t.element.gameObject.x=fs.CommonLayer.pivotX(t.index),t.element.gameObject.y=fs.CommonLayer.pivotY(t.index),s[t.index]=t.element,a.from=new qc.Point(o,u),a.to=new qc.Point(t.element.gameObject.x,t.element.gameObject.y),a.duration=.1,a.resetToBeginning(),a.playForward(),a.onFinished.addOnce(function(){t.element.setMoveFlag(!1)})}else if(n!=null){if(t.element==null){t.index=n,s[t.index]=t.element;return}t.element.setMoveFlag(!0),t.index=n,t.element.gameObject.x=fs.CommonLayer.pivotX(t.index),t.element.gameObject.y=fs.CommonLayer.pivotY(t.index),s[t.index]=t.element,t.element.setMoveFlag(!1)}if(e=="top")if(t.index!=null&&n==null){if(t.element==null){t.index-=9,s[t.index]=t.element;return}t.element.setMoveFlag(!0),t.index-=9;var o=t.element.gameObject.x,u=t.element.gameObject.y,a=t.element.gameObject.getScript("qc.TweenPosition");t.element.gameObject.x=fs.CommonLayer.pivotX(t.index),t.element.gameObject.y=fs.CommonLayer.pivotY(t.index),s[t.index]=t.element,a.from=new qc.Point(o,u),a.to=new qc.Point(t.element.gameObject.x,t.element.gameObject.y),a.duration=.1,a.resetToBeginning(),a.playForward(),a.onFinished.addOnce(function(){t.element.setMoveFlag(!1)})}else if(n!=null){if(t.element==null){t.index=n,s[t.index]=t.element;return}t.element.setMoveFlag(!0),t.index=n,t.element.gameObject.x=fs.CommonLayer.pivotX(t.index),t.element.gameObject.y=fs.CommonLayer.pivotY(t.index),s[t.index]=t.element,t.element.setMoveFlag(!1)}if(e=="bottom")if(t.index!=null&&n==null){if(t.element==null){t.index+=9,s[t.index]=t.element;return}t.element.setMoveFlag(!0),t.index+=9;var o=t.element.gameObject.x,u=t.element.gameObject.y,a=t.element.gameObject.getScript("qc.TweenPosition");t.element.gameObject.x=fs.CommonLayer.pivotX(t.index),t.element.gameObject.y=fs.CommonLayer.pivotY(t.index),s[t.index]=t.element,a.from=new qc.Point(o,u),a.to=new qc.Point(t.element.gameObject.x,t.element.gameObject.y),a.duration=.1,a.resetToBeginning(),a.playForward(),a.onFinished.addOnce(function(){t.element.setMoveFlag(!1)})}else if(n!=null){if(t.element==null){t.index=n,s[t.index]=t.element;return}t.element.setMoveFlag(!0),t.index=n,t.element.gameObject.x=fs.CommonLayer.pivotX(t.index),t.element.gameObject.y=fs.CommonLayer.pivotY(t.index),s[t.index]=t.element,t.element.setMoveFlag(!1)}};var C=qc.fs.DisFactory={};C.waitRemoveNum=0,C.rebuildTimesCount=0,C.autoDoSkillArray=[],C.actionAutoDoSkill=function(){var e=this,t=null,n=e.autoDoSkillArray.length;if(n==0)return!1;var r=fs.Game.math.random(0,n-1);t=e.autoDoSkillArray[r];if(!t.delFlag){var i=fs.CommonLayer.getIndex(t.gameObject.x,t.gameObject.y);t.setDelFlag(!0),fs.LayerManager.layerPropagation(i,t.color,"action_skill")}return e.autoDoSkillArray.splice(r,1),!0},C.disappear=function(e){fs.GameManager.isMainLogicSwitch=!1;var t=e.color,r=e.pos,i=e.skillID,s=e.skillPos,o=e.isSquare,u=fs.LayerManager.tilesList.element;for(var a=0;a<72;a++)for(var f=0;f<r.length;f++)a==r[f]&&"disCount"in u[a]&&(u[a].disCount=r.length);var l=0,c=r.length;fs.DisFactory.waitRemoveNum+=c;var h=s?s[0]:n;for(var f in r){var p=r[f],d=fs.LayerManager.tilesList.element[p],v=function(){var e=i||null;l++,fs.DisFactory.waitRemoveNum--,i==n&&fs.LayerManager.layerPropagation(p,t,"action_self",e,c);if(l==c){if(i!=n){for(var u in r){var a=r[u];fs.LayerManager.layerPropagation(a,t,"action_self",e,c)}fs.BaseLayer.makeSkill(i,s,t,r,o,h)}var f=fs.BaseLayer.getRangePos(r);for(var d in f){var v=f[d],m=fs.LayerManager.tilesList.element[v];m!=null&&m.hasOwnProperty("delFlag")&&!m.delFlag&&fs.LayerManager.layerPropagation(v,t,"action_round",e)}fs.DisFactory.waitRemoveNum==0&&(fs.GameManager.comboCount==1?fs.AudioManager.playSound(1):fs.GameManager.comboCount==2?fs.AudioManager.playSound(2):fs.AudioManager.playSound(3),fs.Game.timer.add(350,function(){fs.GameManager.isMainLogicSwitch=!0}))}};i!=n&&(i==1104||i>=1007&&i<=1018)?d.moveSkill(h,v):v()}},C.checkElement=function(e,t){var n=t||fs.LayerManager.tilesList.element,r=fs.DisFactory.getLinkPosition(n),i=fs.DisFactory.getShape(r);if(e)return i.length<=0?!1:!0;if(i.length>0){for(var s=0,o=i.length;s<o;s++){var u=i[s].pos;for(var a=0,f=u.length;a<f;a++){var l=fs.LayerManager.tilesList.element[u[a]];l.setDelFlag(!0)}}for(var s in i)fs.DisFactory.disappear(i[s])}},C.getShape=function(e){var t=[],n=e[0],r=e[1],i=e[2];return n.forEach(function(e,n){var s=r[n],o={},u=[],a=[],f=[],l=[],c=[],h=[],p=[],d=[],v=[],m=function(t,n){return n?e.length>t.length?!0:!1:(e.length>t.length&&(e.forEach(function(e,n){t.indexOf(e)==-1&&(o[n]=e)}),s.forEach(function(e,n){if(o.hasOwnProperty(n))if(e.hc>=3||e.vc>=3)t.push(o[n]);else if(e.hc==2&&e.vc==2){var r=0,s=0,u=0,a=0,f=o[n],n=fs.CommonLayer.getRowColunm(o[n]);[f-9,f-9-1,f-1].forEach(function(e){var t=fs.CommonLayer.getRowColunm(e);i[t[0]]&&i[t[0]][t[1]].color==i[n[0]][n[1]].color&&r++}),[f-9,f-9+1,f+1].forEach(function(e){var t=fs.CommonLayer.getRowColunm(e);i[t[0]]&&i[t[0]][t[1]].color==i[n[0]][n[1]].color&&s++}),[f-1,f+9-1,f+9].forEach(function(e){var t=fs.CommonLayer.getRowColunm(e);i[t[0]]&&i[t[0]][t[1]].color==i[n[0]][n[1]].color&&u++}),[f+1,f+9+1,f+9].forEach(function(e){var t=fs.CommonLayer.getRowColunm(e);i[t[0]]&&i[t[0]][t[1]].color==i[n[0]][n[1]].color&&a++}),(r==3||s==3||u==3||a==3)&&t.push(f)}})),t)},g=function(t){t=t.sort(fs.BaseLayer.sortNumber),e.forEach(function(e,n){t.indexOf(e)==-1&&(o[n]=e)});for(var n in o)if(o[n]+9==t[2]||o[n]-9==t[2]||o[n]+1==t[2]||o[n]-1==t[2])return t.push(o[n]),[!0,t];return[!1,t]};e.forEach(function(e,t){(s[t].hc>=6||s[t].vc>=6)&&a.push(e)});if(a.length>0){var u=m(a),y=fs.DisFactory.getDisResult(s[0].color,u,!1,"magnet");t.push(y),fs.Game.log.trace("磁铁: {0}",u);return}e.forEach(function(e,t){(s[t].hc==5||s[t].vc==5)&&f.push(e)});if(f.length>0){if(m(f,!0)){var b=g(f);if(b[0]){var u=m(b[1]),y=fs.DisFactory.getDisResult(s[0].color,u,!1,"magnet");t.push(y),fs.Game.log.trace("磁铁: {0}",u);return}var u=m(f),y=fs.DisFactory.getDisResult(s[0].color,u,!1,"rainbow");t.push(y),fs.Game.log.trace("彩虹: {0}",u);return}var y=fs.DisFactory.getDisResult(s[0].color,f,!1,"rainbow");t.push(y),fs.Game.log.trace("彩虹: {0}",f);return}var w;e.forEach(function(e,t){s[t].hc<=4&&s[t].hc>=3&&s[t].vc<=4&&s[t].vc>=3&&(w=e),s[t].hc<=4&&s[t].hc>=3&&d.push(e),s[t].vc<=4&&s[t].vc>=3&&v.push(e),(s[t].hc<=4&&s[t].hc>=3||s[t].vc<=4&&s[t].vc>=3)&&l.push(e)});if(w){var E=d.length-1,S=v.length-1;d=d.sort(fs.BaseLayer.sortNumber),v=v.sort(fs.BaseLayer.sortNumber);if(w==d[E]&&w==v[S]||w==d[0]&&w==v[S]||w==d[E]&&w==v[0]||w==d[0]&&w==v[0]){var u=m(l),y=fs.DisFactory.getDisResult(s[0].color,u,!1,"jelly");t.push(y),fs.Game.log.trace("L形: {0}",u);return}var u=m(l),y=fs.DisFactory.getDisResult(s[0].color,u,!1,"xx");t.push(y),fs.Game.log.trace("T形: {0}",u);return}var x=[];e.forEach(function(e,t){s[t].hc>=2&&s[t].vc>=2&&x.push(e)});if(x.length>=4){x=x.sort(fs.BaseLayer.sortNumber);var T=x.slice(0,4),N=T.reduce(function(e,t,n,r){return e+t});if(!(N%4)){var u=m(T),y=fs.DisFactory.getDisResult(s[0].color,u,!0,"randomHV");t.push(y),fs.Game.log.trace("正方形消: {0}",u);return}}e.forEach(function(e,t){s[t].vc===4&&c.push(e)});if(c.length){var u=m(c),y=fs.DisFactory.getDisResult(s[0].color,u,!1,"horizon");t.push(y),fs.Game.log.trace("竖向四消: {0}",u);return}e.forEach(function(e,t){s[t].hc===4&&h.push(e)});if(h.length){var u=m(h),y=fs.DisFactory.getDisResult(s[0].color,u,!1,"vertical");t.push(y),fs.Game.log.trace("横向四消: {0}",u);return}e.forEach(function(e,t){(s[t].hc==3||s[t].vc==3)&&p.push(e)});if(p.length){var u=m(p),y=fs.DisFactory.getDisResult(s[0].color,u,!1);t.push(y),fs.Game.log.trace("三消: {0}",u);return}}),t},C.getDisResult=function(e,t,r,i){var s={pos:t,color:e};e<=6&&i!=n&&(s.skillID=fs.BaseLayer.getSkillTileID(e,i,r),s.skillPos=fs.BaseLayer.getSkillPosition(e,t,!1),s.isSquare=r);if(e==9){s.skillID=1104,s.isSquare=!1;var o=t.slice(0);o.sort(fs.BaseLayer.sortNumber);var u=o.length-2,a=o.slice(0,u);s.skillPos=a}return s},C.getLinkPosition=function(e,t,n,r){var i,s=[],o,u,a,f,l,c,h,p,d,v,m,g,y,b,w=[[],[]],E,S=[];t=t||9,n=n||8,r=r||2;var x=function(e,n){return e*t+n};for(o=0;o<n;o++){s.push([]);for(u=0;u<t;u++){var T=e[x(o,u)]&&!e[x(o,u)].delFlag&&e[x(o,u)].isElimination?e[x(o,u)].color:null;s[o].push({color:T})}}for(o=0;o<n;o++){h=-1;for(u=0;u<=t;u++){d=s[o][u]||{},p=d.color;if(p!==h){for(a=u-1;a>=0;a--){if(s[o][a].color!==h)break;s[o][a].color!=null?s[o][a].hc=c:s[o][a].hc=1}c=1,h=p}else c++}}for(u=0;u<t;u++){h=-1;for(o=0;o<=n;o++){d=o==n?{}:s[o][u],p=d.color;if(p!==h){for(a=o-1;a>=0;a--){if(s[a][u].color!==h)break;s[a][u].color!=null?s[a][u].vc=c:s[a][u].vc=1}c=1,h=p}else c++}}for(o=0;o<n;o++)for(u=0;u<t;u++){d=s[o][u];if(d.hc<r&&d.vc<r)continue;if(d.visited)continue;i=[],E=[x(o,u)],S=[d],i.push([o,u]),d.visited=!0,f=0,l=1,p=d.color;while(f<l)v=i[f][0],m=i[f][1],f++,[[-1,0],[1,0],[0,-1],[0,1]].forEach(function(e){g=v+e[0],y=m+e[1];if(!s[g])return;if(!(b=s[g][y]))return;if(b.visited||b.color!==p||b.hc<r&&b.vc<r)return;i.push([g,y]),l++,b.visited=!0,E.push(x(g,y)),S.push(b)});E.length>2&&(w[0].push(E),w[1].push(S))}return w[2]=s,w},C.changeObjBuilder=function(e,t){var n=this;if(t=="verticalTopLeft"){var r={};return r.index=e,r.changeTarget_first=e-18,r.changeTarget_second=e-19,r}if(t=="verticalTopRight"){var r={};return r.index=e,r.changeTarget_first=e-18,r.changeTarget_second=e-17,r}if(t=="verticalBottomLeft"){var r={};return r.index=e,r.changeTarget_first=e+9,r.changeTarget_second=e+8,r}if(t=="verticalBottomRight"){var r={};return r.index=e,r.changeTarget_first=e+9,r.changeTarget_second=e+10,r}if(t=="verticalDoubleLeft"){var r={};return r.index=e,r.changeTarget_first=e-9,r.changeTarget_second=e-10,r}if(t=="verticalDoubleRight"){var r={};return r.index=e,r.changeTarget_first=e-9,r.changeTarget_second=e-8,r}if(t=="verticalTopTop"){var r={};return r.index=e,r.changeTarget_first=e-18,r.changeTarget_second=e-27,r}if(t=="verticalBottomBottom"){var r={};return r.index=e,r.changeTarget_first=e+9,r.changeTarget_second=e+18,r}if(t=="horizontalTopLeft"){var r={};return r.index=e,r.changeTarget_first=e-2,r.changeTarget_second=e-11,r}if(t=="horizontalTopRight"){var r={};return r.index=e,r.changeTarget_first=e+1,r.changeTarget_second=e-8,r}if(t=="horizontalBottomLeft"){var r={};return r.index=e,r.changeTarget_first=e-2,r.changeTarget_second=e+7,r}if(t=="horizontalBottomRight"){var r={};return r.index=e,r.changeTarget_first=e+1,r.changeTarget_second=e+10,r}if(t=="horizontalDoubleTop"){var r={};return r.index=e,r.changeTarget_first=e-1,r.changeTarget_second=e-10,r}if(t=="horizontalDoubleBottom"){var r={};return r.index=e,r.changeTarget_first=e-1,r.changeTarget_second=e+8,r}if(t=="horizontalLeftLeft"){var r={};return r.index=e,r.changeTarget_first=e-2,r.changeTarget_second=e-3,r}if(t=="horizontalRightRight"){var r={};return r.index=e,r.changeTarget_first=e+1,r.changeTarget_second=e+2,r}if(t=="skillTop"){var r={};return r.index=e,r.changeTarget_first=e,r.changeTarget_second=e-9,r}if(t=="skillBottom"){var r={};return r.index=e,r.changeTarget_first=e,r.changeTarget_second=e+9,r}if(t=="skillLeft"){var r={};return r.index=e,r.changeTarget_first=e,r.changeTarget_second=e-1,r}if(t=="skillRight"){var r={};return r.index=e,r.changeTarget_first=e,r.changeTarget_second=e+1,r}},C.checkMapDie=function(){var e=this,t=fs.LayerManager.tilesList.element,r=[];for(var i=0;i<72;i++){if(t[i]!=null&&t[i]["class1"]=="skill"){if(i<9){if(e.checkPosition(i,"skillBottom")){var s=e.changeObjBuilder(i,"skillBottom");r.push(s)}if(i%9>0&&e.checkPosition(i,"skillLeft")){var s=e.changeObjBuilder(i,"skillLeft");r.push(s)}if(i%9<8&&e.checkPosition(i,"skillRight")){var s=e.changeObjBuilder(i,"skillRight");r.push(s)}}if(i>=9&&i<63){if(e.checkPosition(i,"skillBottom")){var s=e.changeObjBuilder(i,"skillBottom");r.push(s)}if(i%9>0&&e.checkPosition(i,"skillLeft")){var s=e.changeObjBuilder(i,"skillLeft");r.push(s)}if(i%9<8&&e.checkPosition(i,"skillRight")){var s=e.changeObjBuilder(i,"skillRight");r.push(s)}if(e.checkPosition(i,"skillTop")){var s=e.changeObjBuilder(i,"skillTop");r.push(s)}}if(i>=63){if(e.checkPosition(i,"skillTop")){var s=e.changeObjBuilder(i,"skillTop");r.push(s)}if(i%9>0&&e.checkPosition(i,"skillLeft")){var s=e.changeObjBuilder(i,"skillLeft");r.push(s)}if(i%9<8&&e.checkPosition(i,"skillRight")){var s=e.changeObjBuilder(i,"skillRight");r.push(s)}}}if(i==0)continue;if(t[i]!=n&&(t[i].id<=1030||t[i].id==1101||t[i].id==1103||t[i].id==1104)){if(i>0&&i<9){if(i%9>1){if(e.checkPosition(i,"horizontalBottomLeft")){var s=e.changeObjBuilder(i,"horizontalBottomLeft");r.push(s)}if(e.checkPosition(i,"horizontalDoubleBottom")){var s=e.changeObjBuilder(i,"horizontalDoubleBottom");r.push(s)}if(i%9>2&&i%9<8&&e.checkPosition(i,"horizontalLeftLeft")){var s=e.changeObjBuilder(i,"horizontalLeftLeft");r.push(s)}}if(i%9<7&&i%9>0&&e.checkPosition(i,"horizontalRightRight")){var s=e.changeObjBuilder(i,"horizontalRightRight");r.push(s)}if(i%9<8&&e.checkPosition(i,"horizontalBottomRight")){var s=e.changeObjBuilder(i,"horizontalBottomRight");r.push(s)}}if(i>=9&&i<63){if(i%9<7&&i%9>0&&e.checkPosition(i,"horizontalRightRight")){var s=e.changeObjBuilder(i,"horizontalRightRight");r.push(s)}if(i%9>2&&e.checkPosition(i,"horizontalLeftLeft")){var s=e.changeObjBuilder(i,"horizontalLeftLeft");r.push(s)}if(i%9<8&&e.checkPosition(i,"verticalBottomRight")){var s=e.changeObjBuilder(i,"verticalBottomRight");r.push(s)}if(i%9>0&&e.checkPosition(i,"verticalBottomLeft")){var s=e.changeObjBuilder(i,"verticalBottomLeft");r.push(s)}if(i%9!=0){if(i%9<8){if(e.checkPosition(i,"horizontalBottomRight")){var s=e.changeObjBuilder(i,"horizontalBottomRight");r.push(s)}if(e.checkPosition(i,"horizontalTopRight")){var s=e.changeObjBuilder(i,"horizontalTopRight");r.push(s)}}if(i%9>1){if(e.checkPosition(i,"horizontalBottomLeft")){var s=e.changeObjBuilder(i,"horizontalBottomLeft");r.push(s)}if(e.checkPosition(i,"horizontalTopLeft")){var s=e.changeObjBuilder(i,"horizontalTopLeft");r.push(s)}if(e.checkPosition(i,"horizontalDoubleTop")){var s=e.changeObjBuilder(i,"horizontalDoubleTop");r.push(s)}if(e.checkPosition(i,"horizontalDoubleBottom")){var s=e.changeObjBuilder(i,"horizontalDoubleBottom");r.push(s)}}}if(i<=53&&e.checkPosition(i,"verticalBottomBottom")){var s=e.changeObjBuilder(i,"verticalBottomBottom");r.push(s)}if(i>17){if(i%9>0){if(i%9>1&&e.checkPosition(i,"verticalTopLeft")){var s=e.changeObjBuilder(i,"verticalTopLeft");r.push(s)}if(e.checkPosition(i,"verticalDoubleLeft")){var s=e.changeObjBuilder(i,"verticalDoubleLeft");r.push(s)}}if(i%9<8){if(i%9<8&&e.checkPosition(i,"verticalTopRight")){var s=e.changeObjBuilder(i,"verticalTopRight");r.push(s)}if(e.checkPosition(i,"verticalDoubleRight")){var s=e.changeObjBuilder(i,"verticalDoubleRight");r.push(s)}}if(i>=27&&e.checkPosition(i,"verticalTopTop")){var s=e.changeObjBuilder(i,"verticalTopTop");r.push(s)}}}if(i>=63){if(e.checkPosition(i,"verticalTopTop")){var s=e.changeObjBuilder(i,"verticalTopTop");r.push(s)}if(i%9>0){if(i%9>1){if(e.checkPosition(i,"horizontalTopLeft")){var s=e.changeObjBuilder(i,"horizontalTopLeft");r.push(s)}if(e.checkPosition(i,"horizontalDoubleTop")){var s=e.changeObjBuilder(i,"horizontalDoubleTop");r.push(s)}if(i%9>2&&i%9<8&&e.checkPosition(i,"horizontalLeftLeft")){var s=e.changeObjBuilder(i,"horizontalLeftLeft");r.push(s)}if(i%9<7&&i%9>0&&e.checkPosition(i,"horizontalRightRight")){var s=e.changeObjBuilder(i,"horizontalRightRight");r.push(s)}if(e.checkPosition(i,"verticalTopLeft")){var s=e.changeObjBuilder(i,"verticalTopLeft");r.push(s)}}if(e.checkPosition(i,"verticalDoubleLeft")){var s=e.changeObjBuilder(i,"verticalDoubleLeft");r.push(s)}}if(i%9<8){if(e.checkPosition(i,"verticalTopRight")){var s=e.changeObjBuilder(i,"verticalTopRight");r.push(s)}if(e.checkPosition(i,"verticalDoubleRight")){var s=e.changeObjBuilder(i,"verticalDoubleRight");r.push(s)}if(i%9>0&&e.checkPosition(i,"horizontalTopRight")){var s=e.changeObjBuilder(i,"horizontalTopRight");r.push(s)}}}}}var o=[];for(var u in r)!fs.BaseLayer.isBinded(r[u].changeTarget_first)&&!fs.BaseLayer.isBinded(r[u].changeTarget_second)&&o.push(r[u]);return r=o,r.length==0?(console.warn("死图了"),!0):r},C.eliminateNotice=function(e){var t=this;e=t.eliminateNoticeList;if(e===!0)return;if(fs.GameManager.FSM.state=="waitUser")if(fs.GameManager.eliminateNoticeSwitch==1){t.isgoShuffle==0&&(e=fs.Game.math.shuffle(e),t.isgoShuffle=1);var n=e[0].changeTarget_first,r=e[0].changeTarget_second,i=fs.CommonLayer.getRelation(n,r),s=fs.LayerManager.tilesList.element[n],o=fs.LayerManager.tilesList.element[r],u=2,a=function(){--u<=0&&(t.game.input.mouse.enable=!0,t.game.input.touch.enable=!0)};s!=null&&o!=null&&(i=="left"&&(s.noticeSwap("right",a),o.noticeSwap("left",a)),i=="right"&&(s.noticeSwap("left",a),o.noticeSwap("right",a)),i=="top"&&(s.noticeSwap("bottom",a),o.noticeSwap("top",a)),i=="bottom"&&(s.noticeSwap("top",a),o.noticeSwap("bottom",a)))}else t.isgoShuffle=0},C.checkPosition=function(e,t){var n=this;if(t=="verticalTopLeft")return n.verticalTopLeft(e);if(t=="verticalTopRight")return n.verticalTopRight(e);if(t=="verticalBottomLeft")return n.verticalBottomLeft(e);if(t=="verticalBottomRight")return n.verticalBottomRight(e);if(t=="verticalDoubleLeft")return n.verticalDoubleLeft(e);if(t=="verticalDoubleRight")return n.verticalDoubleRight(e);if(t=="verticalTopTop")return n.verticalTopTop(e);if(t=="verticalBottomBottom")return n.verticalBottomBottom(e);if(t=="horizontalTopLeft")return n.horizontalTopLeft(e);if(t=="horizontalTopRight")return n.horizontalTopRight(e);if(t=="horizontalBottomLeft")return n.horizontalBottomLeft(e);if(t=="horizontalBottomRight")return n.horizontalBottomRight(e);if(t=="horizontalDoubleTop")return n.horizontalDoubleTop(e);if(t=="horizontalDoubleBottom")return n.horizontalDoubleBottom(e);if(t=="horizontalLeftLeft")return n.horizontalLeftLeft(e);if(t=="horizontalRightRight")return n.horizontalRightRight(e);if(t=="skillTop")return n.skillTop(e);if(t=="skillBottom")return n.skillBottom(e);if(t=="skillLeft")return n.skillLeft(e);if(t=="skillRight")return n.skillRight(e)},C.skillTop=function(e){var t=fs.LayerManager.tilesList.element;return t[e].id==1031||t[e].id==1032?t[e-9]!=null&&t[e-9].class1=="base"?!0:!1:t[e-9]!=null&&t[e].class1==t[e-9].class1?!0:!1},C.skillBottom=function(e){var t=fs.LayerManager.tilesList.element;return t[e].id==1031||t[e].id==1032?t[e+9]!=null&&t[e+9].class1=="base"?!0:!1:t[e+9]!=null&&t[e].class1==t[e+9].class1?!0:!1},C.skillLeft=function(e){var t=fs.LayerManager.tilesList.element;return t[e].id==1031||t[e].id==1032?t[e-1]!=null&&t[e-1].class1=="base"?!0:!1:t[e-1]!=null&&t[e].class1==t[e-1].class1?!0:!1},C.skillRight=function(e){var t=fs.LayerManager.tilesList.element;return t[e].id==1031||t[e].id==1032?t[e+1]!=null&&t[e+1].class1=="base"?!0:!1:t[e+1]!=null&&t[e].class1==t[e+1].class1?!0:!1},C.verticalTopTop=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-9]==null||t[e-27]==null||t[e-18]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-9].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-27].id)&&t[e-18].isSwap==1?!0:!1:!1},C.verticalBottomBottom=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-9]==null||t[e+18]==null||t[e+9]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-9].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e+18].id)&&t[e+9].isSwap==1?!0:!1:!1},C.verticalTopLeft=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-9]==null||t[e-19]==null||t[e-18]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-9].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-19].id)&&t[e-18].isSwap==1?!0:!1:!1},C.verticalTopRight=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-9]==null||t[e-17]==null||t[e-18]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-9].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-17].id)&&t[e-18].isSwap==1?!0:!1:!1},C.verticalBottomLeft=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-9]==null||t[e+8]==null||t[e+9]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-9].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e+8].id)&&t[e+9].isSwap==1?!0:!1:!1},C.verticalBottomRight=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-9]==null||t[e+10]==null||t[e+9]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-9].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e+10].id)&&t[e+9].isSwap==1?!0:!1:!1},C.verticalDoubleLeft=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-18]==null||t[e-10]==null||t[e-9]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-18].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-10].id)&&t[e-9].isSwap==1?!0:!1:!1},C.verticalDoubleRight=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-18]==null||t[e-8]==null||t[e-9]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-18].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-8].id)&&t[e-9].isSwap==1?!0:!1:!1},C.horizontalLeftLeft=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-1]==null||t[e-3]==null||t[e-2]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-1].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-3].id)&&t[e-2].isSwap==1?!0:!1:!1},C.horizontalRightRight=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-1]==null||t[e+2]==null||t[e+1]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-1].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e+2].id)&&t[e+1].isSwap==1?!0:!1:!1},C.horizontalTopLeft=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-1]==null||t[e-2]==null||t[e-11]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-1].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-11].id)&&t[e-2].isSwap==1?!0:!1:!1},C.horizontalTopRight=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-1]==null||t[e-8]==null||t[e+1]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-1].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-8].id)&&t[e+1].isSwap==1?!0:!1:!1},C.horizontalBottomLeft=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-1]==null||t[e+7]==null||t[e-2]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-1].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e+7].id)&&t[e-2].isSwap==1?!0:!1:!1},C.horizontalBottomRight=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-1]==null||t[e+10]==null||t[e+1]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-1].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e+10].id)&&t[e+1].isSwap==1?!0:!1:!1},C.horizontalDoubleTop=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-2]==null||t[e-10]==null||t[e-1]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-2].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-10].id)&&t[e-1].isSwap==1?!0:!1:!1},C.horizontalDoubleBottom=function(e){var t=fs.LayerManager.tilesList.element;if(t[e]==null||t[e-2]==null||t[e+8]==null||t[e-1]==null)return;return fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e-2].id)?fs.CommonLayer.transformIDtoColor(t[e].id)==fs.CommonLayer.transformIDtoColor(t[e+8].id)&&t[e-1].isSwap==1?!0:!1:!1},C.dieMapRebuild=function(){var e=this,t=[].concat(fs.LayerManager.tilesList.element),n=[].concat(fs.LayerManager.tilesList.element),r=[],i=[],s=0;for(var o=0;o<72;o++){if(t[o]==null)continue;t[o].id<=1006&&fs.BaseLayer.isBinded(o)==0&&(r[s]=n[o],r[s].gameObject.x=-10,r[s].gameObject.y=-10,r[s].gameObject.alpha=0,s++,t[o]="element")}for(var u=0;u<72;u++)if(t[u]=="element"){var a=fs.Game.math.random(0,r.length-1);fs.LayerManager.tilesList.element[u]=r.splice(a,1)[0],fs.LayerManager.tilesList.element[u].gameObject.x=fs.CommonLayer.pivotX(u),fs.LayerManager.tilesList.element[u].gameObject.y=fs.CommonLayer.pivotY(u)}else fs.LayerManager.tilesList.element[u]=t[u];if(e.checkMapDie()!==!0&&e.checkElement(true)!=1)return e.rebuildTimesCount=0,fs.GameManager.eliminateNoticeList=e.checkMapDie(),console.log("新地图哦"),!0;if(e.rebuildTimesCount>10){for(var o=0;o<72;o++)t[o]=="element"?(fs.LayerManager.tilesList.element[o]=n[o],fs.LayerManager.tilesList.element[o].gameObject.x=fs.CommonLayer.pivotX(o),fs.LayerManager.tilesList.element[o].gameObject.y=fs.CommonLayer.pivotY(o)):fs.LayerManager.tilesList.element[o]=t[o];fs.TaskLogic.gameResult="fail",fs.ScenesUI.resultControl(fs.TaskLogic.gameResult)}else e.rebuildTimesCount+=1,console.warn(e.rebuildTimesCount),e.dieMapRebuild()};var k=qc.defineBehaviour("qc.engine.FightControl",qc.Behaviour,function(){var e=this;fs.FightControl=e,e.isAction=!1,e.isDragging=!1},{});k.prototype.onDragStart=function(e){var t=this;if(fs.GameManager.gamePause)return;if(t.isAction)return;var n=e.source,r=new qc.Point(n.x,n.y),i=t.gameObject.toLocal(r);t.initDragIndex=fs.CommonLayer.getIndex(i.x,i.y);if(!fs.LayerManager.tilesList.element[t.initDragIndex])return;if(!fs.LayerManager.tilesList.element[t.initDragIndex].isSwap||fs.BaseLayer.isBinded(t.initDragIndex))return;t.isDragging=!0,t.game.log.trace("开始拖拽: {0}",t.initDragIndex)},k.prototype.onDrag=function(e){var t=this;if(!t.isDragging)return;var n=e.source,r=new qc.Point(n.x,n.y),i=t.gameObject.toLocal(r),s=fs.CommonLayer.getIndex(i.x,i.y);if(!fs.LayerManager.tilesList.element[s])return;if(s==t.initDragIndex)return;if(!fs.LayerManager.tilesList.element[s].isSwap||fs.BaseLayer.isBinded(s))return;var o=fs.CommonLayer.getRelation(t.initDragIndex,s);if(!o){t.game.log.trace("强制取消拖拽: {0}",s);return}fs.LayerManager.skillPos=[s,t.initDragIndex];if(t.skillSwap(t.initDragIndex,s,!1))return;t.swapData=fs.CommonLayer.getSwapData(s,t.initDragIndex);if(!fs.DisFactory.checkElement(!0,t.swapData)){fs.AudioManager.playSound(78),t.isDragging=!1,t.isAction=!0;var u=fs.LayerManager.tilesList.element[t.initDragIndex],a=fs.LayerManager.tilesList.element[s],f=2,l=function(){--f<=0&&(t.isAction=!1,fs.GameManager.FSM.state=="waitUser"&&fs.GameManager.noticeTimeBuilder())};fs.GameManager.removeTimeBuilder(),o=="left"&&(u.cantSwap("right",l),a.cantSwap("left",l)),o=="right"&&(u.cantSwap("left",l),a.cantSwap("right",l)),o=="top"&&(u.cantSwap("bottom",l),a.cantSwap("top",l)),o=="bottom"&&(u.cantSwap("top",l),a.cantSwap("bottom",l));return}t.isDragging=!1,fs.GameManager.eliminateNoticeSwitch=!1,t.switch(s,t.initDragIndex)},k.prototype.onDragEnd=function(e){var t=this;t.game.log.trace("拖拽结束"),t.isDragging=!1},k.prototype.switch=function(e,t){var n=this,r=fs.LayerManager.tilesList.element[e],i=fs.LayerManager.tilesList.element[t];fs.AudioManager.playSound(76),n.isAction=!0;var s=2,o=function(){--s<=0&&u()},u=function(){fs.LayerManager.tilesList.element=n.swapData,n.game.log.trace("开始消除"),n.isAction=!1,fs.GameManager.removeTimeBuilder(),fs.GameManager.changeFSM()};r.move(t,o),i.move(e,o)},k.prototype.skillSwap=function(e,t,n){var r=this,i=!1,s=!1,o="";r.isDragging=!1;var u=fs.LayerManager.tilesList.element[e],a=fs.LayerManager.tilesList.element[t];if(u!=null&&a!=null){if(u.class3=="rainbow"&&(a.class1=="base"||a.class1=="skill")||a.class3=="rainbow"&&(u.class1=="base"||u.class1=="skill"))i=!0,o=u.color||a.color;else if(u.class3=="magnet"&&(a.class1=="base"||a.class1=="skill")||a.class3=="magnet"&&(u.class1=="base"||u.class1=="skill"))i=!0,o=u.color||a.color;u.class1=="skill"&&a.class1=="skill"&&(i=!0,s=!0,o=u.color||a.color)}if(i){var f=fs.CommonLayer.getSwapData(e,t);fs.LayerManager.tilesList.element=f;var l=2,c=function(){if(--l<=0){var n={};if(u.class2=="super"&&a.class2=="super")u.class3=="magnet"?(a.type="SKILL_NOTHING",u.type=fs.BaseLayer.getDoubleSkillType(u.class3,a.class3)):(u.type="SKILL_NOTHING",a.type=fs.BaseLayer.getDoubleSkillType(u.class3,a.class3)),u.class3=="rainbow"&&a.class3=="rainbow"?fs.AudioManager.playSound(94):u.class3=="magnet"&&a.class3=="magnet"?fs.AudioManager.playSound(93):(u.class3=="rainbow"&&a.class3=="magnet"||u.class3=="magnet"&&a.class3=="rainbow")&&fs.AudioManager.playSound(93),n={pos:[e,t],color:o};else if(a.class2=="super"&&u.class1=="skill"){var r=fs.BaseLayer.getRangePos([t]);for(var i in r){var s=r[i],f=fs.LayerManager.tilesList.element[s];f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&fs.LayerManager.layerPropagation(s,u.color,"action_round")}a.type=fs.BaseLayer.getDoubleSkillType(u.class3,a.class3),a.class3=="magnet"?fs.AudioManager.playSound(93):a.class3=="rainbow"&&fs.AudioManager.playSound(94),n={pos:[e],color:o}}else if(u.class2=="super"&&a.class1=="skill"){var r=fs.BaseLayer.getRangePos([e]);for(var i in r){var s=r[i],f=fs.LayerManager.tilesList.element[s];f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&fs.LayerManager.layerPropagation(s,a.color,"action_round")}u.type=fs.BaseLayer.getDoubleSkillType(u.class3,a.class3),u.class3=="magnet"?fs.AudioManager.playSound(93):u.class3=="rainbow"&&fs.AudioManager.playSound(94),n={pos:[t],color:o}}else if(u.class1=="skill"&&a.class1=="skill"){var r=fs.BaseLayer.getRangePos([e]);for(var i in r){var s=r[i],f=fs.LayerManager.tilesList.element[s];f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&fs.LayerManager.layerPropagation(s,a.color,"action_round")}u.type=fs.BaseLayer.getDoubleSkillType(u.class3,a.class3),a.type="SKILL_NOTHING",n={pos:[t],color:o}}else if(u.class1=="skill"&&a.class1=="base"){var r=fs.BaseLayer.getRangePos([e]);for(var i in r){var s=r[i],f=fs.LayerManager.tilesList.element[s];f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&fs.LayerManager.layerPropagation(s,a.color,"action_round")}u.class3=="magnet"?fs.AudioManager.playSound(93):u.class3=="rainbow"&&fs.AudioManager.playSound(94),n={pos:[t],color:o}}else if(a.class1=="skill"&&u.class1=="base"){var r=fs.BaseLayer.getRangePos([t]);for(var i in r){var s=r[i],f=fs.LayerManager.tilesList.element[s];f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&fs.LayerManager.layerPropagation(s,u.color,"action_round")}a.class3=="magnet"?fs.AudioManager.playSound(93):a.class3=="rainbow"&&fs.AudioManager.playSound(94),n={pos:[e],color:o}}fs.DisFactory.disappear(n),fs.GameManager.removeTimeBuilder(),fs.GameManager.changeFSM()}};u.move(t,c),a.move(e,c)}return i};var L=qc.defineBehaviour("qc.engine.FloorBuilder",qc.Behaviour,function(){},{});L.prototype.builder=function(){var e=this,t=0,n=fs.ConfigManager.levelData;e.width=fs.ConfigManager.gridW,e.height=fs.ConfigManager.gridH,e.row=fs.ConfigManager.row,e.colunm=fs.ConfigManager.colunm;for(var r=0;r<e.row;r++)for(j=0;j<e.colunm;j++){var i=e.game.add.node(e.gameObject);i.name="FloorTile_"+t+"",i.width=e.width,i.height=e.height,i.x=j*80,i.y=r*80,t+=1;var s=e.game.add.image(i);s.name="floorImage",s.texture=e.floorTexture;if(n.layers[0].data[t-1]==1||n.layers[0].data[t-1]==2)s.alpha=0;t%2==0?(s.frame="light_tile.png",s.resetNativeSize()):(s.frame="dark_tile.png",s.resetNativeSize())}e.borderBuilder(e,n)},L.prototype.isBorderNode=function(e,t,n){var r=[];r[n]={},r[n].index=n;if(n<=e.row*e.colunm){if(t.layers[0].data[n-1]==1||t.layers[0].data[n-1]==2)r[n].left=!0;if(t.layers[0].data[n+1]==1||t.layers[0].data[n+1]==2)r[n].right=!0}if(n>=0){if(t.layers[0].data[n+9]==1||t.layers[0].data[n+9]==2)r[n].bottom=!0;if(t.layers[0].data[n-9]==1||t.layers[0].data[n-9]==2)r[n].top=!0}return n<=8&&(r[n].top=!0),n>=e.row*e.colunm-9&&(r[n].bottom=!0),n%9==0&&(r[n].left=!0),n%9==8&&(r[n].right=!0),r[n]},L.prototype.borderImgBuilder=function(e,t,n,r){var i=this;if(n=="top"){var s=i.game.add.image(i.gameObject.getChildAt(r));s.name="top",s.texture=i.floorTexture,s.frame=t[0]+"_"+t[1]+"_"+t[2]+".png",s.resetNativeSize(),s.x=-11.4,s.y=-11.4}if(n=="left"){var s=i.game.add.image(i.gameObject.getChildAt(r));s.name="left",s.texture=i.floorTexture,s.frame=t[0]+"_"+t[1]+"_"+t[2]+".png",s.resetNativeSize(),s.x=-11.4,s.y=-11.4}if(n=="bottom"){var s=i.game.add.image(i.gameObject.getChildAt(r));s.name="bottom",s.texture=i.floorTexture,s.frame=t[0]+"_"+t[1]+"_"+t[2]+".png",s.resetNativeSize(),s.x=-11.4,s.y=80}if(n=="right"){var s=i.game.add.image(i.gameObject.getChildAt(r));s.name="right",s.texture=i.floorTexture,s.frame=t[0]+"_"+t[1]+"_"+t[2]+".png",s.resetNativeSize(),s.x=80,s.y=-11.4}},L.prototype.borderBuilder=function(e,t){var n=this;n.data=t;for(var r=0;r<e.row*e.colunm;r++)if(t.layers[0].data[r]!=1&&t.layers[0].data[r]!=2){var i=n.isBorderNode(n,n.data,r);if(i.top==1||i.bottom==1||i.left==1||i.right==1){if(i.top==1){var s=[];s[0]="top",r<=8&&(t.layers[0].data[r-1]==1||t.layers[0].data[r-1]==2?s[1]="left_corner":r%9==0?s[1]="left_corner":s[1]="top",t.layers[0].data[r+1]==1||t.layers[0].data[r+1]==2?s[2]="right_corner":r%9==8?s[2]="right_corner":s[2]="top",n.borderImgBuilder(n,s,"top",r));if(r>8&&r<e.row*e.colunm){t.layers[0].data[r-10]==1||t.layers[0].data[r-10]==2?t.layers[0].data[r-1]==1||t.layers[0].data[r-1]==2?s[1]="left_corner":s[1]="top":r%9!=0?s[1]="left_bevel":s[1]="left_corner";if(r%9!=8)t.layers[0].data[r-8]==1||t.layers[0].data[r-8]==2?t.layers[0].data[r+1]==1||t.layers[0].data[r+1]==2?s[2]="right_corner":s[2]="top":r%9!=8?s[2]="right_bevel":s[2]="right_corner";else if(t.layers[0].data[r-9]==1||t.layers[0].data[r-9]==2)s[2]="right_corner";n.borderImgBuilder(n,s,"top",r)}}if(i.left==1){var s=[];s[0]="left",r%9==0&&(t.layers[0].data[r-9]==1||t.layers[0].data[r-9]==2?s[1]="top_corner":r<=8?s[1]="top_corner":s[1]="left",t.layers[0].data[r+9]==1||t.layers[0].data[r+9]==2?s[2]="bottom_corner":r>=62?s[2]="bottom_corner":s[2]="left",n.borderImgBuilder(n,s,"left",r)),r%9!=0&&(t.layers[0].data[r-10]==1||t.layers[0].data[r-10]==2?t.layers[0].data[r-9]==1||t.layers[0].data[r-9]==2?s[1]="top_corner":s[1]="left":r<=8?s[1]="top_corner":s[1]="top_bevel",t.layers[0].data[r+8]==1||t.layers[0].data[r+8]==2?t.layers[0].data[r+9]==1||t.layers[0].data[r+9]==2?s[2]="bottom_corner":s[2]="left":r>=62?s[2]="bottom_corner":s[2]="bottom_bevel",n.borderImgBuilder(n,s,"left",r))}if(i.bottom==1){var s=[];s[0]="bottom",r>=63&&(t.layers[0].data[r-1]==1||t.layers[0].data[r-1]==2?s[1]="left_corner":r%9==0?s[1]="left_corner":s[1]="bottom",t.layers[0].data[r+1]==1||t.layers[0].data[r+1]==2?s[2]="right_corner":r%9==8?s[2]="right_corner":s[2]="bottom",n.borderImgBuilder(n,s,"bottom",r)),r<63&&(t.layers[0].data[r+8]==1||t.layers[0].data[r+8]==2?t.layers[0].data[r-1]==1||t.layers[0].data[r-1]==2?s[1]="left_corner":s[1]="bottom":r%9!=0?s[1]="left_bevel":s[1]="left_corner",t.layers[0].data[r+10]==1||t.layers[0].data[r+10]==2?t.layers[0].data[r+1]==1||t.layers[0].data[r+1]==2?s[2]="right_corner":s[2]="bottom":r%9!=8?s[2]="right_bevel":s[2]="right_corner",n.borderImgBuilder(n,s,"bottom",r))}if(i.right==1){var s=[];s[0]="right",r%9==8&&(t.layers[0].data[r-9]==1||t.layers[0].data[r-9]==2?s[1]="top_corner":r<=8?s[1]="top_corner":s[1]="right",t.layers[0].data[r+9]==1||t.layers[0].data[r+9]==2?s[2]="bottom_corner":r>=62?s[2]="bottom_corner":s[2]="right",n.borderImgBuilder(n,s,"right",r)),r%9!=8&&(t.layers[0].data[r-8]==1||t.layers[0].data[r-8]==2?t.layers[0].data[r-9]==1||t.layers[0].data[r-9]==2?s[1]="top_corner":s[1]="right":r<=8?s[1]="top_corner":s[1]="top_bevel",t.layers[0].data[r+10]==1||t.layers[0].data[r+10]==2?t.layers[0].data[r+9]==1||t.layers[0].data[r+9]==2?s[2]="bottom_corner":s[2]="right":r>=62?s[2]="bottom_corner":s[2]="bottom_bevel",n.borderImgBuilder(n,s,"right",r))}}}fs.LayerManager.isBorderReady=!0},L.prototype.init=function(){var e=this;e.floorTexture=fs.ConfigManager.UI,e.builder()};var A=fs.ActorAnimation={};A.isActorMove=!1,A.actorState=null,A.initActorAnimation=function(){var e=this,t=qc.N("actorNode");t.alpha=1,fs.ActorAnimation.actorState="ready",fs.ActorAnimation.playActorAnimation()},A.playActorAnimation=function(e){var t=this,n=fs.ConfigManager.excelData.zone[fs.ConfigManager.levelID].type;fs.ScenesUI.gameMode=="trouble"?t.actorState=="ready"?t.actorAnimationPlayControl(n,"up",fs.ScenesUI,!1):t.actorState=="get"?fs.ActorAnimation.actorAnimationPlayControl(n,"behit",fs.ScenesUI,!1):t.actorState=="stun"?fs.ActorAnimation.actorAnimationPlayControl(n,"stun",fs.ScenesUI,!1,"stun"):t.actorState=="attack"?fs.ActorAnimation.actorAnimationPlayControl(n,"attack",fs.ScenesUI,!1,null):t.actorState=="fail"?fs.ActorAnimation.actorAnimationPlayControl(n,"fail",fs.ScenesUI,!1,"result"):t.actorState=="prepare"?fs.ActorAnimation.actorAnimationPlayControl(n,"ready",fs.ScenesUI,!1,"ready"):t.actorState=="win"&&fs.ActorAnimation.actorAnimationPlayControl(n,"win",fs.ScenesUI,!1,"result"):n=="juice"?t.actorState=="ready"?t.actorAnimationPlayControl(n,"ready",fs.ScenesUI,!1):t.actorState=="get"?t.actorAnimationPlayControl(n,"get"+e,fs.ScenesUI,!1):t.actorState=="complete"?fs.ActorAnimation.actorAnimationPlayControl(n,"complete",fs.ScenesUI,!1,fs.ActorAnimation.actorAnimationPlayControl(n,"dance",fs.ScenesUI,!1,"dance")):t.actorState=="boring"?fs.ActorAnimation.actorAnimationPlayControl(n,"boring",t,!1,"boring"):t.actorState=="nervous"?fs.ActorAnimation.actorAnimationPlayControl(n,"nervous",t,!1,null):t.actorState=="fail"&&fs.ActorAnimation.actorAnimationPlayControl(n,"fail",fs.ScenesUI,!1,"cry"):t.actorState=="ready"?t.actorAnimationPlayControl(n,"ready",fs.ScenesUI,!1):t.actorState=="get"?t.actorAnimationPlayControl(n,"get",fs.ScenesUI,!1):t.actorState=="complete"?fs.ActorAnimation.actorAnimationPlayControl(n,"complete",fs.ScenesUI,!1,fs.ActorAnimation.actorAnimationPlayControl(n,"dance",fs.ScenesUI,!1,"dance")):t.actorState=="boring"?fs.ActorAnimation.actorAnimationPlayControl(n,"boring",t,!1,"boring"):t.actorState=="nervous"?fs.ActorAnimation.actorAnimationPlayControl(n,"nervous",t,!1,null):t.actorState=="fail"&&fs.ActorAnimation.actorAnimationPlayControl(n,"fail",fs.ScenesUI,!1,"cry")},A.actorAnimationPlayControl=function(e,t,n,r,i){var s=this,o=qc.N("actorNode");r==null&&(r=!1),e=="juice"&&s.isActorMove==0&&(s.isActorMove=!0,o.playAnimation(t,1,r),o.onFinished.addOnce(function(){i=="boring"?(o.playAnimation("boring",1,!0),s.isActorMove=!1):i=="cry"?(fs.ScenesUI.resultControl(fs.TaskLogic.gameResult),o.playAnimation("cry",1,!0),s.isActorMove=!0):i=="dance"?(fs.ScenesUI.resultControl(fs.TaskLogic.gameResult),o.playAnimation("dance",1,!0),s.isActorMove=!0):i!=null?(i(),s.isActorMove=!1):fs.ScenesUI.stepCount<=3&&fs.ScenesUI.stepCount>0?(o.playAnimation("nervous",1,!0),s.isActorMove=!1):(o.playAnimation("idle",1,!0),s.isActorMove=!1)})),e=="trouble"&&s.isActorMove==0&&(s.isActorMove=!0,o.playAnimation(t,1,r),o.onFinished.addOnce(function(){if(i!="boring")if(i=="ready"){if(s.actorState=="win"||s.actorState=="fail")return;o.playAnimation("ready",1,!0),s.isActorMove=!1}else if(i=="stun"){if(s.actorState=="win"||s.actorState=="fail")return;o.playAnimation("stun",1,!0),s.isActorMove=!1}else if(i=="result")s.isActorMove=!0,fs.ScenesUI.resultControl(fs.TaskLogic.gameResult);else if(i!=null)s.isActorMove=!1;else{if(s.actorState=="win"||s.actorState=="fail")return;o.playAnimation("idle",1,!0),s.isActorMove=!1}})),e=="dogfood"&&s.isActorMove==0&&(s.isActorMove=!0,o.playAnimation(t,1,r),o.onFinished.addOnce(function(){i=="boring"?(o.playAnimation("boring",1,!0),s.isActorMove=!1):i=="cry"?(fs.ScenesUI.resultControl(fs.TaskLogic.gameResult),o.playAnimation("cry",1,!0),s.isActorMove=!0):i=="dance"?(fs.ScenesUI.resultControl(fs.TaskLogic.gameResult),o.playAnimation("dance",1,!0),s.isActorMove=!0):i!=null?i():fs.ScenesUI.stepCount<=3?(o.playAnimation("nervous",1,!0),s.isActorMove=!1):(o.playAnimation("idle",1,!0),s.isActorMove=!1)})),e=="popsicle"&&s.isActorMove==0&&(s.isActorMove=!0,o.playAnimation(t,1,r),o.onFinished.addOnce(function(){i=="boring"?(o.playAnimation("boring",1,!0),s.isActorMove=!1):i=="cry"?(fs.ScenesUI.resultControl(fs.TaskLogic.gameResult),o.playAnimation("cry",1,!0),s.isActorMove=!0):i=="dance"?(fs.ScenesUI.resultControl(fs.TaskLogic.gameResult),o.playAnimation("dance",1,!0),s.isActorMove=!0):i!=null?(i(),s.isActorMove=!1):(console.info(fs.ScenesUI.stepCount),fs.ScenesUI.stepCount<=3?(o.playAnimation("nervous",1,!0),s.isActorMove=!1):(o.playAnimation("idle",1,!0),s.isActorMove=!1))}))};var O=qc.defineBehaviour("qc.engine.Guide",qc.Behaviour,function(){var e=this;fs.Guide=e,e.contentObj=[{contentText:"组成L形状，会行成一个果冻，果冻消除时可用炸掉他临近的元素",contentTexture:"none"},{contentText:"2",contentTexture:"none"},{contentText:"3",contentTexture:"none"},{contentText:"4",contentTexture:"none"}],e.pageIndex=0},{guideNode:qc.Serializer.NODE,closeButton:qc.Serializer.NODE,preButotn:qc.Serializer.NODE,nextButton:qc.Serializer.NODE,tipPanel:qc.Serializer.NODE});O.prototype.awake=function(){var e=this;e.init()},O.prototype.init=function(){var e=this;e.addListener(e.nextButton.onClick,e.nextButtonEvent,e),e.addListener(e.preButotn.onClick,e.preButtonEvent,e),e.addListener(e.closeButton.onClick,e.closePanel,e),e.guideNode.find("guideText").text=e.contentObj[e.pageIndex].contentText},O.prototype.nextButtonEvent=function(){var e=this;e.pageIndex<e.contentObj.length-1?e.pageIndex+=1:e.pageIndex=0,e.init()},O.prototype.preButtonEvent=function(){var e=this;e.pageIndex>0?e.pageIndex-=1:e.pageIndex=e.contentObj.length-1,e.init()},O.prototype.closePanel=function(){var e=this;e.gameObject.visible=!1,e.tipPanel.visible=!0,fs.ScenesUI.tipPanelTimeout(),fs.GameManager.noticeTimeBuilder()};var M=qc.defineBehaviour("qc.engine.LayerManager",qc.Behaviour,function(){var e=this;fs.LayerManager=e,e.isLock=!1,e.generator=null,e.excludElementId=[],e.popsicleInfoList=[],e.wormholeData=[],e.tilesList={terrain:[],transfer:[],skill:[],popsicle:[],portal:[],belowElement:[],element:[],aboveElement:[],obstacleTransverse:[],obstacleVertical:[]},e.node={board:qc.N("board"),terrain:qc.N("terrain"),transfer:qc.N("transfer"),skill:qc.N("skill"),popsicle:qc.N("popsicle"),portal:qc.N("portal"),belowElement:qc.N("belowElement"),element:qc.N("element"),aboveElement:qc.N("aboveElement"),obstacleTransverse:qc.N("obstacleTransverse"),obstacleVertical:qc.N("obstacleVertical"),pop:qc.N("pop")}},{tilePrefab:qc.Serializer.PREFAB,rocketPrefab:qc.Serializer.PREFAB});M.prototype.init=function(){var e=this;if(e.isLock)return;e.isLock=!0;var t=e.gameObject.find("floor"),n=t.getScript("qc.engine.FloorBuilder");n.init(),e.buildLayer()},M.prototype.initialElementBuilder=function(){var e=this,t={},n=fs.ConfigManager.excelData.zone,r=fs.ConfigManager.excelData.fillid,i=fs.ConfigManager.excelData.fillRule,s=fs.ConfigManager.levelID,o=n[s].fillID,u=r[o].initialFillRule,a=i[u],f={};return f.idList=a.tileList,f.idPosibility=a.tileProbability,f},M.prototype.reSetList=function(){var e=this,t={},n=[],r=[];t.recordList=[],t.realList=[],t.element=[];for(var i=0;i<72;i++){var s=[],o=fs.ConfigManager.levelData.layers[8].data[i],u=fs.CommonLayer.getTmxPro(o);if(u!=null&&u.tileID==2004)if(t.recordList.indexOf(parseInt(u.tileListID))==-1){t.recordList.push(parseInt(u.tileListID)),r=fs.ConfigManager.excelData.tilesList[u.tileListID].tilelist.split(";");var a=r.length;for(var f=0;f<a;f++)n[f]=parseInt(r[f]);var l=fs.Game.math.shuffle(n);for(var c=0;c<r.length;c++)s[c]=null;var h={tileID:l[u.num-1]};t.element.push(h),t.realList[u.tileListID]=[].concat(l)}else{var h={tileID:t.realList[u.tileListID][u.num-1]};t.element.push(h)}else t.element.push(u)}return t},M.prototype.checkLeftTwo=function(e){var t=this;return t.tilesList.element[e-1]!="randomElement"&&t.tilesList.element[e-2]!="randomElement"?t.tilesList.element[e-1]==null||t.tilesList.element[e-2]==null?null:fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-1].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-2].id)?fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-1].id):null:null},M.prototype.checkRightTwo=function(e){var t=this;return t.tilesList.element[e+1]!="randomElement"&&t.tilesList.element[e+2]!="randomElement"?t.tilesList.element[e+2]==null||t.tilesList.element[e+1]==null?null:fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+1].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+2].id)?fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+1].id):null:null},M.prototype.checkTopTwo=function(e){var t=this;return t.tilesList.element[e-9]!="randomElement"&&t.tilesList.element[e-18]!="randomElement"?t.tilesList.element[e-9]==null||t.tilesList.element[e-18]==null?null:fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-9].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-18].id)?fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-9].id):null:null},M.prototype.checkBottomTwo=function(e){var t=this;return t.tilesList.element[e+9]!="randomElement"&&t.tilesList.element[e+18]!="randomElement"?t.tilesList.element[e+9]==null||t.tilesList.element[e+18]==null?null:fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+9].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+18].id)?fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+18].id):null:null},M.prototype.checkLeftTopCorner=function(e){var t=this;return t.tilesList.element[e-1]!="randomElement"&&t.tilesList.element[e-9]!="randomElement"&&t.tilesList.element[e-10]!="randomElement"?t.tilesList.element[e-1]==null||t.tilesList.element[e-9]==null||t.tilesList.element[e-10]==null?null:fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-1].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-9].id)&&fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-9].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-10].id)?fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-1].id):null:null},M.prototype.checkRightTopCorner=function(e){var t=this;return t.tilesList.element[e+1]!="randomElement"&&t.tilesList.element[e-9]!="randomElement"&&t.tilesList.element[e-8]!="randomElement"?t.tilesList.element[e+1]==null||t.tilesList.element[e-9]==null||t.tilesList.element[e-8]==null?null:fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+1].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-9].id)&&fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-9].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-8].id)?fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+1].id):null:null},M.prototype.checkLeftBottomCorner=function(e){var t=this;return t.tilesList.element[e-1]!="randomElement"&&t.tilesList.element[e+9]!="randomElement"&&t.tilesList.element[e+8]!="randomElement"?t.tilesList.element[e-1]==null||t.tilesList.element[e+9]==null||t.tilesList.element[e+8]==null?null:fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-1].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+9].id)&&fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+9].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+8].id)?fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-1].id):null:null},M.prototype.checkRightBottomCorner=function(e){var t=this;return t.tilesList.element[e+1]!="randomElement"&&t.tilesList.element[e+9]!="randomElement"&&t.tilesList.element[e+10]!="randomElement"?t.tilesList.element[e+1]==null||t.tilesList.element[e+9]==null||t.tilesList.element[e+10]==null?null:fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+1].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+9].id)&&fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+9].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+10].id)?fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+1].id):null:null},M.prototype.checkHorizontalCenter=function(e){var t=this;return t.tilesList.element[e+1]!="randomElement"&&t.tilesList.element[e-1]!="randomElement"?t.tilesList.element[e+1]==null||t.tilesList.element[e-1]==null?null:fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+1].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-1].id)?fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+1].id):null:null},M.prototype.checkVerticalCenter=function(e){var t=this;return t.tilesList.element[e+9]!="randomElement"&&t.tilesList.element[e-9]!="randomElement"?t.tilesList.element[e+9]==null||t.tilesList.element[e-9]==null?null:fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+9].id)==fs.CommonLayer.transformIDtoColor(t.tilesList.element[e-9].id)?fs.CommonLayer.transformIDtoColor(t.tilesList.element[e+9].id):null:null},M.prototype.buildCommonElement=function(e){var t=this,n=[];e<9&&(n.push(t.checkBottomTwo(e)),e%9>0&&n.push(t.checkLeftBottomCorner(e)),e%9>1&&n.push(t.checkLeftTwo(e)),e%9<7&&n.push(t.checkRightTwo(e)),e%9<8&&n.push(t.checkRightBottomCorner(e)),e%9>0&&e%9<8&&n.push(t.checkHorizontalCenter(e))),e>8&&e<63&&(n.push(t.checkVerticalCenter(e)),e%9>1&&n.push(t.checkLeftTwo(e)),e%9<7&&n.push(t.checkRightTwo(e)),e<54&&n.push(t.checkBottomTwo(e)),e>17&&n.push(t.checkTopTwo(e)),e%9>0&&(n.push(t.checkLeftTopCorner(e)),n.push(t.checkLeftBottomCorner(e))),e%9<8&&(n.push(t.checkRightBottomCorner(e)),n.push(t.checkRightTopCorner(e))),e%9>0&&e%9<8&&n.push(t.checkHorizontalCenter(e))),e>=63&&(n.push(t.checkTopTwo(e)),e%9>0&&n.push(t.checkLeftTopCorner(e)),e%9<8&&n.push(t.checkRightTopCorner(e)),e%9>1&&(n.push(t.checkLeftTwo(e)),n.push(t.checkLeftTopCorner(e))),e%9<7&&(n.push(t.checkRightTwo(e)),n.push(t.checkRightTopCorner(e))),e%9>0&&e%9<8&&n.push(t.checkHorizontalCenter(e)));var r=t.initialElementBuilder(),i=t.randomElementBuilder(r,n);if(i.indexOf("_")==-1)t.checkInitialCombo(e,parseInt(i));else{var s=i.split("_");t.checkInitialCombo(e,parseInt(s[0]),parseInt(s[1]))}},M.prototype.checkInitialCombo=function(e,t,n){var r=this,i=t;if(n==null)var s={tileID:i};else var s={tileID:i,hp:n};var o=fs.TileFactory.buildTile(e,s,"element");r.tilesList.element[e]=o},M.prototype.randomElementBuilder=function(e,t){var n=this,r=null,i=null,s=e.idList.split(";"),o=e.idPosibility.split(";"),u=[],a=0,f=t,l=function(e){e.sort();var t=[e[0]];for(var n=1;n<e.length;n++)e[n]!==t[t.length-1]&&t.push(e[n]);return t};f=l(f);for(var c=0;c<f.length;c++)if(f[c]!=null)for(var h=0;h<s.length;h++)f[c]==fs.CommonLayer.transformIDtoColor(parseInt(s[h]))&&u.push(h);var p=[];for(var d=0;d<s.length;d++)p[d]=fs.CommonLayer.transformIDtoColor(parseInt(s[d]));for(var v=0;v<u.length;v++){if(u.length==0)break;a==0?(s.splice(u[v],1),o.splice(u[v],1),a++):(s.splice(u[v]-a,1),o.splice(u[v]-a,1),a++)}for(var m=0;m<o.length;m++)o[m]=parseInt(o[m]);var g=n.buildTileByPosibility(s,o);return s[g]},M.prototype.buildLayer=function(){var e=this,t=fs.ConfigManager.row*fs.ConfigManager.colunm;e.generator=fs.TileBuilder.getInfo();var n=fs.CommonLayer.getPopsicle(),r=0,i=e.reSetList(fs.ConfigManager.levelData),s=0;for(var o=0;o<t;o++)for(var u=0,a=fs.ConfigManager.levelData.layers.length;u<a;u++){var f=fs.ConfigManager.levelData.layers[u],l=f.data[o],c=fs.CommonLayer.getTmxPro(l);if(f.name=="terrain")if(l==0)e.tilesList.terrain.push(null);else if(c.tileID!=2001&&c.tileID!=2002&&c.tileID!=2003&&c.tileID!=2501){var h=fs.TileFactory.buildTile(o,c,f.name);e.tilesList.terrain.push(h);var p={};p.tileID=c.tileID,c.transferPosition&&(p.transferPosition=c.transferPosition),p.index=o,fs.ConveyorLayer.specialTransferPosition.push(p)}else e.tilesList.terrain.push(null);f.name=="transfer",f.name=="transfer2",f.name=="skill";if(f.name==n)if(l==0)e.tilesList.popsicle.push(null);else{var h=fs.TileFactory.buildTile(o,c,"popsicle"),d=fs.ConfigManager.excelData.tiles[c.tileID];e.popsicleInfoList[r]=[];var v=function(t,n,i){if(t==null&&n==null)e.popsicleInfoList[r].push(i);else{var s=[];for(var o=0;o<n;o++){var u=(i+o)%9;s.push(u)}for(var a=i-(t-1)*9;a<=i+(n-1);a++)for(var f=0;f<s.length;f++)a%9==s[f]&&e.popsicleInfoList[r].push(a)}};v(d.height,d.width,o);var m=e.popsicleInfoList[r];h.range=e.popsicleInfoList[r];for(var g=0,y=m.length;g<y;g++){var b=m[g];e.tilesList.popsicle[b]=h}r++}if(f.name=="portal")if(l==0)e.tilesList.portal.push(null);else{if(c.tileID=="2601"){var w=c.transferPosition.split(","),E=fs.CommonLayer.getIndexFromRowAndCol(parseInt(w[0])-1,parseInt(w[1])-1);e.wormholeData[s]={},e.wormholeData[s].tileID=c.tileID,e.wormholeData[s].transferPosition=E,e.wormholeData[s].index=o,s++}else c.tileID=="2602"&&(e.wormholeData[s]={},e.wormholeData[s].tileID=c.tileID,e.wormholeData[s].index=o,s++);var h=fs.TileFactory.buildTile(o,c,f.name);e.tilesList.portal.push(h)}if(f.name=="belowElement")if(l==0)e.tilesList.belowElement.push(null);else{var h=fs.TileFactory.buildTile(o,c,f.name);e.tilesList.belowElement.push(h)}if(f.name=="element"){var S=fs.ConfigManager.levelData.layers[0].data[o];if(l!=0)if(c.tileID==2004)e.tilesList.element.push("specialElement");else{var h=fs.TileFactory.buildTile(o,c,f.name);e.tilesList.element.push(h)}if(l==0)if(S==1||S==2){c=fs.CommonLayer.getTmxPro(S);var h=fs.TileFactory.buildTile(o,c,f.name);e.tilesList.element.push(h)}else e.tilesList.element.push("randomElement")}if(f.name=="aboveElement")if(l==0)e.tilesList.aboveElement.push(null);else{var h=fs.TileFactory.buildTile(o,c,f.name);e.tilesList.aboveElement.push(h)}f.name=="obstacleTransverse",f.name=="obstacleVertical"}var x=function(){for(var t=0;t<72;t++){var n=fs.ConfigManager.levelData.layers[8],r=n.data[t],i=fs.CommonLayer.getTmxPro(r),s=fs.ConfigManager.levelData.layers[0].data[t];e.tilesList.element[t]=="randomElement"&&e.buildCommonElement(t)}while(fs.DisFactory.checkMapDie()===!0)console.error("存在三消元素,重构地图"),T()},T=function(){for(var t=0;t<72;t++){var n=fs.ConfigManager.levelData.layers[8],r=n.data[t],s=fs.CommonLayer.getTmxPro(r),o=fs.ConfigManager.levelData.layers[0].data[t];if(r!=0&&e.tilesList.element[t]=="specialElement"){var u=fs.TileFactory.buildTile(t,i.element[t],"element");e.tilesList.element[t]=u}}x()};T(),fs.TilePool.supplyTile()},M.prototype.showBoard=function(){var e=this,t=e.gameObject;tp=t.getScript("qc.TweenPosition"),tp.from=new qc.Point(t.x,t.y),tp.to=new qc.Point(-360,t.y),tp.duration=.8,tp.onFinished.addOnce(function(){fs.GameManager.changeFSM()}),tp.resetToBeginning(),tp.playForward()},M.prototype.checkDropComplete=function(){var e=this,t=fs.ConfigManager.row*fs.ConfigManager.colunm;for(var n=0;n<t;n++)if(fs.LayerManager.tilesList.element[n]&&fs.LayerManager.tilesList.element[n].moveFlag)return!1;return!0},M.prototype.checkDisComplete=function(){var e=this,t=fs.ConfigManager.row*fs.ConfigManager.colunm;for(var n=0;n<t;n++)if(fs.LayerManager.tilesList.element[n]&&fs.LayerManager.tilesList.element[n].delFlag)return!1;return!0},M.prototype.checkNewTileComplete=function(){var e=this,t=fs.ConfigManager.row*fs.ConfigManager.colunm;for(var n=0;n<t;n++)if(fs.LayerManager.tilesList.element[n]&&fs.LayerManager.tilesList.element[n].newFlag)return!1;return fs.GameManager.comboCount++,!0},M.prototype.dropAll=function(){var e=this;for(var t=fs.ConfigManager.row-1;t>=0;t--)for(var n=0;n<fs.ConfigManager.colunm;n++){var r=n+t*fs.ConfigManager.colunm;e.dropOne(r)}},M.prototype.dropOne=function(e){var t=this,n=fs.LayerManager.tilesList.element[e];if(n==null)for(var r in fs.LayerManager.generator)if(r==e)var n=fs.LayerManager.tilesList.element[e]=fs.TilePool.getTile(e);if(n!=null&&n.isSwap&&!n.moveFlag){var i=[],s=!0,o=e;n.newFlag&&i.push(o);while(s){if(fs.LayerManager.tilesList.element[o+9]==null&&fs.BaseLayer.isCanSwap(o,"down"))o+=9,i.push(o);else if(fs.LayerManager.tilesList.element[o+9]!=null&&fs.LayerManager.tilesList.element[o+9].isCross){var u=o+9,a=!1,f=0;while(u<71){var l=fs.LayerManager.tilesList.element[u];l!=null&&!l.isCross?u=71:l==null&&n.canSwapByDirection("down")&&fs.BaseLayer.isCanSwap(o-9,"down")&&f++,u+=9}if(f>0){for(var r=0;r<f;r++)o+=9,i.push(o);s=!0,a=!0}a||(o%9>0&&fs.LayerManager.tilesList.element[o+9-1]==null&&fs.BaseLayer.isCanSwap(o,"left_down")?fs.BaseLayer.hasCross(o-1)?(o=o+9-1,i.push(o),s=!0):s=!1:o%9!=8&&fs.LayerManager.tilesList.element[o+9+1]==null&&fs.BaseLayer.isCanSwap(o,"right_down")?fs.BaseLayer.hasCross(o+1)?(o=o+9+1,i.push(o),s=!0):s=!1:s=!1)}else o%9>0&&fs.LayerManager.tilesList.element[o+9-1]==null&&fs.BaseLayer.isCanSwap(o,"left_down")?fs.BaseLayer.hasCross(o-1)?(o=o+9-1,i.push(o),s=!0):s=!1:o%9!=8&&fs.LayerManager.tilesList.element[o+9+1]==null&&fs.BaseLayer.isCanSwap(o,"right_down")?fs.BaseLayer.hasCross(o+1)?(o=o+9+1,i.push(o),s=!0):s=!1:s=!1;var c=t.isTransfer(o);c!=null&&!fs.BaseLayer.isBinded(o)&&(o=c,i.push(o),s=!0)}var h=i.length;if(h>0){var p=0,d=n.gameObject,v=d.getScript("qc.TweenScale"),m=d.getScript("qc.TweenPosition"),g=function(){v.from=new qc.Point(.8,1.2),v.to=new qc.Point(1,.75),m.from=new qc.Point(d.x,d.y),m.to=new qc.Point(d.x,d.y+10),v.duration=.06,m.duration=.06,v.resetToBeginning(),v.playForward(),m.resetToBeginning(),m.playForward(),m.onFinished.addOnce(function(){v.from=new qc.Point(1,.75),v.to=new qc.Point(1,.7),v.duration=.05,v.resetToBeginning(),v.playForward(),v.onFinished.addOnce(function(){v.from=new qc.Point(1,.7),v.to=new qc.Point(1,1),m.from=new qc.Point(d.x,d.y),m.to=new qc.Point(d.x,d.y-16),v.duration=.08,m.duration=.08,v.resetToBeginning(),v.playForward(),m.resetToBeginning(),m.playForward(),m.onFinished.addOnce(function(){m.from=new qc.Point(d.x,d.y),m.to=new qc.Point(d.x,d.y+6),m.duration=.08,m.resetToBeginning(),m.playForward(),m.onFinished.addOnce(function(){n.setMoveFlag(!1),n.setNewFlag(!1)})})})})};n.setMoveFlag(!0),v.from=new qc.Point(1,1),v.to=new qc.Point(.8,1.2),v.duration=.08,v.resetToBeginning(),v.playForward();var y=.1;h>4?y=.05:h>3&&(y=.07),n.dropMove(i,p,y,g),n.newFlag&&h==1?fs.LayerManager.tilesList.element[o]=n:(fs.LayerManager.tilesList.element[o]=n,n.newFlag?fs.Game.timer.add(160,function(){fs.LayerManager.tilesList.element[e]=null}):fs.LayerManager.tilesList.element[e]=null)}}},M.prototype.isTransfer=function(e){var t=this,n=null;for(var r=0,i=t.wormholeData.length;r<i;r++){var s=t.wormholeData[r];if(s.index==e&&s.hasOwnProperty("transferPosition")&&fs.LayerManager.tilesList.element[s.transferPosition]==null){n=s.transferPosition;break}}return n},M.prototype.TileGenerator=function(){var e=this;for(var t in fs.LayerManager.generator){var n=fs.LayerManager.tilesList.element[t];if(n==null){var r=e.getRandomProp(t),i=fs.TileFactory.buildTile(t,r,"element",!0);e.tilesList.element[t]=i}}},M.prototype.getRandomProp=function(e){var r=this,i={},s=fs.LayerManager.generator[e],o=t.keys(s).length;if(o>1)for(var u in s){if(s[u].useTime>0){var a=s[u].dropPosibility,f=s[u].elementList,l=r.buildTileByPosibility(f,a),c=s[u].elementList[l];s[u].useTime--;break}if(s[u].useTime==-1)var a=s[u].dropPosibility,f=s[u].elementList,l=r.buildTileByPosibility(f,a),c=s[u].elementList[l]}else{var a=s[0].dropPosibility,f=s[0].elementList,l=r.buildTileByPosibility(f,a);if(s[0].elementList.length==n)var c=s[0].elementList;else var c=s[0].elementList[l]}if(c.length!=n)var h=c.split("_");else var h=[c];return i.tileID=h[0],h[1]&&(i.hp=h[1]),i},M.prototype.buildTileByPosibility=function(e,t){var n=[];for(var r=0;r<t.length;r++)n[0]=t[0],r!=0&&(n[r]=t[r]+n[r-1]);var i=Math.ceil(Math.random()*n[n.length-1]),s;for(var o=0;o<n.length;o++)if(n[o]>=i){s=o;break}return s},M.prototype.tileAction=function(){var e=this,t=fs.ConfigManager.row*fs.ConfigManager.colunm,n=0;e.fruitArray=[];var r=function(){--n<=0};for(var i=0;i<t;i++){var s=fs.LayerManager.tilesList.element[i];s!=null&&s.class3=="tree"&&s.hp==3&&e.fruitArray.push(s)}if(!e.fruitArray.length){fs.GameManager.changeFSM();return}e.fruitArray.forEach(function(e,t){n++,e.updateRounds(r)}),e.tileActionTimer=fs.Game.timer.loop(100,e.hasTileComplete.bind(e))},M.prototype.hasTileComplete=function(){var e=this,t=!1;for(var n=0,r=e.fruitArray.length;n<r;n++){var i=e.fruitArray[n];if(i.moveFlag){t=!0;break}}t||(fs.Game.timer.remove(e.tileActionTimer),fs.Game.timer.add(500,function(){fs.GameManager.changeFSM()}))},M.prototype.layerPropagation=function(e,t,r,i,s){s==n&&(s=1),i==n&&(i=null);var o=fs.LayerManager.tilesList.element[e];if(o==null)return;var u=!1,a=4;for(var f=0;f<a;f++){var l=null;f==0&&(l=fs.LayerManager.tilesList.aboveElement[e]),f==1&&(l=o),f==2&&(l=fs.LayerManager.tilesList.belowElement[e]),f==3&&(l=fs.LayerManager.tilesList.popsicle[e]);if(l!=null){if(!!u)break;u=l.doAction(t,r,i,s)}}};var _=qc.fs.TaskLogic={};_.targetElement=[],_.elementNum=[],_.taskObj=[],_.restTaskObj=[],_.bossHP=null,_.bossDownHP=0,_.bossHPDefault=null,_.gameResult=null,_.juiceTaskControl=function(e,t){var n=this;n.setTargetListData(t),n.refreshJuiceTask(e),console.log(n.taskObj),console.log(n.restTaskObj)},_.refreshJuiceTask=function(e){var t=this,n=e.gameModeTarget.juiceTarget.target.children;for(var r=0;r<3;r++)console.info(),n[r].children[0].frame=t.taskObj[r].showPic,n[r].children[0].scaleX=t.taskObj[r].scale,n[r].children[0].scaleY=t.taskObj[r].scale,n[r].children[1].find("UIText").text=t.taskObj[r].elementNumber.toString();e.gameModeTarget.juiceTarget.rest.find("restNum").text=t.restTaskObj.length.toString()},_.bossTaskControl=function(e,t){var n=this;n.setTargetListData(t),n.bossHPDefault=parseInt(n.taskObj[0].ai.split(";")),n.bossHP=n.bossHPDefault,n.refreshBossTask(e)},_.refreshBossTask=function(e){var t=this,n=qc.N("hpPercentText");for(var r=0;r<4;r++)e.gameModeTarget.bossTarget.ui.children[0].children[r].visible=!1;for(var i=0;i<t.taskObj.length;i++)e.gameModeTarget.bossTarget.ui.children[0].children[i].visible=!0,e.gameModeTarget.bossTarget.ui.children[0].children[i].frame=t.taskObj[i].showPic;var s=t.bossHP/t.bossHPDefault;s<=0&&(s=0),n.text=""+Math.ceil(s*100)+"";var o=-340,u=e.gameModeTarget.bossTarget.hp.children[0];u.x=o-o*s},_.popsicleControl=function(e,t){var n=this;n.setTargetListData(t),n.refreshPopsicleTask(e)},_.refreshPopsicleTask=function(e){var t=this;e.gPd.find("icon").frame=t.taskObj[0].showPic,e.gPd.find("icon").frame.scaleX=t.taskObj[0].scale,e.gPd.find("icon").frame.scaleY=t.taskObj[0].scale,e.gPd.find("numBg").find("UIText").text=t.taskObj[0].elementNumber.toString()},_.dogfoodControl=function(e,t){var n=this;n.setTargetListData(t),n.refreshDogfoodTask(e)},_.refreshDogfoodTask=function(e){var t=this;e.gPd.find("icon").frame=t.taskObj[0].showPic,e.gPd.find("icon").frame.scaleX=t.taskObj[0].scale,e.gPd.find("icon").frame.scaleY=t.taskObj[0].scale,e.gPd.find("numBg").find("UIText").text=t.taskObj[0].elementNumber.toString()},_.setTargetListData=function(e){var t=this,r=e.purchase,i=e.num,s=e.ai;if(fs.ScenesUI.gameMode=="juice"||fs.ScenesUI.gameMode=="trouble"){r.length!=null?t.targetElement=r.split(";"):t.targetElement=[r],i!=null&&(t.elementNum=i.split(";"));for(var o=0;o<t.targetElement.length;o++)t.taskObj[o]={},t.taskObj[o].elementID=fs.ConfigManager.excelData.purchase[t.targetElement[o]].includeTileList,t.taskObj[o].elementNumber=parseInt(t.elementNum[o]),t.taskObj[o].showPic=fs.ConfigManager.excelData.purchase[t.targetElement[o]].resource,fs.ConfigManager.excelData.purchase[t.targetElement[o]].class1!=n?t.taskObj[o].class1=fs.ConfigManager.excelData.purchase[t.targetElement[o]].class1:t.taskObj[o].class1=null,fs.ConfigManager.excelData.purchase[t.targetElement[o]].class2!=n?t.taskObj[o].class2=fs.ConfigManager.excelData.purchase[t.targetElement[o]].class2:t.taskObj[o].class2=null,fs.ConfigManager.excelData.purchase[t.targetElement[o]].class3!=n?t.taskObj[o].class3=fs.ConfigManager.excelData.purchase[t.targetElement[o]].class3:t.taskObj[o].class3=null,t.taskObj[o].scale=fs.ConfigManager.excelData.purchase[t.targetElement[o]].scale,t.taskObj[o].color=fs.ConfigManager.excelData.purchase[t.targetElement[o]].color,t.taskObj[o].ai=s;if(t.taskObj.length>3){var u=0,a=[].concat(t.taskObj);for(var o=3;o<t.taskObj.length;o++)t.restTaskObj[u]=a[o],u++}}else t.targetElement=r,t.elementNum=i,t.taskObj[0]={},t.taskObj[0].elementID=fs.ConfigManager.excelData.purchase[t.targetElement].includeTileList,t.taskObj[0].elementNumber=t.elementNum,t.taskObj[0].showPic=fs.ConfigManager.excelData.purchase[t.targetElement].resource,fs.ConfigManager.excelData.purchase[t.targetElement].class1!=n?t.taskObj[0].class1=fs.ConfigManager.excelData.purchase[t.targetElement].class1:t.taskObj[0].class1=null,fs.ConfigManager.excelData.purchase[t.targetElement].class2!=n?t.taskObj[0].class2=fs.ConfigManager.excelData.purchase[t.targetElement].class2:t.taskObj[0].class2=null,fs.ConfigManager.excelData.purchase[t.targetElement].class3!=n?t.taskObj[0].class3=fs.ConfigManager.excelData.purchase[t.targetElement].class3:t.taskObj[0].class3=null,t.taskObj[0].scale=fs.ConfigManager.excelData.purchase[t.targetElement].scale,t.taskObj[0].color=fs.ConfigManager.excelData.purchase[t.targetElement].color},_.checkGameResult=function(){var e=this;if(fs.ConfigManager.excelData.zone[fs.ConfigManager.levelID].type=="juice"&&fs.ScenesUI.gameModeTarget.juiceTarget.target.children[0].visible==0&&fs.ScenesUI.gameModeTarget.juiceTarget.target.children[1].visible==0&&fs.ScenesUI.gameModeTarget.juiceTarget.target.children[2].visible==0){fs.ActorAnimation.isActorMove=!1,fs.ActorAnimation.actorState="complete",fs.ActorAnimation.playActorAnimation(),e.gameResult="sucess",fs.ScenesUI.scorePanelControl(),fs.FightControl.isAction=!0,console.warn("****************************"),console.warn("********恭喜您过关啦*********"),console.warn("*你的分数为："+fs.ScenesUI.gameScore+"分*"),console.warn("****************************");return}if(fs.ConfigManager.excelData.zone[fs.ConfigManager.levelID].type=="trouble"&&e.bossHP<=0){fs.ActorAnimation.isActorMove=!1,e.gameResult="sucess",fs.ScenesUI.scorePanelControl(),fs.FightControl.isAction=!0,fs.ActorAnimation.actorState="fail",fs.ActorAnimation.playActorAnimation(),console.warn("****************************"),console.warn("********恭喜您过关啦*********"),console.warn("*你的分数为："+fs.ScenesUI.gameScore+"分*"),console.warn("****************************");return}if(fs.ConfigManager.excelData.zone[fs.ConfigManager.levelID].type=="popsicle"&&fs.ScenesUI.gPd.find("numBg").find("UIText").text=="0"){fs.ActorAnimation.isActorMove=!1,e.gameResult="sucess",fs.ScenesUI.scorePanelControl(),fs.FightControl.isAction=!0,fs.ActorAnimation.actorState="complete",fs.ActorAnimation.playActorAnimation(),console.warn("****************************"),console.warn("********恭喜您过关啦*********"),console.warn("*你的分数为："+fs.ScenesUI.gameScore+"分*"),console.warn("****************************");return}if(fs.ConfigManager.excelData.zone[fs.ConfigManager.levelID].type=="dogfood"&&fs.ScenesUI.gPd.find("numBg").find("UIText").text=="0"){e.gameResult="sucess",fs.ScenesUI.scorePanelControl(),fs.FightControl.isAction=!0,fs.ActorAnimation.isActorMove=!1,fs.ActorAnimation.actorState="complete",fs.ActorAnimation.playActorAnimation(),console.warn("****************************"),console.warn("********恭喜您过关啦*********"),console.warn("*你的分数为："+fs.ScenesUI.gameScore+"分*"),console.warn("****************************");return}if(fs.ScenesUI.stepCount==0){e.gameResult="fail",fs.FightControl.isAction=!0;if(fs.ScenesUI.gameMode=="trouble"){fs.ActorAnimation.isActorMove=!1,fs.FightControl.isAction=!0,fs.ActorAnimation.actorState="win",fs.ActorAnimation.playActorAnimation(),fs.AudioManager.stopSound(0),fs.AudioManager.playSound(56),console.warn("****************************"),console.warn("*你的步数用完了，游戏结束哦*"),console.warn("****************************");return}fs.ActorAnimation.isActorMove=!1,fs.FightControl.isAction=!0,fs.ActorAnimation.actorState="fail",fs.ActorAnimation.playActorAnimation(),fs.AudioManager.stopSound(0),fs.AudioManager.playSound(56),console.warn("****************************"),console.warn("*你的步数用完了，游戏结束哦*"),console.warn("****************************");return}};var D=qc.fs.BaseSkill={};D.filterSkill=function(e){var t=this;t.type=="SKILL_NOTHING"?t.doNothing(e):t.type=="SKILL_HORIZON"?t.horizon(e):t.type=="SKILL_VERTICAL"?t.vertical(e):t.type=="SKILL_XBOMB"?t.xbomb(e):t.type=="SKILL_XBOMB_SHORT"?t.xbombShort(e):t.type=="SKILL_JELLY"?t.jelly(e):t.type=="SKILL_JELLY_SHORT"?t.jellyShort(e):t.type=="SKILL_RAINBOW"?t.rainbow(e):t.type=="SKILL_MAGNET"?t.magnet(e):t.type=="SKILL_HORIZON_VERTICAL"?t.horizonAndVertical(e):t.type=="SKILL_HV_JELLY"?t.hvAndjelly(e):t.type=="SKILL_HV_RAINBOW"?t.hvAndRainbow(e):t.type=="SKILL_HV_MAGNET"?t.hvAndMagnet(e):t.type=="SKILL_HV_XBOMB"?t.hvAndXBomb(e):t.type=="SKILL_XBOMB_JELLY"?t.xBombAndJelly(e):t.type=="SKILL_XBOMB_RAINBOW"?t.xBombAndRainbow(e):t.type=="SKILL_XBOMB_MAGNET"?t.xBombAndMagnet(e):t.type=="SKILL_XBOMB_XBOMB"?t.xBombAndXBomb(e):t.type=="SKILL_JELLY_JELLY"?t.jellyAndJelly(e):t.type=="SKILL_JELLY_RAINBOW"?t.jellyAndRainbow(e):t.type=="SKILL_JELLY_MAGNET"?t.jellyAndMagnet(e):t.type=="SKILL_RAINBOW_RAINBOW"?t.rainbowAndRainbow(e):t.type=="SKILL_RAINBOW_MAGNET"?t.rainbowAndMagnet(e):t.type=="SKILL_MAGNET_MAGNET"&&t.magnetAndMagnet(e)},D.doNothing=function(e){},D.horizon=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r);fs.GameManager.stop();var s=[],o=i[0]*9;for(var u=0;u<9;u++){if(o==r){o++;continue}s.push(o),o++}fs.AudioManager.playSound(98),t.disappear();for(var u in s){var a=s[u],f=fs.LayerManager.tilesList.element[a];f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&(f.setDelFlag(!0),fs.LayerManager.layerPropagation(a,e,"action_skill"))}fs.Game.timer.add(500,function(){fs.GameManager.start()})},D.vertical=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r);fs.GameManager.stop();var s=[],o=i[1];for(var u=0;u<8;u++){if(o==r){o+=9;continue}s.push(o),o+=9}fs.AudioManager.playSound(98),t.disappear();for(var u in s){var a=s[u],f=fs.LayerManager.tilesList.element[a];f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&(f.setDelFlag(!0),fs.LayerManager.layerPropagation(a,e,"action_skill"))}fs.Game.timer.add(500,function(){fs.GameManager.start()})},D.xbomb=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r);fs.GameManager.stop();var s=[],o=1,u=[i[0],7-i[0],i[1],8-i[1]],a=!0,f=0;while(a)[r-10*o,r-8*o,r+8*o,r+10*o].forEach(function(e,t){if((t==0||t==1)&&o>u[0]){f++;return}if((t==2||t==3)&&o>u[1]){f++;return}if((t==0||t==2)&&o>u[2]){f++;return}if((t==1||t==3)&&o>u[3]){f++;return}s.push(e)}),f>=4?a=!1:f=0,o++;fs.AudioManager.playSound(100),t.disappear();for(var l in s){var c=s[l],h=fs.LayerManager.tilesList.element[c];h!=null&&h.hasOwnProperty("delFlag")&&!h.delFlag&&(h.setDelFlag(!0),fs.LayerManager.layerPropagation(c,e,"action_skill"))}fs.Game.timer.add(500,function(){fs.GameManager.start()})},D.xbombShort=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r);fs.GameManager.stop();var s=[];r>8&&i[1]>0&&(s.push(r-10),r>17&&i[1]>1&&s.push(r-20)),r<63&&i[1]>0&&(s.push(r+8),r<54&&i[1]>1&&s.push(r+16)),r>8&&i[1]<8&&(s.push(r-8),r>17&&i[1]<7&&s.push(r-16)),r<63&&i[1]<8&&(s.push(r+10),r<54&&i[1]<7&&s.push(r+20)),fs.AudioManager.playSound(100),t.disappear();for(var o in s){var u=s[o],a=fs.LayerManager.tilesList.element[u];a!=null&&a.hasOwnProperty("delFlag")&&!a.delFlag&&(a.setDelFlag(!0),fs.LayerManager.layerPropagation(u,e,"action_skill"))}fs.Game.timer.add(500,function(){fs.GameManager.start()})},D.jelly=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r);fs.AudioManager.playSound(88),fs.GameManager.stop();var s=[];r>8&&(s.push(r-9),r>17&&s.push(r-18),i[1]>0&&s.push(r-9-1),i[1]<8&&s.push(r-9+1)),r<63&&(s.push(r+9),r<54&&s.push(r+18),i[1]>0&&s.push(r+9-1),i[1]<8&&s.push(r+9+1)),i[1]>0&&(s.push(r-1),i[1]>1&&s.push(r-2)),i[1]<8&&(s.push(r+1),i[1]<7&&s.push(r+2)),t.disappear();for(var o in s){var u=s[o],a=fs.LayerManager.tilesList.element[u];a!=null&&a.hasOwnProperty("delFlag")&&!a.delFlag&&(a.setDelFlag(!0),fs.LayerManager.layerPropagation(u,e,"action_skill"))}fs.Game.timer.add(500,function(){fs.GameManager.start()})},D.jellyShort=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r);fs.AudioManager.playSound(88),fs.GameManager.stop();var s=[];r>8&&s.push(r-9),r<63&&s.push(r+9),i[1]>0&&s.push(r-1),i[1]<8&&s.push(r+1),t.disappear();for(var o in s){var u=s[o],a=fs.LayerManager.tilesList.element[u];a!=null&&a.hasOwnProperty("delFlag")&&!a.delFlag&&(a.setDelFlag(!0),fs.LayerManager.layerPropagation(u,e,"action_skill"))}fs.Game.timer.add(500,function(){fs.GameManager.start()})},D.rainbow=function(e,t,r){var i=this,s=i.gameObject,o=fs.CommonLayer.getIndex(s.x,s.y),u=fs.CommonLayer.getRowColunm(o),a=t;fs.GameManager.stop();var f=fs.ConfigManager.row*fs.ConfigManager.colunm;if(t==n){var t=[];for(var l=0;l<f;l++){var c=fs.LayerManager.tilesList.element[l];c!=null&&c.hasOwnProperty("delFlag")&&!c.delFlag&&c.color==e&&fs.BaseLayer.hasCanRemoveGeneralTile(l)&&t.push(l)}}t.forEach(function(e){var t=fs.LayerManager.tilesList.element[e];t.setDelFlag(!0),t.scoreMultiple=2});for(var l in t){var h=t[l],p=fs.LayerManager.tilesList.element[h];p.baofa.visible=!0,p.baofa.playAnimation("baofa")}fs.Game.timer.add(700,function(){if(a==n||r){fs.AudioManager.playSound(4);for(var i in t){var s=t[i];fs.LayerManager.layerPropagation(s,e,"action_skill")}fs.Game.timer.add(500,function(){fs.GameManager.start()})}else{fs.AudioManager.playSound(5);for(var i in t){var s=t[i],o=fs.LayerManager.tilesList.element[s];fs.DisFactory.autoDoSkillArray.push(o),o.setDelFlag(!1)}fs.GameManager.start()}})},D.magnet=function(e,t,r){var i=this,s=i.gameObject,o=fs.CommonLayer.getIndex(s.x,s.y),u=fs.CommonLayer.getRowColunm(o),a=t;fs.GameManager.stop();var f=fs.ConfigManager.row*fs.ConfigManager.colunm;if(t==n){var t=[];for(var l=0;l<f;l++){var c=fs.LayerManager.tilesList.element[l];c!=null&&c.hasOwnProperty("delFlag")&&!c.delFlag&&c.color==e&&t.push(l)}}t.forEach(function(e){var t=fs.LayerManager.tilesList.element[e];t.setDelFlag(!0),t.scoreMultiple=2});var h=function(e){var t=fs.LayerManager.tilesList.element[e];return t!=null&&fs.BaseLayer.hasCanRemoveGeneralTile(e)&&(t.class1=="base"||t.class1=="skill"&&t.class2=="normal"||t.class1=="skill"&&t.class2=="special")?!0:!1},p=fs.BaseLayer.getRoundPosArray(o,t.length,h),d=[];p.forEach(function(e){var t=fs.LayerManager.tilesList.element[e];t!=null&&!t.delFlag&&(t.setDelFlag(!0),d.push(e))});for(var l in d){var v=d[l],m=fs.LayerManager.tilesList.element[v];fs.LayerManager.layerPropagation(v,e,"action_skill")}var g=t.length,y=[],b=function(){if(--g<=0){for(var i in p){var s=p[i];fs.LayerManager.tilesList.element[s]=y[i]}fs.Game.timer.add(200,function(){for(var i in p){var s=p[i];fs.LayerManager.layerPropagation(s,e,"action_skill")}for(var i in t){var s=t[i];fs.LayerManager.tilesList.element[s]=null}a==n||r?fs.Game.timer.add(500,function(){fs.GameManager.start()}):fs.GameManager.start()})}};for(var l in t){var v=t[l],m=fs.LayerManager.tilesList.element[v],g=p.length,w=p[l];m.move(w,b,.35),y.push(m);var E=fs.LayerManager.tilesList.aboveElement[v];E!=null&&!E.delFlag&&E.removeTile(),m.baofa.visible=!0,m.baofa.playAnimation("baofa")}g==0&&fs.Game.timer.add(700,function(){fs.GameManager.start()})},D.horizonAndVertical=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r);fs.GameManager.stop();var s=[],o=i[0]*9;for(var u=0;u<9;u++){if(o==r){o++;continue}s.push(o),o++}var o=i[1];for(var u=0;u<8;u++){if(o==r){o+=9;continue}s.push(o),o+=9}fs.AudioManager.playSound(96),t.playExplode="shizi99",t.disappear();for(var u in s){var a=s[u],f=fs.LayerManager.tilesList.element[a];f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&(f.setDelFlag(!0),fs.LayerManager.layerPropagation(a,e,"action_skill"))}fs.Game.timer.add(500,function(){fs.GameManager.start()})},D.hvAndjelly=function(e){fs.BaseSkill.threeHVSkill.call(this,e)},D.hvAndRainbow=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r),s={1:[1007,1013],2:[1008,1014],3:[1009,1015],4:[1010,1016],5:[1011,1017],6:[1012,1018]},o=fs.ConfigManager.row*fs.ConfigManager.colunm,u=[];for(var a=0;a<o;a++){var f=fs.LayerManager.tilesList.element[a];f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&f.color==e&&fs.BaseLayer.hasCanRemoveGeneralTile(a)&&u.push(a)}for(var a in u){var l=u[a],c=fs.LayerManager.tilesList.element[l];if(c.class1=="base"){var h=fs.Game.math.random(0,s[e].length-1),p={tileID:s[e][h]};fs.TilePool.recoverTile(c),c=null;var d=fs.TileFactory.buildTile(l,p,"element"),f=fs.LayerManager.tilesList.element[l]=d;f.playMakeSkill()}}fs.BaseSkill.rainbow.call(this,e,u)},D.hvAndMagnet=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r),s={1:[1007,1013],2:[1008,1014],3:[1009,1015],4:[1010,1016],5:[1011,1017],6:[1012,1018]},o=fs.ConfigManager.row*fs.ConfigManager.colunm,u=[];for(var a=0;a<o;a++){var f=fs.LayerManager.tilesList.element[a];f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&f.color==e&&u.push(a)}for(var a in u){var l=u[a],c=fs.LayerManager.tilesList.element[l];if(c.class1=="base"){var h=fs.Game.math.random(0,s[e].length-1),p={tileID:s[e][h]};fs.TilePool.recoverTile(c),c=null;var d=fs.TileFactory.buildTile(l,p,"element"),f=fs.LayerManager.tilesList.element[l]=d;f.playMakeSkill()}}fs.BaseSkill.magnet.call(this,e,u)},D.hvAndXBomb=function(e){fs.BaseSkill.miSkill.call(this,e)},D.xBombAndJelly=function(e){fs.BaseSkill.threeHVSkill.call(this,e)},D.xBombAndRainbow=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r),s=fs.ConfigManager.row*fs.ConfigManager.colunm,o=[];for(var u=0;u<s;u++){var a=fs.LayerManager.tilesList.element[u];a!=null&&a.hasOwnProperty("delFlag")&&!a.delFlag&&a.color==e&&fs.BaseLayer.hasCanRemoveGeneralTile(u)&&o.push(u)}for(var u in o){var f=o[u],l=fs.LayerManager.tilesList.element[f],c={tileID:1034};fs.TilePool.recoverTile(l),l=null;var h=fs.TileFactory.buildTile(f,c,"element"),a=fs.LayerManager.tilesList.element[f]=h;a.playMakeSkill()}fs.BaseSkill.rainbow.call(this,e,o)},D.xBombAndMagnet=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r),s=fs.ConfigManager.row*fs.ConfigManager.colunm,o=[];for(var u=0;u<s;u++){var a=fs.LayerManager.tilesList.element[u];a!=null&&a.hasOwnProperty("delFlag")&&!a.delFlag&&a.color==e&&o.push(u)}for(var u in o){var f=o[u],l=fs.LayerManager.tilesList.element[f],c={tileID:1034};fs.TilePool.recoverTile(l),l=null;var h=fs.TileFactory.buildTile(f,c,"element"),a=fs.LayerManager.tilesList.element[f]=h;a.playMakeSkill()}fs.BaseSkill.magnet.call(this,e,o)},D.xBombAndXBomb=function(e){fs.BaseSkill.miSkill.call(this,e)},D.jellyAndJelly=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r);fs.AudioManager.playSound(87),fs.GameManager.stop();var s=[],o=1,u=[i[0],7-i[0],i[1],8-i[1]],a=!0;while(a)[r-9*o,r+9*o,r-1*o,r+1*o,r-9*o-1,r-9*o+1,r+9*o-1,r+9*o+1].forEach(function(e,t){if((t==0||t==4||t==5)&&o>u[0])return;if((t==1||t==6||t==7)&&o>u[1])return;if(t==2&&o>u[2])return;if(t==3&&o>u[3])return;if((t==4||t==6)&&u[2]<1)return;if((t==5||t==7)&&u[3]<1)return;o==3&&t==4&&(e=r-10-1),o==3&&t==5&&(e=r-8+1),o==3&&t==6&&(e=r+8-1),o==3&&t==7&&(e=r+10+1),s.push(e)}),o==3&&(a=!1),o++;t.playExplode="area3",t.disappear();for(var f in s){var l=s[f],c=fs.LayerManager.tilesList.element[l];c!=null&&c.hasOwnProperty("delFlag")&&!c.delFlag&&(c.setDelFlag(!0),fs.LayerManager.layerPropagation(l,e,"action_skill"))}fs.Game.timer.add(500,function(){fs.GameManager.start()})},D.jellyAndRainbow=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r),s=fs.ConfigManager.row*fs.ConfigManager.colunm,o=[];for(var u=0;u<s;u++){var a=fs.LayerManager.tilesList.element[u];a!=null&&a.hasOwnProperty("delFlag")&&!a.delFlag&&a.color==e&&fs.BaseLayer.hasCanRemoveGeneralTile(u)&&o.push(u)}for(var u in o){var f=o[u],l=fs.LayerManager.tilesList.element[f],c={tileID:1035};fs.TilePool.recoverTile(l),l=null;var h=fs.TileFactory.buildTile(f,c,"element"),a=fs.LayerManager.tilesList.element[f]=h;a.playMakeSkill()}fs.BaseSkill.rainbow.call(this,e,o)},D.jellyAndMagnet=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r),s=fs.ConfigManager.row*fs.ConfigManager.colunm,o=[];for(var u=0;u<s;u++){var a=fs.LayerManager.tilesList.element[u];a!=null&&a.hasOwnProperty("delFlag")&&!a.delFlag&&a.color==e&&o.push(u)}for(var u in o){var f=o[u],l=fs.LayerManager.tilesList.element[f],c={tileID:1035};fs.TilePool.recoverTile(l),l=null;var h=fs.TileFactory.buildTile(f,c,"element"),a=fs.LayerManager.tilesList.element[f]=h;a.playMakeSkill()}fs.BaseSkill.magnet.call(this,e,o)},D.rainbowAndRainbow=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r),s=fs.ConfigManager.row*fs.ConfigManager.colunm,o=[];for(var u=0;u<s;u++){var a=fs.LayerManager.tilesList.element[u];a!=null&&a.hasOwnProperty("delFlag")&&!a.delFlag&&a.class2!="super"&&o.push(u)}fs.BaseSkill.rainbow.call(this,e,o,!0)},D.rainbowAndMagnet=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r),s=fs.ConfigManager.row*fs.ConfigManager.colunm,o=[];for(var u=1;u<7;u++)for(var a=0;a<s;a++){var f=fs.LayerManager.tilesList.element[a];f.color==u&&f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&f.color<=6&&f.color!=null&&f.class2!="super"&&o.push(a)}fs.BaseSkill.magnet.call(this,e,o,!0)},D.magnetAndMagnet=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r),s=fs.ConfigManager.row*fs.ConfigManager.colunm,o=[];for(var u=1;u<7;u++)for(var a=0;a<s;a++){var f=fs.LayerManager.tilesList.element[a];f.color==u&&f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&f.color<=6&&f.color!=null&&f.class2!="super"&&o.push(a)}fs.BaseSkill.magnet.call(this,e,o,!0)},D.threeHVSkill=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r);fs.GameManager.stop();var s=[],o=i[0]*9;for(var u=0;u<9;u++){if(o==r){o++;continue}s.push(o),s.push(o+9),s.push(o-9),o++}var o=i[1];for(var u=0;u<8;u++){if(o==r){o+=9;continue}s.push(o),s.push(o-1),s.push(o+1),o+=9}fs.AudioManager.playSound(92),t.explode.texture=t.game.assets.find("line"),t.playExplode="shizi100",t.disappear(),s=fs.CommonLayer.removeDuplicateArray(s);for(var u in s){var a=s[u],f=fs.LayerManager.tilesList.element[a];f!=null&&f.hasOwnProperty("delFlag")&&!f.delFlag&&(f.setDelFlag(!0),fs.LayerManager.layerPropagation(a,e,"action_skill"))}fs.Game.timer.add(500,function(){fs.GameManager.start()})},D.miSkill=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y),i=fs.CommonLayer.getRowColunm(r);fs.GameManager.stop();var s=[],o=1,u=[i[0],7-i[0],i[1],8-i[1]],a=!0,f=0;while(a)[r-9*o,r+9*o,r-1*o,r+1*o,r-10*o,r-8*o,r+8*o,r+10*o].forEach(function(e,t){if((t==0||t==4||t==5)&&o>u[0]){f++;return}if((t==1||t==6||t==7)&&o>u[1]){f++;return}if((t==2||t==4||t==6)&&o>u[2]){f++;return}if((t==3||t==5||t==7)&&o>u[3]){f++;return}s.push(e)}),f>=8?a=!1:f=0,o++;fs.AudioManager.playSound(97),t.playExplode="mi99",t.disappear();for(var l in s){var c=s[l],h=fs.LayerManager.tilesList.element[c];h!=null&&h.hasOwnProperty("delFlag")&&!h.delFlag&&(h.setDelFlag(!0),fs.LayerManager.layerPropagation(c,e,"action_skill"))}fs.Game.timer.add(500,function(){fs.GameManager.start()})};var P=qc.defineBehaviour("qc.engine.BaseTile",qc.Behaviour,function(){var e=this;e.delFlag=!1,e.moveFlag=!1,e.newFlag=!1,e.disCount=1,e.scoreMultiple=1},{icon:qc.Serializer.NODE,icon_ani:qc.Serializer.NODE,explode:qc.Serializer.NODE,make_skill:qc.Serializer.NODE,baofa:qc.Serializer.NODE});P.prototype.extend=function(e){var t=this;for(var n in e)t[n]=e[n],n=="setType"&&t.setType(),n=="init"&&t.init()},P.prototype.setData=function(e,t,n){var r=this,i=parseInt(t.tileID),s=fs.ConfigManager.excelData.tiles[i];t.hasOwnProperty("hp")&&(r.hp=parseInt(t.hp));for(var o in s){if(o=="foreground")if(s[o]==null)r.icon.alpha=0;else if(s[o].indexOf("%d")!=-1){var u=s[o].split("%d");r.icon.frame=u[0]+r.hp+u[1]}else r.icon.frame=s[o];o=="height"&&(s[o]==2&&(r.icon.height=2*r.icon.height,r.icon.y=-40),s[o]==3&&(r.icon.height=3*r.icon.height,r.icon.y=-80),s[o]==5&&(r.icon.height=5*r.icon.height,r.icon.y=-160),s[o]==4&&(r.icon.height=4*r.icon.height,r.icon.y=-120)),o=="width"&&(s[o]==2&&(r.icon.width=2*r.icon.width,r.icon.x=40),s[o]==3&&(r.icon.width=3*r.icon.width,r.icon.x=80),s[o]==4&&(r.icon.width=4*r.icon.width,r.icon.x=120)),r[o]=s[o]}n?(r.gameObject.x=fs.CommonLayer.pivotX(e),r.gameObject.y=fs.CommonLayer.pivotY(e)-fs.ConfigManager.gridH,r.newFlag=!0):(r.gameObject.x=fs.CommonLayer.pivotX(e),r.gameObject.y=fs.CommonLayer.pivotY(e)),r.icon.frame=s.foreground,i==2601&&(r.icon.resetNativeSize(),r.icon.y+=55),i==2602&&(r.icon.resetNativeSize(),r.icon.y-=55),i==2601?(r.icon_ani.visible=!0,r.icon_ani.y+=55,r.icon_ani.texture=fs.ConfigManager.spriteData.port_up,r.icon_ani.playAnimation("port_up")):i==2602?(r.icon_ani.visible=!0,r.icon_ani.y-=55,r.icon_ani.texture=fs.ConfigManager.spriteData.port_down,r.icon_ani.playAnimation("port_down")):i==1201?(r.icon.visible=!1,r.icon_ani.visible=!0,r.icon_ani.texture=fs.ConfigManager.spriteData.cow,r.icon_ani.defaultAnimation="animation2"):i==1101?r.icon_ani.texture=fs.ConfigManager.spriteData.bee:r.icon_ani.texture=fs.ConfigManager.spriteData.particle;if(s.spine)r.explode.texture=fs.ConfigManager.spriteData[s.spine],i==2401?r.playExplode="wangdou":r.playExplode=s.spine;else if(i>=1007&&i<=1024||i==1034)r.explode.texture=fs.ConfigManager.spriteData.skill,i>=1007&&i<=1012&&(r.playExplode="heng"),i>=1013&&i<=1018&&(r.playExplode="shu"),i>=1019&&i<=1024&&(r.playExplode="xx99"),i==1034&&(r.playExplode="xx2");else if(i>=1025&&i<=1030||i==1035)r.explode.texture=fs.ConfigManager.spriteData.jelly,i>=1025&&i<=1030&&(r.playExplode="area2"),i==1035&&(r.playExplode="area1")},P.prototype.move=function(e,t,n){var r=this,i=r.gameObject,s=n||.08,o=i.getScript("qc.TweenPosition");o.from=new qc.Point(i.x,i.y),o.to=new qc.Point(fs.CommonLayer.pivotX(e),fs.CommonLayer.pivotY(e)),o.duration=s,o.onFinished.addOnce(function(){typeof t=="function"&&r.game.timer.add(100,t)}),o.resetToBeginning(),o.playForward()},P.prototype.moveSkill=function(e,t){var n=this,r=n.gameObject,i=n.game.add.clone(n.icon,fs.LayerManager.node.element);i.x=r.x,i.y=r.y,n.icon.visible=!1;var s=i.getScript("qc.TweenPosition");s.from=new qc.Point(i.x,i.y),s.to=new qc.Point(fs.CommonLayer.pivotX(e),fs.CommonLayer.pivotY(e)),s.duration=.15,s.onFinished.addOnce(function(){i.destroy(),typeof t=="function"&&t()}),s.resetToBeginning(),s.playForward()},P.prototype.dropMove=function(e,t,n,r){var i=this,s=e.length;isPortal=!1;var o=i.gameObject,u=o.getScript("qc.TweenPosition"),a=e[t];fs.LayerManager.wormholeData.forEach(function(e){e.index==a&&!e.hasOwnProperty("transferPosition")&&(isPortal=!0)},this),u.duration=n,isPortal?(u.from=new qc.Point(o.x,o.y),u.to=new qc.Point(o.x,o.y+fs.ConfigManager.gridH),u.onFinished.addOnce(function(){o.x=fs.CommonLayer.pivotX(a),o.y=fs.CommonLayer.pivotY(a)-fs.ConfigManager.gridH,u.from=new qc.Point(o.x,o.y),u.to=new qc.Point(fs.CommonLayer.pivotX(a),fs.CommonLayer.pivotY(a)),u.onFinished.addOnce(function(){t++,t<s?i.game.timer.add(1,function(){i.dropMove(e,t,n,r)}):typeof r=="function"&&r()}),u.resetToBeginning(),u.playForward()}),u.resetToBeginning(),u.playForward()):(u.from=new qc.Point(o.x,o.y),u.to=new qc.Point(fs.CommonLayer.pivotX(a),fs.CommonLayer.pivotY(a)),u.onFinished.addOnce(function(){t++,t<s?i.game.timer.add(1,function(){i.dropMove(e,t,n,r)}):typeof r=="function"&&r()}),u.resetToBeginning(),u.playForward())},P.prototype.disappear=function(e){var t=this;t.icon.visible=!1,t.explode.visible=!0,t.explode.onFinished.addOnce(function(){t.gameObject.destroy(),typeof e=="function"&&e()}),t.explode.playAnimation(t.playExplode)},P.prototype.setDelFlag=function(e){var t=this;t.delFlag=e},P.prototype.setMoveFlag=function(e){var t=this;t.moveFlag=e},P.prototype.setNewFlag=function(e){var t=this;t.newFlag=e},P.prototype.cantSwap=function(e,t){var n=this,r=n.gameObject,i=r.getScript("qc.TweenScale"),s=r.getScript("qc.TweenPosition"),o=25;e=="left"?(i.from=new qc.Point(1,1),i.to=new qc.Point(.7,1.3),s.from=new qc.Point(r.x,r.y),s.to=new qc.Point(r.x-o,r.y)):e=="right"?(i.from=new qc.Point(1,1),i.to=new qc.Point(.7,1.3),s.from=new qc.Point(r.x,r.y),s.to=new qc.Point(r.x+o,r.y)):e=="top"?(i.from=new qc.Point(1,1),i.to=new qc.Point(1.3,.7),s.from=new qc.Point(r.x,r.y),s.to=new qc.Point(r.x,r.y-o)):e=="bottom"&&(i.from=new qc.Point(1,1),i.to=new qc.Point(1.3,.7),s.from=new qc.Point(r.x,r.y),s.to=new qc.Point(r.x,r.y+o)),i.duration=.15,s.duration=.15,i.onFinished.addOnce(function(){var e=i.to,n=i.from;i.from=e,i.to=n,i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){typeof t=="function"&&t()})}),s.onFinished.addOnce(function(){var e=s.to,t=s.from;s.from=e,s.to=t,s.resetToBeginning(),s.playForward()}),i.resetToBeginning(),i.playForward(),s.resetToBeginning(),s.playForward()},P.prototype.playMakeSkill=function(){var e=this;e.make_skill.visible=!0,e.make_skill.onFinished.addOnce(function(){e.make_skill.visible=!1}),e.make_skill.playAnimation("skill_normal")},P.prototype.noticeSwap=function(e,t){var n=this,r=n.gameObject,i=fs.CommonLayer.getIndex(r.x,r.y),s=fs.CommonLayer.pivotX(i),o=fs.CommonLayer.pivotY(i),u=r.getScript("qc.TweenScale"),a=r.getScript("qc.TweenPosition");n.game.input.mouse.enable=!1,n.game.input.touch.enable=!1;var f=20;fs.GameManager.FSM.state=="waitUser"&&(e=="left"?(u.from=new qc.Point(1,1),u.to=new qc.Point(.8,1.2),a.from=new qc.Point(s,o),a.to=new qc.Point(s-f,o)):e=="right"?(u.from=new qc.Point(1,1),u.to=new qc.Point(.8,1.2),a.from=new qc.Point(s,o),a.to=new qc.Point(s+f,o)):e=="top"?(u.from=new qc.Point(1,1),u.to=new qc.Point(1.2,.8),a.from=new qc.Point(s,o),a.to=new qc.Point(s,o-f)):e=="bottom"&&(u.from=new qc.Point(1,1),u.to=new qc.Point(1.2,.8),a.from=new qc.Point(s,o),a.to=new qc.Point(s,o+f)),u.duration=.17,a.duration=.17,u.onFinished.addOnce(function(){var e=u.to,t=u.from;u.from=e,u.to=t,u.resetToBeginning(),u.playForward(),u.onFinished.addOnce(function(){var e=u.to,t=u.from;u.from=e,u.to=t,u.resetToBeginning(),u.playForward(),u.onFinished.addOnce(function(){var e=u.to,t=u.from;u.from=e,u.to=t,u.resetToBeginning(),u.playForward()})})}),a.onFinished.addOnce(function(){var e=a.to,n=a.from;a.from=e,a.to=n,a.resetToBeginning(),a.playForward(),a.onFinished.addOnce(function(){var e=a.to,n=a.from;a.from=e,a.to=n,a.resetToBeginning(),a.playForward(),a.onFinished.addOnce(function(){var e=a.to,n=a.from;a.from=e,a.to=n,a.resetToBeginning(),a.playForward(),typeof t=="function"&&t()})})}),u.resetToBeginning(),u.playForward(),a.resetToBeginning(),a.playForward())},P.prototype.canSwapByDirection=function(e){var t=this,n=t.gameObject,r=fs.CommonLayer.getIndex(n.x,n.y);return t.isSwap&&fs.BaseLayer.isCanSwap(r,e)?!0:!1},P.prototype.sendTaskData=function(){var e=this;fs.ScenesUI.getDisTarget(e)};var H=qc.fs.BeeTile={};H.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")i.sendTaskData(),i.removeTile();else if(t=="action_round")return!0;return!1},H.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.GameManager.stop(),e.icon.visible=!1,e.icon_ani.visible=!0,e.icon_ani.onFinished.addOnce(function(){e.icon_ani.visible=!1,e.explode.visible=!0,e.explode.playAnimation(e.playExplode),e.produce(t),fs.AudioManager.playSound(62),fs.LayerManager.tilesList.element[t]=null,e.explode.onFinished.addOnce(function(){e.gameObject.destroy()}),fs.GameManager.start()}),e.icon_ani.playAnimation("die")},H.produce=function(e){var t=this;fs.Game.timer.add(100,function(){var t={tileID:1102},n=fs.TileFactory.buildTile(e,t,"belowElement");fs.LayerManager.tilesList.belowElement[e]=n})};var B=qc.fs.CeilTile={};B.doAction=function(e,t,n,r){var i=this,s=fs.CommonLayer.getIndex(i.gameObject.x,i.gameObject.y),o=fs.LayerManager.tilesList.element[s];o!=null&&o.setDelFlag(!1);if(t=="action_self"||t=="action_skill"||t=="action_props")return i.removeTile(),t=="action_self"&&n?!1:!0},B.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.AudioManager.playSound(67),fs.LayerManager.tilesList.aboveElement[t]=null,e.disappear()};var F=qc.fs.CoconutJuiceTile={};F.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")i.sendTaskData(),i.removeTile();else if(t=="action_round")return!0;return!1},F.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.AudioManager.playSound(63),fs.LayerManager.tilesList.element[t]=null,e.icon.visible=!1,e.explode.visible=!0,e.explode.onFinished.addOnce(function(){fs.TilePool.recoverTile(e)}),e.explode.playAnimation(e.playExplode)};var I=qc.fs.CoconutTile={};I.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")i.sendTaskData(),t=="action_skill"?i.changeSelf():i.removeTile();else if(t=="action_round")return!0;return!1},I.changeSelf=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y),n={tileID:1104};e.removeTile();var r=fs.TileFactory.buildTile(t,n,"element");fs.LayerManager.tilesList.element[t]=r},I.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.LayerManager.tilesList.element[t]=null,e.icon.visible=!1,e.explode.visible=!0,e.explode.onFinished.addOnce(function(){fs.TilePool.recoverTile(e)}),e.explode.playAnimation(e.playExplode)};var q=qc.fs.CookieTile={};q.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.AudioManager.playSound(65),fs.LayerManager.tilesList.belowElement[t]=null,e.disappear()};var R=qc.fs.BossSkill={};R.skillObj={},R.skillStepCount=0,R.bossState=null,R.initBossSkillData=function(){var e=this,t=fs.ConfigManager.excelData.zone,n=fs.ConfigManager.excelData.skill,r=fs.ConfigManager.excelData.skillArea;if(fs.ScenesUI.gameMode!="trouble"){fs.GameManager.changeFSM();return}var i=t[fs.ConfigManager.levelID].ai.split(";"),s=parseInt(i[2]),o=n[s],u=r[o.area];if(i.length>3)var a=r[parseInt(i[3])].areaList;e.skillObj.aiList=i,e.skillObj.tileID=o.tileID,e.skillObj.tileNumber=o.tileNumber,e.skillObj.tileRate=o.tileRate,e.skillObj.tileHP=o.tileHP,e.skillObj.area=o.area,e.getSkillObjPosition()},R.getSkillObjPosition=function(){var e=this,t=[];if(e.skillObj.area==7){var n=fs.LayerManager.tilesList.element;for(var r=0;r<n.length;r++){if(n[r]==null)continue;n[r].class1=="base"&&fs.BaseLayer.isBinded(r)==0&&t.push(r)}}if(e.skillObj.area==11){var i=fs.ConfigManager.excelData.skillArea,s=i[parseInt(e.skillObj.aiList[3])].areaList;s=s.split(";");for(var o=0;o<s.length;o++){var u=s[o].split("_");u[0]=parseInt(u[0]),u[1]=parseInt(u[1]);var a=fs.CommonLayer.getIndexFromRowAndCol(u[0]-1,u[1]-1);if(fs.LayerManager.tilesList.element[a]==null)continue;fs.BaseLayer.isBinded(a)==0&&fs.LayerManager.tilesList.element[a].class1=="base"&&t.push(a)}}e.skillObj.skillPosition=t,e.doThrowSkillObj()},R.doThrowSkillObj=function(){var e=this,t=null,n=e.skillObj.tileNumber,r=0;fs.Game.math.shuffle(e.skillObj.skillPosition);if(e.skillObj.tileID==2401)t="aboveElement";else if(e.skillObj.tileID==1109||e.skillObj.tileID==1096)t="element";if(e.skillStepCount==parseInt(e.skillObj.aiList[1]))fs.ActorAnimation.actorState="prepare",fs.ActorAnimation.playActorAnimation(),fs.AudioManager.playSound(6),e.bossState="ready",fs.GameManager.changeFSM();else if(e.skillStepCount==parseInt(e.skillObj.aiList[1])+1){fs.GameManager.stop(),fs.GameManager.game.input.touch.enable=!1,fs.GameManager.game.input.mouse.enable=!1,fs.ActorAnimation.isActorMove=!1,fs.ActorAnimation.actorState="attack",fs.ActorAnimation.playActorAnimation(),fs.AudioManager.playSound(10);var i=function(e,t,n,i){if(e==null)r+=1;else{var s=fs.TileFactory.buildTile(e,t,"obstacleVertical");s.gameObject.x=360,s.gameObject.y=-160;var o=s.getScript("qc.TweenPosition");o.from=new qc.Point(360,-110),o.to=new qc.Point(fs.CommonLayer.pivotX(e),fs.CommonLayer.pivotY(e)),o.duration=.4,o.delay=.4,o.resetToBeginning(),o.playForward(),o.onFinished.addOnce(function(){r+=1,s.gameObject.destroy(),n=="element"&&fs.TilePool.recoverTile(fs.LayerManager.tilesList[n][e]);var o=fs.TileFactory.buildTile(e,t,n);fs.LayerManager.tilesList[n][e]=o,i()})}},s=function(){r==n&&(fs.GameManager.start(),fs.GameManager.changeFSM())};for(var o=0;o<n;o++){var u=e.skillObj.skillPosition.pop(),a={};a.tileID=e.skillObj.tileID,a.hp=e.skillObj.tileHP,t=="element"?i(u,a,t,s):t=="aboveElement"&&i(u,a,t,s)}e.skillStepCount=0}else fs.GameManager.changeFSM()},R.bossSkillLogic=function(){var e=this;(fs.TaskLogic.bossDownHP-fs.TaskLogic.bossHP)/fs.TaskLogic.bossHPDefault>.1?(fs.ActorAnimation.actorState="stun",fs.ActorAnimation.playActorAnimation(),fs.AudioManager.playSound(11),e.bossState=="ready"?e.skillStepCount=0:e.skillStepCount-=1,fs.GameManager.changeFSM()):e.initBossSkillData()};var U=qc.fs.extend=function(e,t){var n=t.prototype,r=e.prototype;for(var i in n)r[i]=n[i];r.uber=n},z=qc.fs.GeneralTile={};z.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")i.sendTaskData(),i.removeTile();else if(t=="action_round")return!0;return!1},z.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y),n=2;fs.AudioManager.playSound(79),fs.LayerManager.tilesList.element[t]=null,e.icon.visible=!1,e.explode.visible=!0,e.icon_ani.visible=!0;var r=function(){--n<=0&&fs.TilePool.recoverTile(e)};e.explode.onFinished.addOnce(function(){e.explode.visible=!1,r()}),e.icon_ani.onFinished.addOnce(function(){e.icon_ani.visible=!1,r()}),e.explode.playAnimation(e.playExplode),e.icon_ani.playAnimation("tile_lizi")};var W=qc.fs.HoneyTile={};W.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")return i.sendTaskData(),i.removeTile(),!0},W.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.AudioManager.playSound(66),fs.LayerManager.tilesList.belowElement[t]=null,e.disappear()};var X=qc.fs.HPTile={};X.doAction=function(e,t,n,r){var i=this;return(i.id==1109||i.id==1096)&&fs.AudioManager.playSound(70),i.hp--,i.hp==0?i.removeTile():(i.updateIcon(),i.setDelFlag(!1)),i.sendTaskData(),!0},X.updateIcon=function(){var e=this,t=e.icon.frame.match(/\d+/g),n=e.icon.frame.split(t);e.icon.frame=n[0]+e.hp+n[1],e.explode.visible=!0,e.explode.onFinished.addOnce(function(){e.explode.visible=!1}),e.explode.playAnimation(e.playExplode)},X.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.LayerManager.tilesList.element[t]=null,e.disappear()};var V=qc.fs.IceTile={};V.doAction=function(e,t,n,r){var i=this;return fs.AudioManager.playSound(68),i.hp--,i.hp==0?i.removeTile():(i.updateIcon(),i.setDelFlag(!1)),!1},V.updateIcon=function(){var e=this,t=e.icon.frame.match(/\d+/g),n=e.icon.frame.split(t);e.icon.frame=n[0]+e.hp+n[1],e.explode.visible=!0,e.explode.onFinished.addOnce(function(){e.explode.visible=!1}),e.explode.playAnimation(e.playExplode)},V.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.LayerManager.tilesList.belowElement[t]=null,e.disappear()};var $=qc.fs.PopsicleTile={};$.doAction=function(e,t,n,r){var i=this;return i.hasCanRemove()&&(i.sendTaskData(),i.removeTile()),!0},$.hasCanRemove=function(){var e=this,t=!0;return e.range.forEach(function(e){fs.LayerManager.tilesList.belowElement[e]!=null&&(t=!1)}),t},$.playRemoveSprite=function(e){var t=this,n=t.gameObject,r=t.icon,i=r.addScript("qc.TweenScale"),s=r.addScript("qc.TweenPosition"),o=r.addScript("qc.TweenAlpha");fs.LayerManager.node.board.addChild(n),i.duration=.3,s.duration=.3,o.duration=.3,i.from=new qc.Point(1,1),i.to=new qc.Point(1.5,1.5),i.onFinished.addOnce(function(){s.from=new qc.Point(r.x,r.y),s.to=new qc.Point(r.x,r.y-200),o.from=1,o.to=0,s.onFinished.addOnce(function(){n.destroy()}),s.resetToBeginning(),s.playForward(),o.resetToBeginning(),o.playForward()}),i.resetToBeginning(),i.playForward()},$.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.AudioManager.playSound(69),e.range.forEach(function(e){fs.LayerManager.tilesList.popsicle[e]=null}),e.playRemoveSprite()};var J=qc.fs.RainbowiceTile={};J.doAction=function(e,t,n,r){var i=this;return t=="action_skill"||t=="action_props"?(i.sendTaskData(),i.removeTile()):t=="action_round"&&(i.sendTaskData(),i.changeSelf(e)),!0},J.changeSelf=function(e){var t=this,n=fs.CommonLayer.getIndex(t.gameObject.x,t.gameObject.y),r=fs.BaseLayer.getTileIDByColor(e);t.removeTile();var i=fs.TilePool.getTile(n,r);fs.LayerManager.tilesList.element[n]=i,i.icon_ani.visible=!0,i.explode.onFinished.addOnce(function(){i.icon_ani.visible=!1}),i.icon_ani.playAnimation("tile_lizi")},J.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.LayerManager.tilesList.element[t]=null,fs.TilePool.recoverTile(e);return};var K=qc.fs.SkillHorizonTile={};K.setType=function(){var e=this;e.type="SKILL_HORIZON"},K.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")i.sendTaskData(),i.doSkill(e),i.removeTile();else if(t=="action_round")return!0;return!1},K.doSkill=function(e){var t=this;t.filterSkill(e)},K.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.LayerManager.tilesList.element[t]=null,e.type=="SKILL_NOTHING"&&(e.icon.visible=!1,e.icon_ani.visible=!0,e.icon_ani.onFinished.addOnce(function(){e.gameObject.destroy()}),e.icon_ani.playAnimation("tile_lizi"))};var Q=qc.fs.SkillJellyShortTile={};Q.setType=function(){var e=this;e.type="SKILL_JELLY_SHORT"},Q.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")i.sendTaskData(),i.doSkill(e),i.removeTile();else if(t=="action_round")return!0;return!1},Q.doSkill=function(e){var t=this;t.filterSkill(e)},Q.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.LayerManager.tilesList.element[t]=null,e.type=="SKILL_NOTHING"&&(e.icon.visible=!1,e.icon_ani.visible=!0,e.icon_ani.onFinished.addOnce(function(){e.gameObject.destroy()}),e.icon_ani.playAnimation("tile_lizi"))};var G=qc.fs.SkillJellyTile={};G.setType=function(){var e=this;e.type="SKILL_JELLY"},G.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")i.sendTaskData(),i.doSkill(e),i.removeTile();else if(t=="action_round")return!0;return!1},G.doSkill=function(e){var t=this;t.filterSkill(e)},G.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.LayerManager.tilesList.element[t]=null,e.type=="SKILL_NOTHING"&&(e.icon.visible=!1,e.icon_ani.visible=!0,e.icon_ani.onFinished.addOnce(function(){e.gameObject.destroy()}),e.icon_ani.playAnimation("tile_lizi"))};var Y=qc.fs.SkillMagnetTile={};Y.setType=function(){var e=this;e.type="SKILL_MAGNET"},Y.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")i.sendTaskData(),i.doSkill(e),i.removeTile();else if(t=="action_round")return!0;return!1},Y.doSkill=function(e){var t=this;t.filterSkill(e)},Y.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);e.baofa.visible=!0,e.baofa.playAnimation("baofa"),fs.Game.timer.add(700,function(){e.gameObject.destroy(),fs.LayerManager.tilesList.element[t]=null})};var Z=qc.fs.SkillRainbowTile={};Z.setType=function(){var e=this;e.type="SKILL_RAINBOW"},Z.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")i.sendTaskData(),i.doSkill(e),i.removeTile();else if(t=="action_round")return!0;return!1},Z.doSkill=function(e){var t=this;t.filterSkill(e)},Z.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);e.baofa.visible=!0,e.baofa.playAnimation("baofa"),fs.Game.timer.add(700,function(){e.gameObject.destroy(),fs.LayerManager.tilesList.element[t]=null})};var et=qc.fs.SkillVerticalTile={};et.setType=function(){var e=this;e.type="SKILL_VERTICAL"},et.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")i.sendTaskData(),i.doSkill(e),i.removeTile();else if(t=="action_round")return!0;return!1},et.doSkill=function(e){var t=this;t.filterSkill(e)},et.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.LayerManager.tilesList.element[t]=null,e.type=="SKILL_NOTHING"&&(e.icon.visible=!1,e.icon_ani.visible=!0,e.icon_ani.onFinished.addOnce(function(){e.gameObject.destroy()}),e.icon_ani.playAnimation("tile_lizi"))};var tt=qc.fs.SkillXBombShortTile={};tt.setType=function(){var e=this;e.type="SKILL_XBOMB_SHORT"},tt.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")i.sendTaskData(),i.doSkill(e),i.removeTile();else if(t=="action_round")return!0;return!1},tt.doSkill=function(e){var t=this;t.filterSkill(e)},tt.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.LayerManager.tilesList.element[t]=null,e.type=="SKILL_NOTHING"&&(e.icon.visible=!1,e.icon_ani.visible=!0,e.icon_ani.onFinished.addOnce(function(){e.gameObject.destroy()}),e.icon_ani.playAnimation("tile_lizi"))};var nt=qc.fs.SkillXBombTile={};nt.setType=function(){var e=this;e.type="SKILL_XBOMB"},nt.doAction=function(e,t,n,r){var i=this;if(t=="action_self"||t=="action_skill"||t=="action_props")i.sendTaskData(),i.doSkill(e),i.removeTile();else if(t=="action_round")return!0;return!1},nt.doSkill=function(e){var t=this;t.filterSkill(e)},nt.removeTile=function(){var e=this,t=fs.CommonLayer.getIndex(e.gameObject.x,e.gameObject.y);fs.LayerManager.tilesList.element[t]=null,e.type=="SKILL_NOTHING"&&(e.icon.visible=!1,e.icon_ani.visible=!0,e.icon_ani.onFinished.addOnce(function(){e.gameObject.destroy()}),e.icon_ani.playAnimation("tile_lizi"))};var rt=qc.fs.TileBuilder={};rt.getInfo=function(){var e=this,t=fs.Game.assets.find("levelConfig");return rt.getDropPointList(JSON.parse(t.text))},rt.getDropPointList=function(e){var t=this,r=fs.ConfigManager.levelID,i=fs.ConfigManager.excelData.zone,s=[],o=[],u=i[r].fillID.toString().indexOf(";");u!=-1?s=u.split(";"):s.push(i[r].fillID);for(var a=0;a<s.length;a++){var f=fs.ConfigManager.excelData.fillid[s[a]].fillRule,l=fs.ConfigManager.excelData.fillRule[f].tileList.split(";"),c=[],h=fs.ConfigManager.excelData.fillRule[f].tileProbability,p=fs.ConfigManager.excelData.fillRule[f].useRuleTime;t.dropPointList=[];var d=[],v=h.split(";"),m=0;for(var g=0;g<v.length;g++)m+=parseInt(v[g]);for(var y=0;y<v.length;y++)d[y]=parseInt(v[y]);for(var y=0;y<9;y++){if(e.layers[0].data[y]==1||e.layers[0].data[y]==2||e.layers[6].data[y]!=0)continue;t.dropPointList[y]={},t.dropPointList[y][a]={},t.dropPointList[y][a].elementList=l,t.dropPointList[y][a].dropPosibility=d,t.dropPointList[y][a].useTime=p}var b=[];for(var y=0;y<72;y++)if(e.layers[6].data[y]!=0){b[y]={},b[y]=t.transformID(y,e,e.layers[6].data[y]);if(b[y].tileID=="2602"||b[y].tileID=="2601")continue;var w=fs.ConfigManager.excelData.fillid[b[y].fillID].fillRule;t.dropPointList[y]={};if(w.toString().indexOf(";")!=-1)o=w.toString().split(";");else{if(fs.ConfigManager.excelData.fillRule[w].tileList.length==n)var E=fs.ConfigManager.excelData.fillRule[w].tileList;else var E=fs.ConfigManager.excelData.fillRule[w].tileList.split(";");var S=[],x=fs.ConfigManager.excelData.fillRule[w].tileProbability,T=fs.ConfigManager.excelData.fillRule[w].useRuleTime,N=[],C=x;if(x.length==n){var k=x;N=[k]}else{var k=x.split(";");for(var L=0;L<k.length;L++)N[L]=parseInt(k[L])}t.dropPointList[y][a]={},t.dropPointList[y][a].elementList=E,t.dropPointList[y][a].dropPosibility=N,t.dropPointList[y][a].useTime=T}for(var a=0;a<o.length;a++){var E=fs.ConfigManager.excelData.fillRule[o[a]].tileList.split(";"),x=fs.ConfigManager.excelData.fillRule[o[a]].tileProbability,T=fs.ConfigManager.excelData.fillRule[o[a]].useRuleTime,N=[],C=x.split(";"),S=[];for(var L=0;L<C.length;L++)N[L]=parseInt(C[L]);t.dropPointList[y][a]={},t.dropPointList[y][a].elementList=E,t.dropPointList[y][a].dropPosibility=N,t.dropPointList[y][a].useTime=T}}else b[y]=null}return t.dropPointList},rt.transformID=function(e,t,n){var r=t.tilesets,i=null;for(var s in r)r[s].firstgid==n&&(i=r[s].tileproperties[0]);return i};var it=function(){var e=this};it.prototype.buildTile=function(e,t,n,r){var i=this,s=parseInt(t.tileID);if(s==2001||s==2002||s==2003){var o=fs.ConfigManager.excelData.tiles[s];return o}if(s==2006)return null;var u=fs.Game.add.clone(fs.LayerManager.tilePrefab,fs.LayerManager.node[n]),a=u.getScript("qc.engine.BaseTile");a.setData(e,t,r),s<=1006&&a.extend(fs.GeneralTile),s>=1007&&s<=1012&&(a.extend(fs.BaseSkill),a.extend(fs.SkillHorizonTile)),s>=1013&&s<=1018&&(a.extend(fs.BaseSkill),a.extend(fs.SkillVerticalTile)),s>=1019&&s<=1024&&(a.extend(fs.BaseSkill),a.extend(fs.SkillXBombTile)),s==1034&&(a.extend(fs.BaseSkill),a.extend(fs.SkillXBombShortTile)),s>=1025&&s<=1030&&(a.extend(fs.BaseSkill),a.extend(fs.SkillJellyTile)),s==1035&&(a.extend(fs.BaseSkill),a.extend(fs.SkillJellyShortTile)),s==1031&&(a.extend(fs.BaseSkill),a.extend(fs.SkillRainbowTile)),s==1032&&(a.extend(fs.BaseSkill),a.extend(fs.SkillMagnetTile)),s==2401&&a.extend(fs.CeilTile),s==1101&&a.extend(fs.BeeTile),s==1201&&a.extend(fs.CowTile),s>=1301&&s<=1307&&a.extend(fs.TreeTile),s==1102&&a.extend(fs.HoneyTile),s>=2201&&s<=2209&&a.extend(fs.PopsicleTile),s==1103&&a.extend(fs.CoconutTile),s==1104&&a.extend(fs.CoconutJuiceTile),s==2501&&a.extend(fs.IceTile),s==1204&&a.extend(fs.RainbowiceTile);if(s==1109||s==1108||s==1096)a.extend(fs.HPTile),s==1108&&a.extend(fs.CookieTile);return s==2004&&a.extend(fs.GeneralTile),(s==2601||s==2602)&&a.extend(fs.GeneralTile),a},qc.fs.TileFactory=new it;var st=function(){var e=this;e.poolSize=72,e.list=[]};st.prototype.supplyTile=function(){var e=this;while(e.list.length<e.poolSize)for(var t in fs.LayerManager.generator){if(!(e.list.length<e.poolSize))break;var n=fs.LayerManager.getRandomProp(t),r=fs.TileFactory.buildTile(0,n,"element",!0);e.list.push(r)}fs.GameManager.isBoardReady=!0},st.prototype.restTile=function(e,t,n){var r=this;e.gameObject.x=fs.CommonLayer.pivotX(t),e.gameObject.y=n?fs.CommonLayer.pivotY(t):fs.CommonLayer.pivotY(t)-fs.ConfigManager.gridH,e.icon.visible=!0,e.explode.visible=!1,e.make_skill.visible=!1,e.baofa.visible=!1,e.newFlag=n?!1:!0,e.delFlag=!1,e.moveFlag=!1},st.prototype.getTile=function(e,t){var r=this,i=null,s=null;t!=n?s={tileID:t}:s=fs.LayerManager.getRandomProp(e);var o=s.tileID;for(var u=0,a=r.list.length;u<a;u++){var f=r.list[u];if(f.id==o){i=f,r.list.splice(u,1);break}}return i==null&&(i=fs.TileFactory.buildTile(e,s,"element",!0)),r.restTile(i,e,t),i},st.prototype.recoverTile=function(e){var t=this;e.gameObject.x=40,e.gameObject.y=-40,e.setDelFlag(!0),t.list.push(e)},qc.fs.TilePool=new st;var ot=qc.fs.TreeTile={};ot.init=function(){var e=this,t={1301:1001,1302:1002,1303:1003,1304:1004,1305:1005,1306:1006,1307:1102};e.fruitID=t[e.id]},ot.doAction=function(e,t,n,r){var i=this;return i.hp<3&&i.hp++,i.updateIcon(),i.setDelFlag(!1),!0},ot.getFruitTilePos=function(){var e=this,t=fs.ConfigManager.row*fs.ConfigManager.colunm,n=[],r=[];for(var i=0;i<t;i++){var s=fs.LayerManager.tilesList.element[i];s!=null&&s.class1=="base"&&!s.delFlag&&!s.moveFlag&&s.id!=e.fruitID&&n.push(i)}for(var i=0;i<3;i++){var o=!0;while(o){var u=fs.Game.math.random(0,n.length-1);r.indexOf(n[u])==-1&&(r.push(n[u]),o=!1)}}return r},ot.doSkill=function(e){var t=this,n=t.getFruitTilePos();n.forEach(function(n,r){t.moveFruitToTile(n,e)})},ot.moveFruitToTile=function(e,t){var n=this,r=null,i=fs.CommonLayer.getIndex(n.gameObject.x,n.gameObject.y),s=fs.LayerManager.tilesList.element[e];fs.GameManager.stop(),r=fs.TilePool.getTile(i,n.fruitID),fs.TilePool.recoverTile(s),fs.LayerManager.tilesList.element[e]=null,fs.LayerManager.tilesList.element[e]=r,r.setMoveFlag(!0),r.move(e,function(){r.setMoveFlag(!1),fs.GameManager.start(),typeof t=="function"&&t()},.35)},ot.updateIcon=function(){var e=this,t=e.hp,n=e.icon.frame.match(/\d+/g),r=e.icon.frame.split(n);e.icon.frame=r[0]+t+r[1];var i=e.gameObject,s=i.addScript("qc.TweenScale");s.duration=.2,s.from=new qc.Point(1,1),s.to=new qc.Point(1.3,1.3),s.onFinished.addOnce(function(){s.from=new qc.Point(1.3,1.3),s.to=new qc.Point(1,1),s.resetToBeginning(),s.playForward()}),s.resetToBeginning(),s.playForward()},ot.updateRounds=function(e){var t=this;t.hp==3&&(t.hp=0,t.doSkill(e),t.updateIcon())};var ut=qc.defineBehaviour("qc.engine.AudioManager",qc.Behaviour,function(){var e=this;fs.AudioManager=e,e.soundQueue=[],e.soundSwitch=!1},{});ut.prototype.playSound=function(e,t){var n=this,t=t||!1,r=fs.ConfigManager.soundData[e];!r.isPlaying&&!n.soundSwitch&&(r.loop=t,r.play())},ut.prototype.stopSound=function(e){var t=this,n=fs.ConfigManager.soundData[e];n.stop()},ut.prototype.pauseSound=function(e){var t=this,n=fs.ConfigManager.soundData[e];n.pause()},ut.prototype.resumeSound=function(e){var t=this,n=fs.ConfigManager.soundData[e];n.resume()};var at=qc.defineBehaviour("qc.engine.CacheAsBitmap",qc.Behaviour,function(){var e=this;fs.CacheAsBitmap=e,e.cacheNode=[qc.N("bossTarget"),qc.N("floor")]},{});at.prototype.updateCache=function(){var e=this;for(var t=0,n=e.cacheNode.length;t<n;t++){var r=e.cacheNode[t],i=r.getScript("qc.CacheAsBitmap");i.dirty=!0}};var ft=qc.defineBehaviour("qc.engine.pauseManager",qc.Behaviour,function(){var e=this;e.node={pauseDialog:qc.N("pauseDialog"),pauseBtn:qc.N("pauseBtn"),continueBtn:qc.N("continueBtn"),homeBackBtn:qc.N("homeBackBtn"),restartBtn:qc.N("restartBtn"),soundOnBtn:qc.N("soundOnBtn"),soundOffBtn:qc.N("soundOffBtn"),addStep:qc.N("addStep"),minusStep:qc.N("minusStep")}},{});ft.prototype.awake=function(){var e=this;e.node.pauseBtn.onClick.add(e.pauseFn.bind(e)),e.node.continueBtn.onClick.add(e.continueFn.bind(e)),e.node.homeBackBtn.onClick.add(e.homeBackFn.bind(e)),e.node.restartBtn.onClick.add(e.restartFn.bind(e)),e.node.soundOnBtn.onClick.add(e.soundOnFn.bind(e)),e.node.soundOffBtn.onClick.add(e.soundOffFn.bind(e)),qc.N("addStep").onClick.add(e.addStepFn.bind(e)),qc.N("minusStep").onClick.add(e.minusStepFn.bind(e))},ft.prototype.pauseFn=function(){var e=this;fs.AudioManager.playSound(16),e.node.pauseDialog.visible=!0,fs.FightControl.isAction=!0},ft.prototype.continueFn=function(){var e=this;fs.AudioManager.playSound(16),e.node.pauseDialog.visible=!1,fs.FightControl.isAction=!1},ft.prototype.homeBackFn=function(){var e=this;fs.AudioManager.playSound(16)},ft.prototype.restartFn=function(){var e=this;fs.GameManager.removeTimeBuilder(),fs.TilePool.list=[],fs.BossSkill.skillStepCount=0,fs.BossSkill.bossState=null,fs.Game.scene.load("fight",!0,function(){console.log("Start loading assets.")},function(){console.log("Loaded ok.")}),fs.AudioManager.playSound(16)},ft.prototype.soundOnFn=function(){var e=this;fs.AudioManager.playSound(16),fs.AudioManager.pauseSound(0),fs.AudioManager.soundSwitch=!0,e.node.soundOffBtn.visible=!0,e.node.soundOnBtn.visible=!1},ft.prototype.soundOffFn=function(){var e=this;fs.AudioManager.playSound(16),fs.AudioManager.resumeSound(0),fs.AudioManager.soundSwitch=!1,e.node.soundOffBtn.visible=!1,e.node.soundOnBtn.visible=!0},ft.prototype.addStepFn=function(){var e=this;fs.ScenesUI.stepCount+=5,qc.N("stepNum").text=String(fs.ScenesUI.stepCount)},ft.prototype.minusStepFn=function(){var e=this;fs.ScenesUI.stepCount>5&&(fs.ScenesUI.stepCount-=5,qc.N("stepNum").text=String(fs.ScenesUI.stepCount))};var lt=qc.defineBehaviour("qc.engine.PopManager",qc.Behaviour,function(){var e=this;fs.PopManager=e},{comboPopNode:qc.Serializer.NODE,rebuildNode:qc.Serializer.NODE,rebuildNodeOut:qc.Serializer.NODE});lt.prototype.playComboAnimation=function(e){var t=this,n="";fs.GameManager.removeTimeBuilder();if(e==4)n="good";else if(e==5)n="great";else if(e==6)n="amazing";else{if(!(e>6))return;n="unbelievable"}t.playPopAnimation(n)},lt.prototype.playPopAnimation=function(e){var t=this;if(fs.TaskLogic.gameResult!=null)return;t.comboPopNode.alpha=1,t.comboPopNode.resetNativeSize(),t.comboPopNode.playAnimation(e,1,!1),e=="nomatch"&&(fs.FightControl.isAction=!0,fs.AudioManager.playSound(114)),e=="good"&&fs.AudioManager.playSound(109),e=="great"&&fs.AudioManager.playSound(110),e=="amazing"&&fs.AudioManager.playSound(111),e=="unbelievable"&&fs.AudioManager.playSound(112),e=="nomatch"&&t.comboPopNode.onFinished.addOnce(function(){t.playVortexAnimation(),t.comboPopNode.alpha=0})},lt.prototype.playVortexAnimation=function(){var e=this;e.rebuildNode.alpha=1,e.rebuildNode.playAnimation("in",1,!1),fs.AudioManager.playSound(101),fs.DisFactory.dieMapRebuild(),e.rebuildNode.onFinished.addOnce(function(){fs.PopManager.playVortexAnimationOut()})},lt.prototype.playVortexAnimationOut=function(){var e=this;e.rebuildNodeOut.alpha=1,e.rebuildNodeOut.playAnimation("out",1,!1);for(var t=0;t<72;t++){if(fs.LayerManager.tilesList.element[t]==null)continue;fs.LayerManager.tilesList.element[t].id<=1006&&(fs.LayerManager.tilesList.element[t].gameObject.alpha=1)}e.rebuildNodeOut.onFinished.addOnce(function(){fs.FightControl.isAction=!1,fs.GameManager.noticeTimeBuilder()})};var ct=qc.defineBehaviour("qc.engine.RestartButton",qc.Behaviour,function(){},{});ct.prototype.onClick=function(){var e=this;if(fs.ScenesUI.resultState=="start")return;fs.GameManager.removeTimeBuilder(),fs.TilePool.list=[],fs.BossSkill.skillStepCount=0,fs.BossSkill.bossState=null,fs.TaskLogic.gameResult=null,fs.ActorAnimation.isActorMove=!1,fs.ActorAnimation.actorState=null,fs.ScenesUI.scorePanelSoundList=[!1,!1,!1],fs.Game.scene.load("fight",!0,function(){console.log("Start loading assets.")},function(){console.log("Loaded ok.")}),fs.AudioManager.playSound(16)};var ht=qc.defineBehaviour("qc.engine.ScenesUI",qc.Behaviour,function(){var e=this;fs.ScenesUI=e,e.stepCount=null,e.gameScore=0,e.boringCount=0,e.isTargetDis=[],e.gameMode=null,e.starScoreList=[],e.gameLevel=0,e.disFlag=[],e.scorePanelSoundList=[!1,!1,!1]},{topBg:qc.Serializer.NODE,gridBg:qc.Serializer.NODE,levelIcon:qc.Serializer.NODE,juiceUI:qc.Serializer.NODE,bossUI:qc.Serializer.NODE,bossHPUI:qc.Serializer.NODE,pdUI:qc.Serializer.NODE,gPd:qc.Serializer.NODE,nodePur:qc.Serializer.NODE,restBg:qc.Serializer.NODE,tipSetting:qc.Serializer.NODE,tips:qc.Serializer.NODE,des:qc.Serializer.NODE,pauseActive:qc.Serializer.NODE,pauseBtn:qc.Serializer.NODE,soundBtnOn:qc.Serializer.NODE,soundBtnOff:qc.Serializer.NODE,soundBgOn:qc.Serializer.NODE,soundBgOff:qc.Serializer.NODE,startBtn:qc.Serializer.NODE,stop:qc.Serializer.NODE,step:qc.Serializer.NODE,scorePanel:qc.Serializer.NODE,resultSucessPanel:qc.Serializer.NODE,resultFailPanel:qc.Serializer.NODE});ht.prototype.awake=function(){var e=this;e.backGround={topBg:e.topBg,gridBg:e.gridBg},e.gameModeTarget={step:e.step,juiceTarget:{ui:e.juiceUI,target:e.nodePur,rest:e.restBg},bossTarget:{ui:e.bossUI,hp:e.bossHPUI},poAnddgTarget:{ui:e.pdUI}},e.buttonsManager={soundBtnOn:e.soundBtnOn,soundBtnOff:e.soundBtnOff,soundBgOn:e.soundBgOn,soundBgOff:e.soundBgOff,pauseBtn:e.pauseBtn,startBtn:e.startBtn,stop:e.stop},e.tipSettingPanel={tipSettingNode:e.tipSetting,tips:e.tips,des:e.des,tipIcon:e.levelIcon}},ht.prototype.getDisTarget=function(e){var t=this;t.getScore(e);if(fs.ConfigManager.excelData.zone[fs.ConfigManager.levelID].type=="juice"){fs.TaskLogic.taskObj[0].elementID==fs.TaskLogic.taskObj[1].elementID&&fs.TaskLogic.taskObj[0].elementNumber>0&&fs.TaskLogic.taskObj[1].elementNumber>0?fs.TaskLogic.taskObj[0].elementNumber>=fs.TaskLogic.taskObj[1].elementNumber?t.disFlag.push(0):fs.TaskLogic.taskObj[0].elementNumber<fs.TaskLogic.taskObj[1].elementNumber&&t.disFlag.push(1):fs.TaskLogic.taskObj[0].elementID==fs.TaskLogic.taskObj[2].elementID&&fs.TaskLogic.taskObj[0].elementNumber>0&&fs.TaskLogic.taskObj[2].elementNumber>0?fs.TaskLogic.taskObj[0].elementNumber>=fs.TaskLogic.taskObj[2].elementNumber?t.disFlag.push(0):fs.TaskLogic.taskObj[0].elementNumber<fs.TaskLogic.taskObj[2].elementNumber&&t.disFlag.push(2):fs.TaskLogic.taskObj[1].elementID==fs.TaskLogic.taskObj[2].elementID&&fs.TaskLogic.taskObj[1].elementNumber>0&&fs.TaskLogic.taskObj[2].elementNumber>0?fs.TaskLogic.taskObj[1].elementNumber>=fs.TaskLogic.taskObj[2].elementNumber?t.disFlag.push(1):fs.TaskLogic.taskObj[1].elementNumber<fs.TaskLogic.taskObj[2].elementNumber&&t.disFlag.push(2):(t.disFlag=null,t.disFlag=[]);for(var n=0;n<3;n++){if(e.color==fs.TaskLogic.taskObj[n].color&&e.class3=="tile"){if(t.disFlag.length!=0&&t.disFlag[0]==n||fs.TaskLogic.taskObj[n].elementNumber<=0)continue;fs.TaskLogic.taskObj[n].elementNumber-=1;var r=4-(n+1);fs.ActorAnimation.actorState="get",fs.ActorAnimation.playActorAnimation(r),t.gameScore+=100;var i=t.gameModeTarget.juiceTarget.target.children[n].getScript("qc.TweenScale");i.from=new qc.Point(1,1),i.to=new qc.Point(1.4,1.4),i.duration=.2,i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){i.from=new qc.Point(1.4,1.4),i.to=new qc.Point(1,1),i.resetToBeginning(),i.playForward()});if(fs.TaskLogic.taskObj[n].elementNumber<=0){fs.TaskLogic.taskObj[n].class1=null;if(fs.TaskLogic.restTaskObj.length>0)fs.TaskLogic.taskObj[n]=fs.TaskLogic.restTaskObj.pop();else if(fs.TaskLogic.restTaskObj.length<=0){var i=t.gameModeTarget.juiceTarget.target.children[n].getScript("qc.TweenScale");i.from=new qc.Point(1,1),i.to=new qc.Point(1.4,1.4),i.duration=.2,i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){i.from=new qc.Point(1.4,1.4),i.to=new qc.Point(1,1),i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){t.gameModeTarget.juiceTarget.target.children[n].visible=!1})})}}fs.TaskLogic.refreshJuiceTask(t),t.isTargetDis.push(!0),t.boringCount=0;return}if(e.class1!=null&&fs.TaskLogic.taskObj[n].class1!=null){var s=fs.TaskLogic.taskObj[n].class1.indexOf(";");if(s!=-1){var o=fs.TaskLogic.taskObj[n].class1.split(";");for(var u=0;u<o.length;u++)if(e.class1==o[u]&&e.color==fs.TaskLogic.taskObj[n].color){if(t.disFlag.length!=0&&t.disFlag[0]==n||fs.TaskLogic.taskObj[n].elementNumber<=0)continue;fs.TaskLogic.taskObj[n].elementNumber-=1;var r=4-(n+1);fs.ActorAnimation.actorState="get",fs.ActorAnimation.playActorAnimation(r),t.gameScore+=100;var i=t.gameModeTarget.juiceTarget.target.children[n].getScript("qc.TweenScale");i.from=new qc.Point(1,1),i.to=new qc.Point(1.4,1.4),i.duration=.2,i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){i.from=new qc.Point(1.4,1.4),i.to=new qc.Point(1,1),i.resetToBeginning(),i.playForward()});if(fs.TaskLogic.taskObj[n].elementNumber<=0){fs.TaskLogic.taskObj[n].class1=null;if(fs.TaskLogic.restTaskObj.length>0)fs.TaskLogic.taskObj[n]=fs.TaskLogic.restTaskObj.pop();else if(fs.TaskLogic.restTaskObj.length<=0){var i=t.gameModeTarget.juiceTarget.target.children[n].getScript("qc.TweenScale");i.from=new qc.Point(1,1),i.to=new qc.Point(1.4,1.4),i.duration=.2,i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){i.from=new qc.Point(1.4,1.4),i.to=new qc.Point(1,1),i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){t.gameModeTarget.juiceTarget.target.children[n].visible=!1})})}}fs.TaskLogic.refreshJuiceTask(t),t.isTargetDis.push(!0),t.boringCount=0;return}}}if(e.class2!=null&&fs.TaskLogic.taskObj[n].class2!=null){var s=fs.TaskLogic.taskObj[n].class2.indexOf(";");if(s!=-1){var o=fs.TaskLogic.taskObj[n].class2.split(";");for(var u=0;u<o.length;u++)if(e.class2==o[u]&&e.color==fs.TaskLogic.taskObj[n].color){fs.TaskLogic.taskObj[n].elementNumber-=1;var r=4-(n+1);fs.ActorAnimation.actorState="get",fs.ActorAnimation.playActorAnimation(r),fs.TaskLogic.refreshJuiceTask(t),t.isTargetDis.push(!0),t.boringCount=0;return}}}if(e.class3!=null&&fs.TaskLogic.taskObj[n].class3!=null){var s=fs.TaskLogic.taskObj[n].class3.indexOf(";");if(s!=-1)var o=fs.TaskLogic.taskObj[n].class3.split(";");else var o=fs.TaskLogic.taskObj[n].class3;if(e.class3==o){if(t.disFlag.length!=0&&t.disFlag[0]==n||fs.TaskLogic.taskObj[n].elementNumber<=0)continue;fs.TaskLogic.taskObj[n].elementNumber-=1;var r=4-(n+1);fs.ActorAnimation.actorState="get",fs.ActorAnimation.playActorAnimation(r),t.gameScore+=100;var i=t.gameModeTarget.juiceTarget.target.children[n].getScript("qc.TweenScale");i.from=new qc.Point(1,1),i.to=new qc.Point(1.4,1.4),i.duration=.2,i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){i.from=new qc.Point(1.4,1.4),i.to=new qc.Point(1,1),i.resetToBeginning(),i.playForward()});if(fs.TaskLogic.taskObj[n].elementNumber<=0){fs.TaskLogic.taskObj[n].class3=null;if(fs.TaskLogic.restTaskObj.length>0)fs.TaskLogic.taskObj[n]=fs.TaskLogic.restTaskObj.pop();else if(fs.TaskLogic.restTaskObj.length<=0){var i=t.gameModeTarget.juiceTarget.target.children[n].getScript("qc.TweenScale");i.from=new qc.Point(1,1),i.to=new qc.Point(1.4,1.4),i.duration=.2,i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){i.from=new qc.Point(1.4,1.4),i.to=new qc.Point(1,1),i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){t.gameModeTarget.juiceTarget.target.children[n].visible=!1})})}}fs.TaskLogic.refreshJuiceTask(t),t.isTargetDis.push(!0),t.boringCount=0;return}}t.disFlag=null,t.disFlag=[],t.isTargetDis.push(!1)}}if(fs.ConfigManager.excelData.zone[fs.ConfigManager.levelID].type=="popsicle")if(e.class3=="popsicle"){if(fs.TaskLogic.taskObj[0].elementNumber>0){fs.TaskLogic.taskObj[0].elementNumber-=1,t.boringCount=0,fs.ActorAnimation.isActorMove=!1,fs.ActorAnimation.actorState="get",fs.ActorAnimation.playActorAnimation();var i=t.gPd.getScript("qc.TweenScale");i.from=new qc.Point(1.2,1.2),i.to=new qc.Point(1.6,1.6),i.duration=.2,i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){i.from=new qc.Point(1.6,1.6),i.to=new qc.Point(1.2,1.2),i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){fs.TaskLogic.taskObj[0].elementNumber==0&&(t.gPd.visible=!1)})}),t.isTargetDis.push(!0)}fs.TaskLogic.refreshPopsicleTask(t)}else t.isTargetDis.push(!1);if(fs.ConfigManager.excelData.zone[fs.ConfigManager.levelID].type=="dogfood")if(e.class3=="cookies"){if(fs.TaskLogic.taskObj[0].elementNumber>0){fs.TaskLogic.taskObj[0].elementNumber-=1,fs.ActorAnimation.actorState="get",fs.ActorAnimation.playActorAnimation();var i=t.gPd.getScript("qc.TweenScale");i.from=new qc.Point(1.2,1.2),i.to=new qc.Point(1.6,1.6),i.duration=.2,i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){i.from=new qc.Point(1.6,1.6),i.to=new qc.Point(1.2,1.2),i.resetToBeginning(),i.playForward(),i.onFinished.addOnce(function(){fs.TaskLogic.taskObj[0].elementNumber==0&&(t.gPd.visible=!1)})}),t.boringCount=0,t.isTargetDis.push(!0)}fs.TaskLogic.refreshDogfoodTask(t)}else t.isTargetDis.push(!1);if(fs.ConfigManager.excelData.zone[fs.ConfigManager.levelID].type=="trouble"){for(var n=0;n<fs.TaskLogic.taskObj.length;n++)e.color==fs.TaskLogic.taskObj[n].color||e.class3==fs.TaskLogic.class3&&e.class3!=null?(fs.TaskLogic.bossHP-=1,fs.ActorAnimation.actorState="get",fs.ActorAnimation.playActorAnimation(),t.boringCount=0,t.isTargetDis.push(!0),fs.AudioManager.playSound(8)):t.isTargetDis.push(!1);fs.TaskLogic.refreshBossTask(t)}},ht.prototype.initLevelUI=function(){var e=this;fs.ActorAnimation.initActorAnimation(e);var t=fs.ConfigManager.excelData.zone[fs.ConfigManager.levelID];e.stepCount=t.step,e.gameModeTarget.step.text=t.step.toString(),e.starScoreList.push(t.star1Score),e.starScoreList.push(t.star2Score),e.starScoreList.push(t.star3Score);var n=t.type;e.gameMode=n,n=="juice"&&(e.gameModeTarget.juiceTarget.ui.visible=!0,fs.TaskLogic.juiceTaskControl(e,t),console.log("果汁模式")),n=="trouble"&&(e.gameModeTarget.bossTarget.ui.visible=!0,e.gameModeTarget.bossTarget.hp.visible=!0,fs.TaskLogic.bossTaskControl(e,t),console.log("boss模式")),n=="popsicle"&&(e.gameModeTarget.poAnddgTarget.ui.visible=!0,fs.TaskLogic.popsicleControl(e,t),console.log("鱼片模式")),n=="dogfood"&&(e.gameModeTarget.poAnddgTarget.ui.visible=!0,fs.TaskLogic.dogfoodControl(e,t),console.log("饼干模式")),e.scorePanelControl()},ht.prototype.stepLogic=function(){var e=this;e.stepCount!=0&&(e.stepCount-=1,e.gameModeTarget.step.text=e.stepCount.toString())},ht.prototype.getScore=function(e){var t=this;if(e.id==1031||e.id==1032)fs.GameManager.comboCount==0?t.gameScore+=2*e.basicScore:t.gameScore+=2*e.basicScore*fs.GameManager.comboCount;if(e.disCount>=3){var n=Math.ceil(Math.ceil(e.basicScore*e.scoreMultiple*fs.GameManager.comboCount*(Math.pow(e.disCount-3,1.25)+1))/10)*10;t.gameScore+=n}else fs.GameManager.comboCount==0?t.gameScore+=e.basicScore*1*e.scoreMultiple:t.gameScore+=e.basicScore*fs.GameManager.comboCount*e.scoreMultiple},ht.prototype.checkIsBoringDis=function(){var e=this;if(e.isTargetDis.length==0)return;for(var t=0;t<e.isTargetDis.length;t++)if(e.isTargetDis[t]===!0){e.isTargetDis=[];return}e.boringCount+=1,e.isTargetDis=[]},ht.prototype.scorePanelControl=function(){var e=this,t=e.scorePanel.find("mask").find("curScore"),n=e.scorePanel.find("mask"),r=e.scorePanel.find("one"),i=e.scorePanel.find("two"),s=e.scorePanel.find("three");if(fs.TaskLogic.gameResult=="sucess"){e.gameScore+=e.stepCount*2500,qc.N("tempScoreText").text=e.gameScore.toString();var o=fs.Game.timer.loop(100,function(){e.stepCount>0?(e.stepCount--,e.gameModeTarget.step.text=e.stepCount.toString()):fs.Game.timer.remove(o)})}if(e.gameScore<e.starScoreList[0]){var u=e.gameScore/e.starScoreList[0];t.rotation=(125-30*u)*Math.PI/180}if(e.gameScore>=e.starScoreList[0]){r.frame="gameboard_yellowStar.png",e.gameLevel=1,e.scorePanelSoundList[0]==0&&(fs.AudioManager.playSound(13),e.scorePanelSoundList[0]=!0);var u=e.gameScore/e.starScoreList[1];t.rotation=(95-50*u)*Math.PI/180}if(e.gameScore>=e.starScoreList[1]){i.frame="gameboard_yellowStar.png",e.gameLevel=2,e.scorePanelSoundList[1]==0&&(fs.AudioManager.playSound(14),e.scorePanelSoundList[1]=!0);var u=e.gameScore/e.starScoreList[2];t.rotation=(45-45*u)*Math.PI/180}if(e.gameScore>=e.starScoreList[2]){s.frame="gameboard_yellowStar.png",e.gameLevel=3,e.scorePanelSoundList[2]==0&&(fs.AudioManager.playSound(15),e.scorePanelSoundList[2]=!0);var u=e.gameScore/e.starScoreList[2];u>=1&&(u=1),t.rotation=0}},ht.prototype.tipPanelControl=function(){var e=this;fs.ScenesUI.gameMode=="juice"&&(e.tipSettingPanel.tipIcon.frame="level_icon_juice.png",e.tipSettingPanel.des.find("des1").text="帮助亮哥收集",e.tipSettingPanel.des.find("desNum").text=""+fs.TaskLogic.taskObj.length+"",e.tipSettingPanel.des.find("des2").text="份食材"),fs.ScenesUI.gameMode=="popsicle"&&(e.tipSettingPanel.tipIcon.frame="level_icon_popsicle.png",e.tipSettingPanel.des.find("des1").text="帮Jacson收集",console.log(fs.TaskLogic.taskObj),e.tipSettingPanel.des.find("desNum").text=""+fs.TaskLogic.taskObj[0].elementNumber+"",e.tipSettingPanel.des.find("des2").text="份鱼片"),fs.ScenesUI.gameMode=="dogfood"&&(e.tipSettingPanel.tipIcon.frame="level_icon_cracker.png",e.tipSettingPanel.des.find("des1").text="帮辰辰收集",console.log(fs.TaskLogic.taskObj),e.tipSettingPanel.des.find("desNum").text=""+fs.TaskLogic.taskObj[0].elementNumber+"",e.tipSettingPanel.des.find("des2").text="份饼干"),fs.ScenesUI.gameMode=="trouble"&&(e.tipSettingPanel.tipIcon.frame="level_icon_boss.png",e.tipSettingPanel.des.find("bossTxt").text="赶走捣乱者!")},ht.prototype.tipPanelTimeout=function(){var e=this,t=1500,n=fs.Game.timer.add(t,function(){e.tipSettingPanel.tipSettingNode.visible=!1})},ht.prototype.boringLogic=function(){var e=this;e.boringCount>=3&&fs.ActorAnimation.isActorMove==0&&e.stepCount>3?e.gameMode!="trouble"&&(fs.ActorAnimation.actorState="boring",fs.ActorAnimation.playActorAnimation()):e.stepCount<=3&&e.stepCount>0&&e.gameMode!="trouble"&&(fs.ActorAnimation.actorState="nervous",fs.ActorAnimation.playActorAnimation())},ht.prototype.resultControl=function(e){var t=this,n=1,r=1.4,i=.1;t.resultState="start",fs.GameManager.removeTimeBuilder(),e=="fail"?(fs.AudioManager.playSound(52),fs.GameManager.stop(),t.resultFailPanel.visible=!0,t.resultState="complete"):e=="sucess"&&(fs.AudioManager.stopSound(0),fs.AudioManager.playSound(51),fs.GameManager.stop(),t.resultSucessPanel.visible=!0,t.gameLevel==0&&(t.resultState="complete"),t.gameLevel==1&&fs.Game.timer.add(500,function(){t.resultSucessPanel.find("starBg").children[0].frame="start_1.png";var e=t.resultSucessPanel.find("starBg").children[0].getScript("qc.TweenScale");e.from=new qc.Point(n,n),e.to=new qc.Point(r,r),e.resetToBeginning(),e.playForward(),e.duration=i,e.onFinished.addOnce(function(){e.from=new qc.Point(r,r),e.to=new qc.Point(n,n),e.resetToBeginning(),e.playForward(),t.resultState="complete"}),fs.AudioManager.playSound(118)}),t.gameLevel==2&&(fs.Game.timer.add(500,function(){t.resultSucessPanel.find("starBg").children[0].frame="start_1.png",fs.AudioManager.playSound(118);var e=t.resultSucessPanel.find("starBg").children[0].getScript("qc.TweenScale");e.from=new qc.Point(n,n),e.to=new qc.Point(r,r),e.resetToBeginning(),e.playForward(),e.duration=i,e.onFinished.addOnce(function(){e.from=new qc.Point(r,r),e.to=new qc.Point(n,n),e.resetToBeginning(),e.playForward()})}),fs.Game.timer.add(900,function(){t.resultSucessPanel.find("starBg").children[1].frame="start_1.png";var e=t.resultSucessPanel.find("starBg").children[1].getScript("qc.TweenScale");e.from=new qc.Point(n,n),e.to=new qc.Point(r,r),e.resetToBeginning(),e.playForward(),e.duration=i,e.onFinished.addOnce(function(){e.from=new qc.Point(r,r),e.to=new qc.Point(n,n),e.resetToBeginning(),e.playForward(),t.resultState="complete"}),fs.AudioManager.playSound(119)})),t.gameLevel==3&&(fs.Game.timer.add(500,function(){t.resultSucessPanel.find("starBg").children[0].frame="start_1.png",fs.AudioManager.playSound(118);var e=t.resultSucessPanel.find("starBg").children[0].getScript("qc.TweenScale");e.from=new qc.Point(n,n),e.to=new qc.Point(r,r),e.resetToBeginning(),e.playForward(),e.duration=i,e.onFinished.addOnce(function(){e.from=new qc.Point(r,r),e.to=new qc.Point(n,n),e.resetToBeginning(),e.playForward()})}),fs.Game.timer.add(900,function(){t.resultSucessPanel.find("starBg").children[1].frame="start_1.png",fs.AudioManager.playSound(119);var e=t.resultSucessPanel.find("starBg").children[1].getScript("qc.TweenScale");e.from=new qc.Point(n,n),e.to=new qc.Point(r,r),e.resetToBeginning(),e.playForward(),e.duration=i,e.onFinished.addOnce(function(){e.from=new qc.Point(r,r),e.to=new qc.Point(n,n),e.resetToBeginning(),e.playForward()})}),fs.Game.timer.add(1300,function(){t.resultSucessPanel.find("starBg").children[2].frame="start_1.png",fs.AudioManager.playSound(120);var e=t.resultSucessPanel.find("starBg").children[2].getScript("qc.TweenScale");e.from=new qc.Point(n,n),e.to=new qc.Point(r,r),e.resetToBeginning(),e.playForward(),e.duration=i,e.onFinished.addOnce(function(){e.from=new qc.Point(r,r),e.to=new qc.Point(n,n),e.resetToBeginning(),e.playForward()}),t.resultState="complete"})))}}).call(this,this,Object)